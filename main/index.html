<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<link rel="icon" type="image/x-icon" href="images/favicon.ico">
<title>Network Communication and FMI 3.0, v1.0</title>
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:30em;padding-right:0}
#toc.toc2{width:30em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote::before{display:none}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{word-spacing:0;line-height:1.6}
.quoteblock.abstract blockquote::before,.quoteblock.abstract p::before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}

/* customizations */

body{
  font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
}

.toc-hidden {
  padding-left: 0 !important;
}

.imageblock {
  text-align: center;
}

.imageblock img {
  display: block;
  margin: auto;
}

.imageblock .title {
  display: inline-block;
  margin: auto;
}

.vertical-text {
	transform: rotate(-90deg) translate(-11em, 0);
	transform-origin: left top 0;
  float: left;
  display: inline-block;
  white-space: nowrap;
  width: 1em;
  height: 11em;
}

/* no alternating row colors */
table tr.even,table tr.alt,table tr:nth-of-type(even) {
  background:none
}

/* use parent text color for captions */
.subheader, .admonitionblock td.content>.title, .audioblock>.title, .exampleblock>.title, .imageblock>.title, .listingblock>.title, .literalblock>.title, .stemblock>.title, .openblock>.title, .paragraph>.title, .quoteblock>.title, table.tableblock>.title, .verseblock>.title, .videoblock>.title, .dlist>.title, .olist>.title, .ulist>.title, .qlist>.title, .hdlist>.title {
  color: inherit;
}

a {
  text-decoration: none;
}

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/github.min.css">
<script>
// hide / show the Table of Contents (TOC)
function toggleTOC() {
  var toc = document.getElementById("toc");
  var body = document.getElementsByTagName("body")[0];

  if (toc.style.display === "none") {
      toc.style.display = "block";
      body.classList.remove("toc-hidden");
  } else {
      toc.style.display = "none";
      body.classList.add("toc-hidden");
  }
}

// toggle the TOC when "t" key is pressed
document.addEventListener('keydown', (event) => {
  if (event.key == 't') {
    toggleTOC();
  }
});
</script>

<!-- Generate a nice TOC -->
<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js"></script>
<!-- We do not need the tocify CSS because the asciidoc CSS already provides most of what we neeed -->

<style>
.tocify-header {
    font-style: italic;
}

.tocify-subheader {
    font-style: normal;
    font-size: 90%;
}

.tocify ul {
    margin: 0;
 }

.tocify-focus {
    color: #7a2518;
    background-color: rgba(0, 0, 0, 0.1);
}

.tocify-focus > a {
    color: #7a2518;
}
</style>

<script type="text/javascript">
    $(function () {
        // Add a new container for the tocify toc into the existing toc so we can re-use its
        // styling
        $("#toc").append("<div id='generated-toc'></div>");
        $("#generated-toc").tocify({
            extendPage: true,
            context: "#content",
            highlightOnScroll: true,
            // don't hide the sections in the TOC
            showAndHide: false,
            hideEffect: "slideUp",
            // Use the IDs that asciidoc already provides so that TOC links and intra-document
            // links are the same. Anything else might confuse users when they create bookmarks.
            hashGenerator: function(text, element) {
                return $(element).attr("id");
            },
            // Smooth scrolling doesn't work properly if we use the asciidoc IDs
            smoothScroll: false,
            // Set to 'none' to use the tocify classes
            theme: "none",
            // Handle book (may contain h1) and article (only h2 deeper)
            selectors: $( "#content" ).has( "h1" ).size() > 0 ? "h1,h2,h3,h4,h5" : "h2,h3,h4,h5,h6",
            ignoreSelector: ".discrete"
        });

        // Switch between static asciidoc toc and dynamic tocify toc based on browser size
        // This is set to match the media selectors in the asciidoc CSS
        // Without this, we keep the dynamic toc even if it is moved from the side to preamble
        // position which will cause odd scrolling behavior
        var handleTocOnResize = function() {
            if ($(document).width() < 768) {
                $("#generated-toc").hide();
                $(".sectlevel0").show();
                $(".sectlevel1").show();
            }
            else {
                $("#generated-toc").show();
                $(".sectlevel0").hide();
                $(".sectlevel1").hide();
            }
        }

        $(window).resize(handleTocOnResize);
        handleTocOnResize();
    });
</script>

<img style="display: block; margin: 2em auto; width: 30em;" src="images/FMI_logo_horizontal.svg" alt="FMI logo">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Network Communication and FMI 3.0, v1.0</h1>
<div class="details">
<span id="revnumber">version main-4d6071a3d306cc30b4acbb99db45f8fdc7c512b0,</span>
<span id="revdate">2023-07-04</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#_intent_of_this_document">1.1. Intent of This Document</a></li>
<li><a href="#_how_to_read_this_document">1.2. How to Read This Document</a></li>
<li><a href="#_remarks">1.3. Remarks</a></li>
</ul>
</li>
<li><a href="#_layered_standard_manifest_file">2. Layered Standard Manifest File</a></li>
<li><a href="#_common_concepts">3. Common Concepts</a>
<ul class="sectlevel2">
<li><a href="#SystemCompositions">3.1. System Compositions</a>
<ul class="sectlevel3">
<li><a href="#DirectCommunication">3.1.1. Direct Communication</a></li>
<li><a href="#Composition-with-dedicated-Bus-Simulation-FMU">3.1.2. Composition with dedicated Bus Simulation FMU</a></li>
<li><a href="#BusFeatureIntegratedFmuSimulator">3.1.3. Importer with Integrated Bus Simulation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_physical_signal_abstraction_high_cut">4. Physical Signal Abstraction ("high cut")</a>
<ul class="sectlevel2">
<li><a href="#_overview">4.1. Overview</a></li>
<li><a href="#_variables">4.2. Variables</a>
<ul class="sectlevel3">
<li><a href="#_signal_variables">4.2.1. Signal Variables</a></li>
<li><a href="#ClockVariableHighCut">4.2.2. Clock Variables</a></li>
</ul>
</li>
<li><a href="#NetworkDescriptionFile">4.3. Network Description Files</a></li>
<li><a href="#_terminal_definitions">4.4. Terminal Definitions</a>
<ul class="sectlevel3">
<li><a href="#BUSTerminalHighCut">4.4.1. Bus Terminal</a></li>
<li><a href="#FrameTerminal">4.4.2. Frame Terminal</a></li>
<li><a href="#PDUTerminal">4.4.3. PDU Terminal</a></li>
<li><a href="#TerminalMemberVariable">4.4.4. Terminal Member Variable for Signals</a></li>
<li><a href="#ExampleHighCut">4.4.5. Example</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#network-abstraction">5. Network Abstraction ("low cut")</a>
<ul class="sectlevel2">
<li><a href="#_overview_2">5.1. Overview</a></li>
<li><a href="#Overview-Layered-Standard-Bus-Protocol">5.2. Layered Standard Bus Protocol</a>
<ul class="sectlevel3">
<li><a href="#Format-Error-Operation">5.2.1. Format Error</a></li>
<li><a href="#Basic-Type-Definitions">5.2.2. Basic Type Definitions</a></li>
</ul>
</li>
<li><a href="#NetworkAbstractionVariables">5.3. Variables</a>
<ul class="sectlevel3">
<li><a href="#ClockVariableLowCut">5.3.1. Tx/Rx Clock Variables</a>
<ul class="sectlevel4">
<li><a href="#bus-communication-points">5.3.1.1. Bus Communication Points</a></li>
</ul>
</li>
<li><a href="#CommunicationVariable">5.3.2. Tx/Rx Data Variables</a></li>
<li><a href="#_mime_types">5.3.3. MIME Types</a></li>
</ul>
</li>
<li><a href="#_terminal_definitions_2">5.4. Terminal Definitions</a>
<ul class="sectlevel3">
<li><a href="#BUSTerminalLowCut">5.4.1. Bus Terminal</a></li>
<li><a href="#ExampleLowCut">5.4.2. Example</a></li>
</ul>
</li>
<li><a href="#BusTypeSpecificDetails">5.5. Bus-Specific Details</a>
<ul class="sectlevel3">
<li><a href="#_can_can_fd_can_xl">5.5.1. CAN, CAN FD, CAN XL</a>
<ul class="sectlevel4">
<li><a href="#_overview_3">5.5.1.1. Overview</a></li>
<li><a href="#_operations">5.5.1.2. Operations</a>
<ul class="sectlevel5">
<li><a href="#TransmitOpCodeCanLowCut">5.5.1.2.1. Transmit</a></li>
<li><a href="#ConfirmOpCodeCanLowCut">5.5.1.2.2. Confirm</a></li>
<li><a href="#FormatErrorOpCodeCanLowCut">5.5.1.2.3. Format Error</a></li>
<li><a href="#ArbitrationLostOpCodeCanLowCut">5.5.1.2.4. Arbitration Lost</a></li>
<li><a href="#BusErrorOpCodeCanLowCut">5.5.1.2.5. Bus Error</a></li>
<li><a href="#ConfigurationCanOpCode">5.5.1.2.6. Configuration</a></li>
<li><a href="#StatusOpCodeCanLowCut">5.5.1.2.7. Status</a></li>
<li><a href="#WakeupCanOpCode">5.5.1.2.8. Wake Up</a></li>
</ul>
</li>
<li><a href="#can-network-parameters">5.5.1.3. Network Parameters</a>
<ul class="sectlevel5">
<li><a href="#bus-notification-parameter">5.5.1.3.1. Bus Notification Parameter</a></li>
</ul>
</li>
<li><a href="#_configuration_of_bus_simulation">5.5.1.4. Configuration of Bus Simulation</a>
<ul class="sectlevel5">
<li><a href="#_baudrate_handling">5.5.1.4.1. Baudrate Handling</a></li>
<li><a href="#_buffer_handling">5.5.1.4.2. Buffer Handling</a></li>
</ul>
</li>
<li><a href="#_transmission_and_acknowledge">5.5.1.5. Transmission and Acknowledge</a></li>
<li><a href="#CanErrorHandling">5.5.1.6. Error Handling</a></li>
<li><a href="#CanArbitration">5.5.1.7. Arbitration</a></li>
<li><a href="#_wake_upsleep">5.5.1.8. Wake Up/Sleep</a></li>
<li><a href="#_examples">5.5.1.9. Examples</a>
<ul class="sectlevel5">
<li><a href="#example-can-possible-results-of-transmission">5.5.1.9.1. Transmission</a></li>
<li><a href="#example-can-arbitration-with-arbitration-lost-behavior">5.5.1.9.2. CAN Arbitration without Buffering</a></li>
<li><a href="#example-can-arbitration-without-arbitration-lost-behavior">5.5.1.9.3. CAN Arbitration with Buffering</a></li>
<li><a href="#example-can-error-handling">5.5.1.9.4. Error Handling</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_lin">5.5.2. LIN</a></li>
<li><a href="#_flexray">5.5.3. FlexRay</a></li>
<li><a href="#_ethernet">5.5.4. Ethernet</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_known_limitations_of_this_standard">6. Known Limitations of This Standard</a></li>
<li><a href="#_references">References</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This layered standard on top of FMI 3.0, defines how to describe and simulate network signals as input and output variables of an FMU.</p>
</div>
<div class="paragraph">
<p><br>
</p>
</div>
<div class="paragraph">
<p>Copyright &#169; 2022 The Modelica Association Project FMI.</p>
</div>
<div class="paragraph">
<p>This document is licensed under the Attribution-ShareAlike 4.0 International license.
The code is released under the 2-Clause BSD License.
The licenses text can be found in the <a href="https://raw.githubusercontent.com/modelica/fmi-standard/master/LICENSE.txt">LICENSE.txt</a> file that accompanies this distribution.</p>
</div>
<div class="paragraph">
<p></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_intent_of_this_document">1.1. Intent of This Document</h3>
<div class="paragraph">
<p>Automotive CAN, LIN, FlexRay, CAN FD, CAN XL and Ethernet are network technologies that have been applied successfully over many years by all automotive OEMs world wide.
Virtualizing electronic control units (ECUs) and then simulating multiple such virtual ECUs requires connecting them using a virtual version of these network technologies.</p>
</div>
<div class="paragraph">
<p>This layered standard defines what input and output variables and which FMI 3.0 features are used and how to emulate a transport layer for such network traffic.
At this point it should be explicitly mentioned that this layered standard not only relates to automotive buses, but can also be extended to buses from other domains in the future.</p>
</div>
<div class="paragraph">
<p>There are mainly two base use cases envisioned here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Physical signal abstraction ("high cut") to simply transport physical signal values between virtual ECUs.<br>
The network properties are largely idealized: infinite bandwidth, zero-delay etc.
Signals, groups of signals and their properties <em>(e.g., units)</em> are usually derived from (existing and validated) standard network topology description formats <em>(such as DBC, LDF, Fibex and ARXML)</em>.</p>
</li>
<li>
<p>Network abstraction ("low cut") to realize virtualized bus driver implementations <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>.<br>
This transport layer emulation allows anything from idealized to more detailed network simulations, including bandwidth restrictions, message arbitration and delays.
It forwards the network payloads using binary variables.
The "low cut" abstraction layer is meant to allow virtualized bus driver implementations, including feedback from the physical drivers about transmission status or network node states.
Since the network abstraction layer is protocol-independent, it can also be used for the simulation of non-automotive control units, <em>e.g., from the field of industrial automation</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So that this layered standard can be supported in a variety of FMU importers and other types of simulators three possible communication architectures for bus communication are specified:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Direct Communication: Limited to exactly two FMUs, a common FMU importer that not require any special features for simulating buses, apart from supporting FMI variables, clocks and terminals can be use to emulate bus communication.</p>
</li>
<li>
<p>Composition with dedicated Bus Simulation FMU: A separate Bus Simulation FMU is used to simulate the specific bus behavior.
Other FMUs that want to emulate bus communication provide and relate network information via this Bus Simulation FMU.
This communication architecture can be operated by a common FMU importer and allows complex and detailed bus simulations.</p>
</li>
<li>
<p>Importer with Integrated Bus Simulation: Works analogously to the Composition with dedicated Bus Simulation FMU architecture, whereby the Bus Simulation FMU is directly integrated into an importer or other simulator.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_read_this_document">1.2. How to Read This Document</h3>
<div class="paragraph">
<p>Conventions used in this document:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Non-normative text is given in square brackets in italic font: <em>[Especially examples are defined in this style.]</em></p>
</li>
<li>
<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a> (regardless of formatting and capitalization).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_remarks">1.3. Remarks</h3>
<div class="paragraph">
<p>This layered standard currently only refers to the FMI for Co-Simulation (CS).
At the current time, Model Exchange (ME) and Scheduled Execution (SE) are not taken into account.
All explanations in this document are therefore to be understood in the context of FMI for Co-Simulation (CS).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_layered_standard_manifest_file">2. Layered Standard Manifest File</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This layered standard defines requires the use of a layered standard manifest file and <a href="#table-schema-fmi-ls-bus-attributes">Table 1</a> shows the content of <code>fmi-ls-manifest.xml</code>.</p>
</div>
<table id="table-schema-fmi-ls-bus-attributes" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Attribute Details.</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Namespace</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi-ls-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>http://fmi-standard.org/fmi-ls-manifest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.fmi-standard.fmi-ls-bus</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the layered standard in reverse domain name notation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi-ls-version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>http://fmi-standard.org/fmi-ls-manifest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.0.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version of the layered standard. This layered standard uses semantic versioning, as defined in <a href="#PW13">[PW13]</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi-ls-description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>http://fmi-standard.org/fmi-ls-manifest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Layered Standard for the simulation of bus communication on a signal or network abstraction based level.</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String with a brief description of the layered standard that is suitable for display to users.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>An example of a manifest file for this layered standard is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;fmiLayeredStandardManifest
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="../../schema/fmi3LayeredStandardBusManifest.xsd"
	xmlns:fmi-ls="http://fmi-standard.org/fmi-ls-manifest"
	fmi-ls:fmi-ls-name="org.fmi-standard.fmi-ls-bus"
	fmi-ls:fmi-ls-version="1.0.0"
	fmi-ls:fmi-ls-description="Layered Standard for the simulation of bus communication on a signal or network abstraction based level."/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The manifest file shall be stored inside the FMU at the following path: <code>/extra/org.fmi-standard.fmi-ls-bus/fmi-ls-manifest.xml</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_common_concepts">3. Common Concepts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Physical signal abstraction ("high cut") and network abstraction ("low cut") layers represent different levels for the exchange of bus messages.
Physical signal abstraction focuses primarily on the exchange of signal values, while network abstraction provides a complete way of implementing a virtual bus driver.
Depending on the exporting tool, one of the abstraction layers is more "natural" to the FMU, while the other might have to be emulated with additional internal effort or an adapter (FMU) could be used.
Importers on the other hand rarely require both abstraction layers for system level compositions, because the engineering tasks define the required level of abstraction for the network communication.
FMUs may choose to only support one abstraction layer providing only the corresponding variables.
However, for versatility, having FMUs capable of communicating on both abstraction layers is more convenient for users.</p>
</div>
<div class="paragraph">
<p><em>[FMUs providing both abstraction layers can deduce from the fmi3Set() and fmi3Get() calls they receive, which abstraction layer the importer is using.]</em></p>
</div>
<div class="paragraph">
<p>Since network communication is not continuous but time discrete, FMI 3.0 clocks are used to indicate when signals and/or frames are sent or received.
All signal and frame variables are clocked variables.</p>
</div>
<div class="paragraph">
<p>FMI 3.0 terminal definitions in the <code>terminalsAndIcons.xml</code> for each level of grouping (networks, frames and PDUs) allow system composition tools without knowledge of the network description format to semantically group signals.
To uniquely map between the FMU variables and the network variables, FMU variable names are structured, e.g., <code>BusName::FrameName::PDUName::SignalName</code> for the "high cut" and simply <code>BusName</code> for the "low cut".</p>
</div>
<div id="figure-terminal-relations" class="imageblock text-center">
<div class="content">
<img src="images/terminal_relations.svg" alt="terminal relations" width="60%">
</div>
<div class="title">Figure 1. Relations between Bus-, Frame- and PDU Terminals.</div>
</div>
<div class="paragraph">
<p>All variables have structured names that indicate how these variables are related and to which abstraction layer they belong.
For the high cut, variables represent signals and their clocks.
For the low cut, variables represent send and receive bus traffic and their respective clocks.
Input and output variables show if these variables belong to signals or bus traffic that are received or sent, respectively.
Input clocks must be triggered and are connected by the importer to their corresponding output clocks of potentially different clock types.
For example, a periodic output clock indicates that the FMU can only send signals or frames periodically, while a countdown clock indicates that the FMU can send signals at varying time steps.</p>
</div>
<div class="paragraph">
<p>Using output clocks of different types allows simulations with different timing accuracy and performance.
Some clock types allow the FMU to specify the next send event efficiently and accurately, the importer will trigger these clocks according to these clock specifications as accurately as it can.</p>
</div>
<div class="paragraph">
<p><em>[The alternative of using <code>nextEventTime</code> would force epsilon matching of event times.]</em></p>
</div>
<div class="paragraph">
<p>For any periodic (fixed-time) sending of messages, multiple message sends fall into one <code>doStep</code>.
While high cut signal variables will miss all but the last value sent, low cut frame variables will buffer all payloads inside their value.</p>
</div>
<div class="paragraph">
<p>If triggered output clocks are used, the importer must take create care to schedule and potentially roll-back FMUs that have advanced their doStep past such a (surprising) triggered clock activation from another FMU.
It is strongly recommended to avoid using triggered output clocks and to instead use time-base clocks to avoid these complications and potential performance problems.</p>
</div>
<div class="paragraph">
<p>If an FMU represents network nodes that are both sender and receiver of a signal, the receiver role will be removed from the FMU interface to allow the signals to have a unique role as output and the reading of such outputs must be handled internally to the FMU.</p>
</div>
<div class="paragraph">
<p><em>[The FMI standard requires a variable to be either input or output.]</em></p>
</div>
<div class="paragraph">
<p>While the values and semantic of the clock variables are clear, the binary frame variables are opaque to the importer but have internal structure to implement the transport mechanism of the specific network technology.
Frame variables do not just transport the network-specific payload, but also carry protocol-specific status information.
Status information allows, for example, the MCAL emulation of a virtual ECU to report back to the COM-stack about success or errors of a send request.</p>
</div>
<div class="sect2">
<h3 id="SystemCompositions">3.1. System Compositions</h3>
<div class="paragraph">
<p>Overall, this standard considers three possible communication architectures for bus communication.
It should be explicitly noted at this point that the FMUs for integration in the respective use case do not necessarily have to be different, so that the same FMU can be integrated across all three communication architectures.
The interface of the FMU to the importer is always the same, but a different subset of the features is actually used.</p>
</div>
<div class="sect3">
<h4 id="DirectCommunication">3.1.1. Direct Communication</h4>
<div class="paragraph">
<p>The first option is to use a common FMU importer.
Within this configuration, the FMU importer does not require any special features for simulating buses, apart from supporting FMI variables, clocks and terminals.
The figure below illustrates the direct communication of two FMUs:</p>
</div>
<div id="figure-direct-communication-of-two-fmus" class="imageblock text-center">
<div class="content">
<img src="images/architecture_direct_connection.svg" alt="architecture direct connection" width="50%">
</div>
<div class="title">Figure 2. Direct communication of two FMUs.</div>
</div>
<div class="paragraph">
<p>Direct bus communication is limited to exactly two FMUs.
The simulation of bus communication between more than two FMUs is not possible in such a naive way.
The bus simulation is also only idealized, so that the simulation of bus transmission times or arbitration, for example, is not supported.
Such an ideal network differs from physical networks in the following ways (and potentially others):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Network frame arbitration: frames are sent on the wire according to network-specific priority rules.<br>
Here all frames are transmitted at the same time without delay.</p>
</li>
<li>
<p>Network congestion/bandwidth: too many network frames sent for the bandwidth of the network.<br>
Here the network has infinite capacity.</p>
</li>
<li>
<p>Protocol functions of higher levels: <em>e.g. CAN request for retransmit is a specific protocol function</em>.<br>
Here such specialties must be handled by a higher layer inside the FMU.</p>
</li>
<li>
<p>Incoming buffer overflow: when an ECU receives more frames than its buffer can hold.<br>
Here the FMU will receive all frames, regardless of buffer size and would need to handle those limitations internally.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="Composition-with-dedicated-Bus-Simulation-FMU">3.1.2. Composition with dedicated Bus Simulation FMU</h4>
<div class="paragraph">
<p>If more realistic network properties are required, a bus simulation component must be added.</p>
</div>
<div class="paragraph">
<p>One option is to connect FMUs to a dedicated Bus Simulation FMU.
The Bus Simulation FMU is used to simulate the bus behavior and differs depending on the bus type (e.g., for CAN, LIN, Ethernet or FlexRay).
For example, it is used to simulate the transmission time or the failure of bus messages.
A Bus Simulation FMU must provide enough bus terminals for all FMUs that are interconnected via a bus.
The implementation of a Bus Simulation FMU can be dynamic or static, potentially generated by a tool.
<a href="#network-abstraction">Chapter 5</a> explains the topic of binary protocol data within the bus terminal variables in more detail.
Because the Bus Simulation FMU can provide the described functionality, all FMUs that want to transmit bus messages send their messages to the Bus Simulation FMU.
The Bus Simulation FMU can then acknowledge, delay or even reject messages and forwards messages to recipients accordingly.
Also in this case, the FMU importer does not require any special features for bus simulation, apart from supporting FMI variables, clocks and terminals.
The figure below shows two FMUs which are connected to a specific Bus Simulation FMU.
The total of three FMUs are executed on a common FMI 3.0 importer.</p>
</div>
<div id="figure-external-bus-simulation-fmu" class="imageblock text-center">
<div class="content">
<img src="images/architecture_bus_simulation_fmu.svg" alt="architecture bus simulation fmu" width="50%">
</div>
<div class="title">Figure 3. Bus simulation by using a dedicated Bus Simulation FMU.</div>
</div>
<div class="paragraph">
<p>This type of communication allows the simulation of all bus features, such as arbitration or the simulation of timing.
The supported bus features cannot be specified explicitly in the case shown, but refers to a specific implementation of a Bus Simulation FMU and are depending on the requirements of the bus simulation.
This communication architecture enables complex bus simulations to be implemented on lightweight FMU importers.
An n:m bus communication of several FMUs is also permitted.
Depending on the needs, it may be necessary to dynamically provision the Bus Simulation FMU so that it provides the appropriate number of inputs and outputs to allow all FMUs to be connected.</p>
</div>
</div>
<div class="sect3">
<h4 id="BusFeatureIntegratedFmuSimulator">3.1.3. Importer with Integrated Bus Simulation</h4>
<div class="paragraph">
<p>In the third variant of the communication architecture, the bus simulation is built directly into the respective importer.
The supported bus features are analogous to the <a href="#Composition-with-dedicated-Bus-Simulation-FMU">Composition with dedicated Bus Simulation FMU</a> use case.
The corresponding limitations regarding the behavior of the bus simulation are importer-specific.
The following figure illustrates two FMUs, which are integrated by an importer that directly supports this standard and needs no further Bus Simulation FMU.</p>
</div>
<div id="figure-bus-feature-integrated-fmu-simulator" class="imageblock text-center">
<div class="content">
<img src="images/architecture_bus_simulation_importer.svg" alt="architecture bus simulation importer" width="50%">
</div>
<div class="title">Figure 4. Bus simulation by using an importer with internal bus simulation support.</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_physical_signal_abstraction_high_cut">4. Physical Signal Abstraction ("high cut")</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview">4.1. Overview</h3>
<div class="paragraph">
<p>Physical Signal Abstraction allows an idealized exchange of unit-based variables between FMUs.
In AUTOSAR, this would be equivalent to the Virtual Function Bus.
Variables are clocked to reflect the timing aspects of the information flow.
Changes to these clocked variables always reach the destination.</p>
</div>
</div>
<div class="sect2">
<h3 id="_variables">4.2. Variables</h3>
<div class="paragraph">
<p>This section explains the different variable types used to carry network traffic through FMI input and output variables.</p>
</div>
<div class="sect3">
<h4 id="_signal_variables">4.2.1. Signal Variables</h4>
<div class="paragraph">
<p>To define the signal abstraction layer (or "high cut"), signal variables are defined.</p>
</div>
<div class="paragraph">
<p>A signal variable carries the physical value of a network signal normally packaged inside a PDU or frame.
The unit definition of the variable must match the one defined in the <a href="#NetworkDescriptionFile">network description file</a>, if provided.</p>
</div>
<div class="paragraph">
<p>Each network signal must be listed as <a href="#TerminalMemberVariable">Terminal Member Variable</a> of its corresponding <a href="#PDUTerminal">PDU terminal</a>.</p>
</div>
<div class="paragraph">
<p>In case multiplexed signals are present in a frame/PDU/container PDU: all signals/PDUs are present, but only the active signal according to the multiplex switch signal contains a valid value, all inactive variables have undefined values <em>[those values could even be outside their specified min-max range without fault]</em>.</p>
</div>
<div class="paragraph">
<p>Generally, signal variables are optional, but they must either be all missing or all present to clearly indicate support for the signal abstraction layer.</p>
</div>
<div class="paragraph">
<p>All signal variables are clocked to exactly indicate when they have been sent, see <a href="#ClockVariableHighCut">Section 4.2.2</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="ClockVariableHighCut">4.2.2. Clock Variables</h4>
<div class="paragraph">
<p>In order to use FMU input and output variables as transport layer for networks, input and output clocks are used.
Such a clock is scheduled by the sending FMU to indicate the transmission of the corresponding frame or frames.</p>
</div>
<div class="paragraph">
<p>The output clock type, periodic or aperiodic, is defined by the sending FMU.
This allows the FMU (or better the exporting tool) to balance the accuracy and performance of its network communication:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>While aperiodic clocks allow very accurate network simulations, frequently entering Event Mode will reduce the network simulation speed.</p>
</li>
<li>
<p>Using periodic clocks reduces the number of Event Modes required and speeds up the simulation at the cost of simulation accuracy, because timing must be forced into a fixed grid and some intermediate values might not be transmitted.</p>
</li>
<li>
<p>One could use (structural) parameters to define the accuracy of aperiodic clocks, allowing control of the simulation accuracy and performance with the same FMU.</p>
</li>
<li>
<p>The input clocks shall be triggered clocks.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The importer will then connect and merge output clock activations, even those of different clock types, and forwards them to the input clocks, as required by the network semantics.</p>
</div>
<div class="paragraph">
<p>Signal variables belonging to frame <code>BusName::FrameName</code> are triggered by the clock <code>BusName::FrameName_Clock</code> and all these variables and their corresponding clock must share the same <code>causality</code> (<code>input</code> or <code>output</code>).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="NetworkDescriptionFile">4.3. Network Description Files</h3>
<div class="paragraph">
<p>Standardized <a href="#NetworkDescriptionFile">network description files</a> may optionally be shipped with each FMU to describe properties of signals and frames, such as signal units, frame composition and trigger conditions.
If these <a href="#NetworkDescriptionFile">network description files</a> are shipped, they must be placed into the <code>/extra/org.fmi-standard.fmi-ls-bus</code> folder.
DBC, LDF, Fibex and ARXML files are allowed, e.g., <code>Powertrain.dbc</code>.
The case sensitive root name of the <a href="#NetworkDescriptionFile">network description file</a> must be used as network identifier in the bus terminal type and prefix in the variable names.</p>
</div>
<div class="paragraph">
<p>Multiple files can be specified, each one defining one network used by the FMU.
This standard does not support composing one network from multiple <a href="#NetworkDescriptionFile">network description files</a>, even if using internal include mechanisms, it rather enforces the rule: one network - one file.</p>
</div>
<div class="paragraph">
<p>It is recommended to use ARXML over DBC files for CAN whenever possible, because the DBC standard lacks some key frame/PDU properties that were added only later using non-standard extensions with different dialects in use.</p>
</div>
<div class="paragraph">
<p>This document does not address potential open points of these description formats, it is assumed that such ambiguities will be handled elsewhere (e.g., message timing in the DBC format).
This document does not address IP protection or copyright issues.
These are technical and legal issues that need attention from standardization bodies of the referenced description formats, tool vendors and end users.</p>
</div>
</div>
<div class="sect2">
<h3 id="_terminal_definitions">4.4. Terminal Definitions</h3>
<div class="sect3">
<h4 id="BUSTerminalHighCut">4.4.1. Bus Terminal</h4>
<div class="paragraph">
<p>Each network connected to the FMU must be described in <code>icons/terminalsAndIcons.xml</code> as a <code>&lt;Terminal&gt;</code> element of <code>&lt;fmiTerminalsAndIcons&gt;&lt;Terminals&gt;</code> that wraps all <a href="#FrameTerminal">frame terminals</a>.
The attribute <code>name</code> of the <code>&lt;Terminal&gt;</code> must match the root name of its <a href="#NetworkDescriptionFile">network description file</a> if it exists
<em>[e.g., <code>Powertrain</code>, if the file is <code>/extra/org.fmi-standard.fmi-ls-bus/Powertrain.dbc</code>]</em>.
In any case, the attribute <code>name</code> of the <code>&lt;Terminal&gt;</code> must be consistent with the <code>BusName</code> component of all its corresponding signal, frame and clock variables.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Attribute definitions</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>terminalKind</code> must be set to <code>bus</code>.</p>
</li>
<li>
<p><code>matchingRule</code> must be set to <code>bus</code>.</p>
</li>
<li>
<p><code>name</code> is the network name, e.g., <code>Powertrain</code>, see <a href="#ExampleHighCut">ExampleHighCut</a> and constraints above.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Element definitions</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>There must be no <code>&lt;TerminalStreamMemberVariable&gt;</code> element.</p>
</li>
<li>
<p>There must be one <code>&lt;Terminal&gt;</code> element per network frame described in the <a href="#NetworkDescriptionFile">network description file</a>, if their signal and lock variables are present in the <code>modelDescription.xml</code>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Annotation element</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>There must be an <code>&lt;Annotation&gt;</code> element defining which node or nodes (as comma-separated list without spaces) of the <a href="#NetworkDescriptionFile">network description file</a> are wrapped inside the FMU.
If the combination of nodes specified for this FMU turns a frame and its signals into both input and output because sending and receiving nodes are specified, only the sending (output) role will be defined in the FMU interface.
Receiving such frames must then be handled internally to the FMU.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="FrameTerminal">4.4.2. Frame Terminal</h4>
<div class="paragraph">
<p>Each frame listed in the <a href="#NetworkDescriptionFile">network description file</a> must be an element of its corresponding <a href="#BUSTerminalHighCut">bus terminal</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Attribute definitions</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>terminalKind</code> must be set to <code>frame</code>.</p>
</li>
<li>
<p><code>matchingRule</code> must be set to <code>bus</code>.</p>
</li>
<li>
<p><code>name</code> must match the frame name as defined in the <a href="#NetworkDescriptionFile">network description file</a> in <code>/extra/org.fmi-standard.fmi-ls-bus</code>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Element definitions</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>There must be no <code>&lt;TerminalStreamMemberVariable&gt;</code> element.</p>
</li>
<li>
<p>There must be one <a href="#PDUTerminal">PDU terminal</a> element per PDU of this frame.</p>
</li>
<li>
<p>There must be one <code>&lt;TerminalMemberVariable&gt;</code> for the clock this frame is connected to.
The name of this variable is composed as <a href="#ClockVariable"><code>BusName::FrameName_Clock</code></a>, e.g., <code>Powertrain::tcuSensors_Clock</code>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The <a href="#TerminalMemberVariable">Terminal Member Variable</a> must have the same causality as all variables referenced in the <a href="#PDUTerminal">PDU Terminals</a> included here.</p>
</div>
</div>
<div class="sect3">
<h4 id="PDUTerminal">4.4.3. PDU Terminal</h4>
<div class="paragraph">
<p>Each PDU listed in the <a href="#NetworkDescriptionFile">network description file</a> must be an element of its corresponding <a href="#FrameTerminal">frame terminal</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Attribute definitions</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>terminalKind</code> must be set to <code>pdu</code>.</p>
</li>
<li>
<p><code>matchingRule</code> must be set to <code>bus</code>.</p>
</li>
<li>
<p><code>name</code> must match a PDU name of the <a href="#NetworkDescriptionFile">network description file</a> in <code>/extra/org.fmi-standard.fmi-ls-bus</code>, if given.
For network types not natively referencing a "PDU", like CAN, a synthetic PDU with the same name as its frame is inserted.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Element definitions</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>There must be no <code>&lt;TerminalStreamMemberVariable&gt;</code> element.</p>
</li>
<li>
<p>There must be no <code>&lt;Terminal&gt;</code> element.</p>
</li>
<li>
<p>There must be one <code>&lt;TerminalMemberVariable&gt;</code> per <a href="#TerminalMemberVariable">signal</a> of this PDU.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>All <a href="#TerminalMemberVariable"><code>TerminalMemberVariables</code></a> must have the same causality of either <code>input</code> or <code>output</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="TerminalMemberVariable">4.4.4. Terminal Member Variable for Signals</h4>
<div class="paragraph">
<p><a href="#PDUTerminal">PDU terminals</a> list all the contained signals as <code>&lt;TerminalMemberVariable&gt;</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Attribute definitions</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>variableName</code> refers to the input or output variable name of the FMU and to enforce uniqueness is built as follows: <code>BusName::FrameName::PDUName::SignalName</code>, e.g., <code>Powertrain::tcuSensors::tcuSensors::vCar</code>.
These variables represent the signal abstraction layer ("high cut").</p>
</li>
<li>
<p><code>memberName</code> is the <code>SignalName</code> as given in the <a href="#NetworkDescriptionFile">network description file</a>, e.g., <code>vCar</code>, if given.
This is redundant information but simplifies signal name extraction.</p>
</li>
<li>
<p><code>variableKind</code> is <code>signal</code>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ExampleHighCut">4.4.5. Example</h4>
<div class="paragraph">
<p>The following excerpts from files are used throughout this document as examples and should illustrate how the different concepts relate.</p>
</div>
<div class="paragraph">
<p>The following partial DBC file lists merely the CAN message (frame) structure.
Signal trigger conditions are not included because they have no bearing on this standard.</p>
</div>
<div id="Powertrain" class="listingblock dbc">
<div class="title">Example Powertrain.dbc file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">...
BO_ 256 tcuSensors: 4 TCU
 SG_ vCar :          0|16@1- (32,0)  [-500|500] "km/h" ECU
 SG_ oilTemp :      16|9@1-  (2,50)  [-50|150]  "Degree C" ECU

BO_ 257 tcuState: 2 TCU
 SG_ state :         0|2@1+  (1,0)   [ 0|2] "-" ECU
 SG_ gear :          2|4@1-  (1,0)   [-2|6] "-" ECU
 SG_ targetGear :    6|4@1-  (1,0)   [-2|6] "-" ECU

BO_ 512 ecuState: 4 ECU
 SG_ accelPedal :    0|8@1+ (2,0)   [0|100]   "%" TCU
 SG_ k15 :           8|1@1+ (1,0)   [0|1]     "-" TCU
 SG_ oilTemp :       9|9@1- (2,50)  [-50|150] "Degree C" TCU
 SG_ radiatorTemp : 18|9@1- (2,50)  [-50|150] "Degree C" TCU
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>modelDescription.xml</code> excerpt listed below shows which variables would exist for the <code>Powertrain.dbc</code> shown above.</p>
</div>
<div id="modelDescriptionHighCut" class="listingblock xml">
<div class="title">Example modelDescription.xml for ECU node</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;fmiModelDescription fmiVersion="3.0" modelName="Network4FMI"
    instantiationToken="Network4FMI"&gt;
  &lt;ModelVariables&gt;
    &lt;Clock   name="Powertrain::tcuSensors_Clock"                 valueReference="1007"
        causality="input" variability="discrete" interval="triggered"/&gt;
    &lt;Float64 name="Powertrain::tcuSensors::tcuSensors::vCar"     valueReference="1005"
        causality="input" variability="discrete" start="0"  clocks="1007"/&gt;
    &lt;Float64 name="Powertrain::tcuSensors::tcuSensors::oilTemp"  valueReference="1006"
        causality="input" variability="discrete" start="20" clocks="1007"/&gt;

    &lt;Clock   name="Powertrain::tcuState_Clock"                   valueReference="1011"
        causality="input" variability="discrete" interval="triggered"/&gt;
    &lt;Float64 name="Powertrain::tcuState::tcuState::state"        valueReference="1008"
        causality="input" variability="discrete" start="0" clocks="1011"/&gt;
    &lt;Float64 name="Powertrain::tcuState::tcuState::gear"         valueReference="1009"
        causality="input" variability="discrete" start="0" clocks="1011"/&gt;
    &lt;Float64 name="Powertrain::tcuState::tcuState::targetGear"   valueReference="1010"
        causality="input" variability="discrete" start="0" clocks="1011"/&gt;

    &lt;Clock   name="Powertrain::ecuState_Clock"                   valueReference="1016"
        causality="output" variability="discrete" interval="triggered"/&gt;
    &lt;Float64 name="Powertrain::ecuState::ecuState::accelPedal"   valueReference="1012"
        causality="output" variability="discrete" start="0" clocks="1016"/&gt;
    &lt;Float64 name="Powertrain::ecuState::ecuState::k15"          valueReference="1013"
        causality="output" variability="discrete" start="0" clocks="1016"/&gt;
    &lt;Float64 name="Powertrain::ecuState::ecuState::oilTemp"      valueReference="1014"
        causality="output" variability="discrete" start="0" clocks="1016"/&gt;
    &lt;Float64 name="Powertrain::ecuState::ecuState::radiatorTemp" valueReference="1015"
        causality="output" variability="discrete" start="0" clocks="1016"/&gt;
  &lt;/ModelVariables&gt;
  &lt;ModelStructure&gt;
  &lt;/ModelStructure&gt;
&lt;/fmiModelDescription&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following file shows the <code>&lt;Terminal&gt;</code> definition representing the network and frame structure defined with <code>Powertrain.dbc</code> above.</p>
</div>
<div id="terminalsAndIconHighCut" class="listingblock xml">
<div class="title">Example terminalsAndIcons.xml file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;fmiTerminalsAndIcons fmiVersion="3.0"&gt;
  &lt;Terminals&gt;
    &lt;Terminal terminalKind="bus" name="Powertrain" matchingRule="bus"
        description="Powertrain CAN bus defined with dbc file"&gt;
      &lt;Terminal terminalKind="frame" name="tcuSensors" matchingRule="bus"&gt;
        &lt;TerminalMemberVariable variableKind="signal"
          variableName="Powertrain::tcuSensors_Clock" /&gt;
        &lt;Terminal terminalKind="pdu" name="tcuSensors" matchingRule="bus"&gt;
          &lt;TerminalMemberVariable variableKind="signal"
            variableName="Powertrain::tcuSensors::tcuSensors::vCar" memberName="vCar" /&gt;
          &lt;TerminalMemberVariable variableKind="signal"
            variableName="Powertrain::tcuSensors::tcuSensors::oilTemp" memberName="oilTemp" /&gt;
        &lt;/Terminal&gt;
      &lt;/Terminal&gt;
      &lt;Terminal terminalKind="frame" name="tcuState" matchingRule="bus"&gt;
        &lt;TerminalMemberVariable variableKind="signal"
          variableName="Powertrain::tcuState_Clock" /&gt;
        &lt;Terminal terminalKind="pdu" name="tcuState" matchingRule="bus"&gt;
          &lt;TerminalMemberVariable variableKind="signal"
            variableName="Powertrain::tcuState::tcuState::state" memberName="state" /&gt;
          &lt;TerminalMemberVariable variableKind="signal"
            variableName="Powertrain::tcuState::tcuState::gear" memberName="gear" /&gt;
          &lt;TerminalMemberVariable variableKind="signal"
            variableName="Powertrain::tcuState::tcuState::targetGear" memberName="targetGear" /&gt;
        &lt;/Terminal&gt;
      &lt;/Terminal&gt;
      &lt;Terminal terminalKind="frame" name="ecuState" matchingRule="bus"&gt;
        &lt;TerminalMemberVariable variableKind="signal"
          variableName="Powertrain::ecuState_Clock" /&gt;
        &lt;Terminal terminalKind="pdu" name="ecuState" matchingRule="bus"&gt;
          &lt;TerminalMemberVariable variableKind="signal"
            variableName="Powertrain::ecuState::ecuState::accelPedal" memberName="accelPedal" /&gt;
          &lt;TerminalMemberVariable variableKind="signal"
            variableName="Powertrain::ecuState::ecuState::k15" memberName="k15" /&gt;
          &lt;TerminalMemberVariable variableKind="signal"
            variableName="Powertrain::ecuState::ecuState::oilTemp" memberName="oilTemp" /&gt;
          &lt;TerminalMemberVariable variableKind="signal"
            variableName="Powertrain::ecuState::ecuState::radiatorTemp" memberName="radiatorTemp" /&gt;
        &lt;/Terminal&gt;
      &lt;/Terminal&gt;
      &lt;Annotations&gt;
        &lt;Annotation type="ECU" /&gt;
      &lt;/Annotations&gt;
    &lt;/Terminal&gt;
  &lt;/Terminals&gt;
&lt;/fmiTerminalsAndIcons&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="network-abstraction">5. Network Abstraction ("low cut")</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes the Network Abstraction or "low cut" in detail.</p>
</div>
<div class="sect2">
<h3 id="_overview_2">5.1. Overview</h3>
<div class="paragraph">
<p>The network abstraction allows the implementation of virtual bus drivers within FMUs on the level of the hardware abstraction layer.
Exchanging data in terms of the <a href="#Overview-Layered-Standard-Bus-Protocol">Layered Standard Bus Protocol</a> via variables grouped by a dedicated bus terminal (see <a href="#ClockVariableLowCut">Section 5.3.1</a>), allows the implementation of bus simulations in a wide range from idealized up to detailed behavior, including e.g., timing, arbitration, error, status and other effects.
During simulation, the network communication is controlled by send and receive bus operations.
Based on these operations, Network FMUs have to react as specified by this layered standard depending on their role.
This role can be a Bus Simulation FMU or an importer with bus simulation support on one side, and Network FMUs (e.g., virtual ECUs) on the other side (see <a href="#SystemCompositions">System Compositions</a>).
The Layered Standard Bus Protocol in general is bus-type-specific, but has some similarities.
Bus communication often follows a Transmit/Confirm pattern, where a Network FMU sends a Transmit operation containing the network message as payload.
Depending on the <a href="#SystemCompositions">System Composition</a>, the importer forwards the Transmit operation either directly to receiving FMUs or to a dedicated bus simulation.
The Bus Simulation then might delay the transfer of the Transmit operation to the receiving FMUs to simulate timing behavior, before sending a bus-specific Confirm operation back to the sending FMU.</p>
</div>
<div id="figure-transmission-overview" class="imageblock text-center">
<div class="content">
<img src="images/transmit_messages.svg" alt="transmit messages" width="50%">
</div>
<div class="title">Figure 5. Transmission overview.</div>
</div>
<div class="paragraph">
<p>The point in time at which FMUs will (potentially) send new network messages can be given to the importer in advance with the proper clock type.
Based on these times, the importer has to calculate the next <code>communicationStepSize</code> for all networked FMUs.
For simulating bus communication with timing effects, the FMUs should set the Co-Simulation attribute <code>canHandleVariableCommunicationStepSize = "true"</code>.</p>
</div>
<div id="figure-transmission-example-with-timing-behavior" class="imageblock text-center">
<div class="content">
<img src="images/bus_simulation_example.svg" alt="bus simulation example" width="80%">
</div>
<div class="title">Figure 6. Example for network simulation with timing behavior.</div>
</div>
<div class="paragraph">
<p>For simplification reasons or if a detailed bus simulation is not desired, fixed-step size FMUs can also be used with Network Abstraction.
However, depending on the chosen simulation step-size, delay effects of the bus simulation have to be taken into account.
Compositions with fixed-step size and variable-step size FMUs require the decoupling of the Bus Simulation logic and the Bus Simulation timing.
This decoupling is realized by queuing Tx/Rx bus operations inside the Bus Simulation as well as queuing Tx bus operations inside Network FMUs.
By queuing bus operations, System Compositions with variable-step size FMUs as well as fixed-step size FMUs can be simulated together without affecting each other.</p>
</div>
</div>
<div class="sect2">
<h3 id="Overview-Layered-Standard-Bus-Protocol">5.2. Layered Standard Bus Protocol</h3>
<div class="paragraph">
<p>The Layered Standard Bus Protocol allows the transmission of bus operations between FMUs in binary form via clocks and clocked variables (see <a href="#NetworkAbstractionVariables">Variables</a>).
Depending on the role (Network or Bus Simulation), FMUs have to respond to received operations as specified by this layered standard.
Operations and the reaction on receipt are bus-type-specific and therefore described in the bus-specific chapters.
However, the description follows a uniform structure and consists of two parts, an overview table and a detailed description of all operations.</p>
</div>
<div class="paragraph">
<p>The overview table represents the binary format of operations and is structured as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OP Code: The operation code defines the unique value of the operation.
It consists of one byte in length.</p>
</li>
<li>
<p>Total Length: A four byte total data length (OP Code + Total Length + Arguments) field following the OP Code.<a id="TotalLengthField"></a>
For operation with variable size arguments, the total length can vary in value at runtime.</p>
</li>
<li>
<p>Arguments: The arguments of the respective operation.
The number of arguments is defined for each operation within this standard.
For arguments with a variable length, an argument pair composed of length and data is used.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following table shows an example of an operation definition.
The name is <em>OperationName</em> and has the OP Code 0x01.
The operation has three arguments <em>Arg1</em> (2 bytes long), <em>Arg2_Length</em> (1 byte long), <em>Arg2_Data</em> (<em>&lt;Arg2Length&gt;</em> bytes long), whereby argument 2 and argument 3 form a coherent variable length argument.</p>
</div>
<table id="table-operation-definition" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Definition of an operation within the Layered Standard Bus Protocol.</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Operation Type</p></th>
<th class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">Operation Content</p></th>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">OP Code</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Total Length</p></th>
<th class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Specific Content</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OperationName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7 + &lt;Arg2_Length&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte Arg1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte Arg2_Length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;Arg2_Length&gt; byte Arg2_Data</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Additionally, all operations are described separately in detail in the following structure:</p>
</div>
<table id="table-operation-definition-example" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Operation example within the Layered Standard Bus Protocol.</caption>
<colgroup>
<col style="width: 15.625%;">
<col style="width: 12.5%;">
<col style="width: 9.375%;">
<col style="width: 62.5%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Name</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Name of the operation <em>(e.g., OperationName)</em></p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Contains a description of the specified operation.</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">OP Code [hex]</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">OP code of the operation <em>(e.g., 0x01)</em></p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top" rowspan="6"><p class="tableblock">Content</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Argument</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Length</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP Code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the OP Code of the specified operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total Length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the cumulative length of all arguments in bytes.
The following applies for this operation: <code>Total Length = 7 + &lt;Arg2_Length&gt;</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arg1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The first argument of the operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arg2_Length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the length of the Arg2_Data argument in bytes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arg2_Data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The second argument of the operation.</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Behavior</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Describes the behavior of a Network FMU and the Bus Simulation in the context of this operation.
<em>e.g., The specified operation shall be produced by a Network FMU and consumed by the Bus Simulation.</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Remarks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Numbers shall be transmitted with <code>little-endian</code> byte order.</p>
</li>
<li>
<p>Since the standard allows to concatenate multiple operations (see <a href="#CommunicationVariable">Tx/Rx Data Variables</a>), the <a href="#TotalLengthField">Total Length</a> field was introduced to allow the implementation of a generic parser for received operations.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="Format-Error-Operation">5.2.1. Format Error</h4>
<div class="paragraph">
<p>The Format Error operation is independent from the bus type and shall be used when encountering a syntax or content error of received operations.</p>
</div>
<table id="table-format-error-operation" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Detailed description of the Format Error operation.</caption>
<colgroup>
<col style="width: 15.625%;">
<col style="width: 12.5%;">
<col style="width: 9.375%;">
<col style="width: 62.5%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Name</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Format Error</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Represents a generic format operation error, which can be initiated by every operation.
This error shall be used when generally encountering a problem with the syntax or content of an operation.</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">OP Code [hex]</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">0x01</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock">Content</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Argument</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Length</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP Code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the OP Code of the specified operation.
For this operation, the OP Code always has the value 0x01 within all bus types.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total Length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the cumulative length of all arguments in bytes.
The following applies for this operation: <code>Total Length = 5 + Length of Data argument in bytes</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores the complete binary data of the operation that caused the specified format error.</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Behavior</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The specified operation shall be produced and consumed by Network FMUs and the Bus Simulation.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Basic-Type-Definitions">5.2.2. Basic Type Definitions</h4>
<div class="paragraph">
<p>The following basic types are defined for this standard, which apply to all supported buses.
These basic types are used in the bus-specific parts within the operation definitions as operation arguments.</p>
</div>
<div class="paragraph">
<p>The following values for the boolean basic type are defined:</p>
</div>
<table id="table-boolean-value-kinds" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Overview of the available boolean values.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 12.5%;">
<col style="width: 62.5%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Value</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FALSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Describes the boolean value: False.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Describes the boolean value: True.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="NetworkAbstractionVariables">5.3. Variables</h3>
<div class="paragraph">
<p>This section explains how layered standard bus protocol operations are sent and received by FMUs using FMI 3.0 clock and clocked variables <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup>.
While the former (see <a href="#ClockVariableLowCut">Tx/Rx Clock Variables</a>) are used for scheduling and time synchronization, the latter (see <a href="#CommunicationVariable">Tx/Rx Data Variables</a>) are used to carry the layered standard bus protocol operations in binary form.
To summarize, four variables with the following name schema are used:</p>
</div>
<div class="paragraph">
<p>The input variable <code>BusName::Rx_Data</code> is clocked by the clock variable <code>BusName::Rx_Clock</code>, both with <code>causality</code> set to <code>input</code>.</p>
</div>
<div class="paragraph">
<p>The output variable <code>BusName::Tx_Data</code> is clocked by the clock variable <code>BusName::Tx_Clock</code>, both with <code>causality</code> set to <code>output</code>.</p>
</div>
<div class="paragraph">
<p>Both variable pairs must be listed as member of its corresponding <a href="#BUSTerminalLowCut">Bus Terminal</a>.
How to set the <code>BusName</code> placeholder is bus-type-specific and therefore described in the bus-specific chapters.</p>
</div>
<div class="sect3">
<h4 id="ClockVariableLowCut">5.3.1. Tx/Rx Clock Variables</h4>
<div class="paragraph">
<p>As described in the FMI 3.0 specification, clock variables are used to synchronize events between importer and across FMUs.
Since clock variables are strictly related to the <code>Event Mode</code>, networked FMUs shall set the Co-Simulation attribute <code>hasEventMode = "true"</code> in the model description file.</p>
</div>
<div class="paragraph">
<p>For simulating bus communication according to the Network Abstraction, a time-based clock is used for the <code>Tx_Clock</code> variable to signal the point in time when layered standard bus operations must be transferred by the importer to the receiver FMUs.
It is up to the implementer to either use a <code>periodic</code> or <code>aperiodic</code> clock.</p>
</div>
<div class="paragraph">
<p>This allows the FMU (or better the exporting tool) to balance the accuracy and performance of its network communication:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>While aperiodic clocks allow very accurate network simulations, frequently entering <code>Event Mode</code> will reduce the network simulation speed.</p>
</li>
<li>
<p>Using periodic clocks and queuing the operations to be transmitted reduces the number of <code>Event Mode</code> entries and speeds up the simulation at the cost of simulation accuracy.</p>
</li>
<li>
<p>One could use (structural) parameters to define the accuracy of aperiodic clocks, allowing control of the simulation accuracy and performance with the same FMU.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The input clocks (<code>Rx_Clock</code>) shall be triggered clocks.</p>
</div>
<div class="paragraph">
<p>The importer will then connect and merge output clock activations, even those of different clock types, and forward them to the input clocks, as required by the network semantics.</p>
</div>
<div class="sect4">
<h5 id="bus-communication-points">5.3.1.1. Bus Communication Points</h5>
<div class="paragraph">
<p>For transferring bus operations from the <code>Tx_Data</code> to the <code>Rx_Data</code> variables, networked FMUs must be synchronous in time.
This point in time is also referred to as the Bus Communication Point.
The importer must ensure that networked FMUs hit such points synchronously by calling <code>fmi3DoStep</code> with a proper <code>communicationStepSize</code> argument.
To determine the <code>communicationStepSize</code> for the first simulation step, the importer gets the Tx clock time in <code>Initialization Mode</code> as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For aperiodic Tx clocks, the importer calls <code>fmi3GetInterval</code>.</p>
</li>
<li>
<p>For periodic Tx clocks, the importer shall evaluate the clock attributes (e.g., <code>intervalDecimal</code>) as defined in the model description.
If <code>intervalDecimal</code> is not defined, the importer shall call <code>fmi3GetShift</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Based on the Tx clock intervals received in the <code>Initialization Mode</code>, the importer calls <code>fmi3DoStep</code> with a determined <code>communicationStepSize</code> to reach the next Bus Communication Point.
After returning from <code>fmi3DoStep</code>, the importer has to enter the <code>Event Mode</code> by calling <code>fmi3EnterEventMode</code>.
In <code>Event Mode</code>, the importer activates the Tx and Rx clock by calling <code>fmi3SetClock</code>.
The importer then starts to transfer bus operations from the <code>Tx_Data</code> to the <code>Rx_Data</code> variable (see <a href="#CommunicationVariable">Communication Variables</a>).</p>
</div>
<div class="paragraph">
<p>To determine the <code>communicationStepSize</code> for the next simulation step, the importer gets the Tx clock time as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For aperiodic Tx clocks, the importer calls <code>fmi3GetInterval</code>.</p>
</li>
<li>
<p>For periodic Tx clocks, the importer shall evaluate the clock attributes as defined in the model description.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If an FMU wants to respond to a received bus operation in the same time step, then <code>fmi3GetInterval</code> must return 0.
In this case, the importer remains in <code>Event Mode</code> and starts a new iteration.
If an FMU does not know the next Tx clock time for any reason, <code>fmi3GetInterval</code> shall return with <code>qualifier = fmi3IntervalNotYetKnown</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="CommunicationVariable">5.3.2. Tx/Rx Data Variables</h4>
<div class="paragraph">
<p>The Tx/Rx variables are of type <code>fmi3Binary</code> and contain multiple bus operations, as sent or receive by the FMU.
If no bus operations shall be sent by a specified Network FMU at a given Bus Communication Point, the size of the corresponding binary <code>Tx_Data</code> variable shall be set to zero.
The senders can choose how many bus operations are buffered and/or for how long operations are buffered before activating an output clock to trigger the actual sending of these operations.
This allows senders to trade accuracy for speed: buffering more and interrupting the simulation less will lead to faster simulations, but less accurate timing of the network communication.</p>
</div>
</div>
<div class="sect3">
<h4 id="_mime_types">5.3.3. MIME Types</h4>
<div class="paragraph">
<p>Within FMI, every binary FMI variable has a <code>mimeType</code>, which indicates the type of data passed as a binary.
This type indicates which specific bus type is involved.
It ensures that only bus types of the same type can be interconnected, since FMI only allows the connection of two MIME types of the same binary variables.
The following table lists the names of MIME types used for the Tx/Rx data variables:</p>
</div>
<table id="table-mime-types" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Overview of the available MIME types for the supported several bus types.</caption>
<colgroup>
<col style="width: 44.4444%;">
<col style="width: 55.5556%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">MIME type name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.fmi-standard.fmi-ls-bus.v1.can</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binary variables simulating the automotive CAN network including CAN, CAN FD and CAN XL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.fmi-standard.fmi-ls-bus.v1.lin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binary variables simulating the automotive LIN network</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.fmi-standard.fmi-ls-bus.v1.flexray</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binary variables simulating the automotive FlexRay network</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.fmi-standard.fmi-ls-bus.v1.ethernet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binary variables simulating the automotive Ethernet network</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.fmi-standard.fmi-ls-bus.v1.spi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binary variables simulating the automotive SPI network</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>As in the table, above the version of a specified bus type is integrated within the MIME type.
The MIME type and the associated versioning ensure that only compatible bus types can be connected to each other.
The version number marks the set of available operations.
Only the major version is included by the specified MIME type.
The versioning follows the rules of semantic versioning, as defined in <a href="#PW13">[PW13]</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_terminal_definitions_2">5.4. Terminal Definitions</h3>
<div class="paragraph">
<p>This section defines terminals for network abstraction or low cut.</p>
</div>
<div class="sect3">
<h4 id="BUSTerminalLowCut">5.4.1. Bus Terminal</h4>
<div class="paragraph">
<p>Each network connected to the FMU must be described in <code>icons/terminalsAndIcons.xml</code> as a <code>&lt;Terminal&gt;</code> element of <code>&lt;fmiTerminalsAndIcons&gt;&lt;Terminals&gt;</code>.
The attribute <code>name</code> of the <code>&lt;Terminal&gt;</code> must match the name of the specified network <em>[e.g., the name of the CAN channel: Powertrain]</em> within a low cut.
If the specified FMU is connected to more than one network, there shall be exactly one <code>&lt;Terminal&gt;</code> for each network.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Attribute definitions</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>terminalKind</code> must be set to <code>bus</code>.</p>
</li>
<li>
<p><code>matchingRule</code> must be set to <code>bus</code>.</p>
</li>
<li>
<p><code>name</code> is the network name, e.g., <code>Powertrain</code>, see <a href="#ExampleLowCut">Example</a> and constraints.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Element definitions</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>BusName::Rx_Data</code> and <code>BusName::Tx_Data</code> and their clocks <code>BusName::Rx_Clock</code> and <code>BusName::Tx_Clock</code> are exposed in the <code>modelDescription.xml</code>, they must be listed as <code>&lt;TerminalMemberVariable&gt;</code> elements here.</p>
</li>
<li>
<p>There must be no <code>&lt;TerminalStreamMemberVariable&gt;</code> element.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The <a href="#figure-frame-variables-terminals-lowcut">following figure</a> shows a FMU with four variables <code>Tx_Data</code>, <code>Tx_Clock</code>, <code>Rx_Data</code>, <code>Rx_Clock</code> that are aggregated to a <code>&lt;Terminal&gt;</code> named <em>Bus Terminal</em>:</p>
</div>
<div id="figure-frame-variables-terminals-lowcut" class="imageblock text-center">
<div class="content">
<img src="images/bus_terminal.svg" alt="bus terminal" width="30%">
</div>
<div class="title">Figure 7. Frame variables and terminals.</div>
</div>
</div>
<div class="sect3">
<h4 id="ExampleLowCut">5.4.2. Example</h4>
<div class="paragraph">
<p>The following excerpts from files are used throughout this document as examples and illustrate how the different concepts relate.</p>
</div>
<div id="modelDescriptionLowCut" class="listingblock xml">
<div class="title">Example modelDescription.xml for ECU node</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;fmiModelDescription fmiVersion="3.0" modelName="Network4FMI"
    instantiationToken="Network4FMI"&gt;
  &lt;ModelVariables&gt;
    &lt;Clock name="Powertrain::Rx_Clock" valueReference="1002"
        causality="input" variability="discrete" interval="triggered"/&gt;
    &lt;Binary name="Powertrain::Rx_Data" valueReference="1001" causality="input"
        mimeType="org.fmi-standard.fmi-ls-bus.v1.can" variability="discrete" clocks="1002"/&gt;
    &lt;Clock name="Powertrain::Tx_Clock" valueReference="1004"
        causality="output" variability="discrete" interval="aperiodic"/&gt;
    &lt;Binary name="Powertrain::Tx_Data" valueReference="1003" causality="output"
        mimeType="org.fmi-standard.fmi-ls-bus.v1.can" variability="discrete" clocks="1004"/&gt;
  &lt;/ModelVariables&gt;
  &lt;ModelStructure&gt;
  &lt;/ModelStructure&gt;
&lt;/fmiModelDescription&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following file shows the <code>&lt;Terminal&gt;</code> related definition:</p>
</div>
<div id="terminalsAndIconLowCut" class="listingblock xml">
<div class="title">Example terminalsAndIcons.xml file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;fmiTerminalsAndIcons fmiVersion="3.0"&gt;
  &lt;Terminals&gt;
    &lt;Terminal terminalKind="bus" name="Powertrain" matchingRule="bus"
        description="Powertrain CAN bus terminal definition"&gt;
      &lt;TerminalMemberVariable variableKind="signal"
        variableName="name="Powertrain"::Rx_Clock" /&gt;
      &lt;TerminalMemberVariable variableKind="signal"
        variableName="name="Powertrain"::Rx_Data" /&gt;
      &lt;TerminalMemberVariable variableKind="signal"
        variableName="name="Powertrain"::Tx_Clock" /&gt;
      &lt;TerminalMemberVariable variableKind="signal"
        variableName="name="Powertrain"::Tx_Data" /&gt;
      &lt;/Terminal&gt;
    &lt;/Terminal&gt;
  &lt;/Terminals&gt;
&lt;/fmiTerminalsAndIcons&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="BusTypeSpecificDetails">5.5. Bus-Specific Details</h3>
<div class="paragraph">
<p>For each supported bus type, the <a href="#Overview-Layered-Standard-Bus-Protocol">Layered Standard Bus Protocol</a> is defined.
This chapter describes the operations of the <a href="#Overview-Layered-Standard-Bus-Protocol">Layered Standard Bus Protocol</a> to enable the simulation of supported bus types.</p>
</div>
<div class="sect3">
<h4 id="_can_can_fd_can_xl">5.5.1. CAN, CAN FD, CAN XL</h4>
<div class="paragraph">
<p>This chapter describes the <a href="#Overview-Layered-Standard-Bus-Protocol">Layered Standard Bus Protocol</a> for CAN, CAN FD and CAN XL.
The various CAN standards CAN, CAN FD and CAN XL are considered together, because they are very similar and can also be combined in certain scenarios.</p>
</div>
<div class="sect4">
<h5 id="_overview_3">5.5.1.1. Overview</h5>
<div class="paragraph">
<p>To simulate CAN, CAN FD and CAN XL buses, CAN-specific operations are specified based on the <a href="#Overview-Layered-Standard-Bus-Protocol">Layered Standard Bus Protocol</a>.
Overall, the following groups of operations exists:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Transmit: This group of operations is used to simulate a frame transmission.
There are three specializations of this operation, one each for CAN, CAN FD and CAN XL frames.</p>
</li>
<li>
<p>Confirm: An acknowledgment of transmitted CAN frames is defined by the CAN standard.
The confirm operation is used to simulate this behavior.</p>
</li>
<li>
<p>Error: This group of operations is used for protocol format errors and to simulate bus failures.
For example, the failure of a transmission can be indicated.</p>
</li>
<li>
<p>Arbitration Lost: The operation is used by Bus Simulations to inform Network FMUs that a frame could not be transmitted immediately.</p>
</li>
<li>
<p>Configuration: The configuration operation enables the configuration of bus-specific parameters and options that are required to simulate the bus behavior properly.
For example, it allows the specification of the baud rate or influencing the buffer behavior.</p>
</li>
<li>
<p>Status: The Status operation is used by Networked FMUs to inform Bus Simulations about the internal state (Active/Passive/Bus Off) which concerns the reaction on bus errors.</p>
</li>
<li>
<p>Wake up: CAN supports wake up and sleep scenarios.
Normally there are two ways to wake up from sleep mode: a local wake up on a specified wake-up pin, or a wake up on the CAN bus via a CAN specific wake-up pulse.
This operation is used to simulate triggering a wake up from bus side.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following table gives a detailed overview of the available operations.
It shows all operations and the arguments they contain.</p>
</div>
<table id="table-operation-content-can" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Overview of the available operations for CAN, CAN FD and CAN XL.</caption>
<colgroup>
<col style="width: 16.0714%;">
<col style="width: 1.7857%;">
<col style="width: 10.7142%;">
<col style="width: 8.9285%;">
<col style="width: 8.9285%;">
<col style="width: 8.9285%;">
<col style="width: 8.9285%;">
<col style="width: 8.9285%;">
<col style="width: 8.9285%;">
<col style="width: 8.9285%;">
<col style="width: 8.9292%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Operation Name</p></th>
<th class="tableblock halign-left valign-top" colspan="10"><p class="tableblock">Operation Content</p></th>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">OP Code</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Total Length</p></th>
<th class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">Specific Content</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Format Error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">:= 5 + n<br>
(4 byte)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">Data<br>
(n byte)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CAN Transmit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">:= 13 + DL<br>
(4 byte)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID<br>
(4 byte)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ide<br>
(1 byte)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rtr<br>
(1 byte)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DL<br>
(2 byte)</p></td>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Data<br>
(n byte)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CAN FD Transmit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">:= 14 + DL<br>
(4 byte)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID<br>
(4 byte)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ide<br>
(1 byte)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brs<br>
(1 byte)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Esi<br>
(1 byte)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DL<br>
(2 byte)</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Data<br>
(n byte)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CAN XL Transmit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">:= 19 + DL<br>
(4 byte)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID<br>
(4 byte)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ide<br>
(1 byte)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sec<br>
(1 byte)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SDT<br>
(1 byte)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VCID<br>
(1 byte)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AF<br>
(4 byte)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DL<br>
(2 byte)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data<br>
(n byte)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Confirm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">:= 9<br>
(4 byte)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">ID<br>
(4 byte)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arbitration Lost</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">:= 9<br>
(4 byte)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">ID<br>
(4 byte)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bus Error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x31</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">:= 12<br>
(4 byte)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID<br>
(4 byte)</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">Error Code<br>
(1 byte)</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">Error Flag<br>
(1 byte)</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Is Sender<br>
(1 byte)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x40</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;Length&gt;<br>
(4 byte)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kind<br>
(1 byte)</p></td>
<td class="tableblock halign-left valign-top" colspan="7"><p class="tableblock"><em>Dynamic Part</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Status</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x41</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">:= 6<br>
(4 byte)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">Status<br>
(1 byte)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wakeup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x42</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">:= 5<br>
(4 byte)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">---</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_operations">5.5.1.2. Operations</h5>
<div class="paragraph">
<p>This section defines the specified operations for CAN, CAN FD and CAN XL.
The following tables provides an overview of all operations and specifies the position and length of the corresponding arguments, as well as the respective flow direction.</p>
</div>
<div class="sect5">
<h6 id="TransmitOpCodeCanLowCut">5.5.1.2.1. Transmit</h6>
<div class="paragraph">
<p>There are three types of transmit operations for transmission of CAN, CAN FD and CAN XL frame.</p>
</div>
<table id="table-can-transmit-operation" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Detailed description of the CAN Transmit operation.</caption>
<colgroup>
<col style="width: 15.625%;">
<col style="width: 12.5%;">
<col style="width: 9.375%;">
<col style="width: 62.5%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Name</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">CAN Transmit</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Initiates the transmission of CAN frames.</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">OP Code [hex]</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">0x10</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top" rowspan="8"><p class="tableblock">Content</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Argument</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Length</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP Code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the OP Code (0x10) of the operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total Length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the cumulative length of all arguments in bytes.
The following applies for this operation: <code>Total Length = 13 + Data Length</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The specified ID of the CAN message.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ide</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specified whether the ID should be transmitted as standard (11-bit) or extended (29-bit) message identifier.
For specification the boolean values <code>TRUE</code> and <code>FALSE</code> (see <a href="#table-boolean-value-kinds">Table 5</a>) shall be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rtr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies whether the given frame represents a Remote Transmission Request frame.
For specification the boolean values <code>TRUE</code> and <code>FALSE</code> (see <a href="#table-boolean-value-kinds">Table 5</a>) shall be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data Length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the length of the Data argument in bytes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores the given frame data to transfer, whereby the valid length of the data depends on the CAN Format.</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Behavior</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The CAN Transmit operation shall be provided by Network FMUs to initiate the transmission of a CAN frame.
In case of directly connected Network FMUs (see <a href="#DirectCommunication">Section 3.1.1</a>), the FMU importer forwards the operation directly to the receiving Network FMUs.
If a Bus Simulation is involved (see <a href="#Composition-with-dedicated-Bus-Simulation-FMU">Section 3.1.2</a> and <a href="#BusFeatureIntegratedFmuSimulator">Section 3.1.3</a>), the FMU importer forwards the operation initially to the Bus Simulation, where the operation is distributed with respect to the simulated bus behavior.
Depending on the simulation details, the Bus Simulation might respond with a <a href="#ConfirmOpCodeCanLowCut">Confirm</a>, <a href="#ArbitrationLostOpCodeCanLowCut">Arbitration Lost</a>, <a href="#BusErrorOpCodeCanLowCut">Bus Error</a> or <a href="#FormatErrorOpCodeCanLowCut">Format Error</a> operation.
Depending on the <a href="#StatusOpCodeCanLowCut">status</a> of the specified Network FMU further restrictions for CAN Transmit operations <a href="#table-can-status-values">exist</a>.</p></td>
</tr>
</tbody>
</table>
<table id="table-can-fd-transmit-operation" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Detailed description of the CAN FD Transmit operation.</caption>
<colgroup>
<col style="width: 15.625%;">
<col style="width: 12.5%;">
<col style="width: 9.375%;">
<col style="width: 62.5%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Name</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">CAN FD Transmit</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Represents an operation for the transmission of a CAN FD frame.</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">OP Code [hex]</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">0x11</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top" rowspan="9"><p class="tableblock">Content</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Argument</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Length</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP Code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the OP Code (0x11) of the operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total Length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the cumulative length of all arguments in bytes.
The following applies for this operation: <code>Total Length = 12 + Data Length</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The specified ID of the CAN message.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ide</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specified whether the ID should be transmitted as standard (11-bit) or extended (29-bit) message identifier.
For specification the boolean values <code>TRUE</code> and <code>FALSE</code> (see <a href="#table-boolean-value-kinds">Table 5</a>) shall be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the Bit Rate Switch.
For specification the boolean values <code>TRUE</code> and <code>FALSE</code> (see <a href="#table-boolean-value-kinds">Table 5</a>) shall be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Esi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Error State indicator.
For specification the boolean values <code>TRUE</code> and <code>FALSE</code> (see <a href="#table-boolean-value-kinds">Table 5</a>) shall be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data Length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the length of the Data argument in bytes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores the given frame data to transfer, whereby the valid length of the data depends on the CAN FD Format.</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Behavior</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The CAN FD Transmit operation shall be provided by Network FMUs to initiate the transmission of a CAN FD frame.
In case of directly connected Network FMUs (see <a href="#DirectCommunication">Section 3.1.1</a>), the FMU importer forwards the operation directly to the receiving Network FMUs.
If a Bus Simulation is involved (see <a href="#Composition-with-dedicated-Bus-Simulation-FMU">Section 3.1.2</a> and <a href="#BusFeatureIntegratedFmuSimulator">Section 3.1.3</a>), the FMU importer forwards the operation initially to the Bus Simulation, where the operation is distributed with respect to the simulated bus behavior.
Depending on the simulation details, the Bus Simulation might response with a <a href="#ConfirmOpCodeCanLowCut">Confirm</a>, <a href="#ArbitrationLostOpCodeCanLowCut">Arbitration Lost</a>, <a href="#BusErrorOpCodeCanLowCut">Bus Error</a> or <a href="#FormatErrorOpCodeCanLowCut">Format Error</a> operation.
Depending on the <a href="#StatusOpCodeCanLowCut">status</a> of the specified Network FMU further restrictions for CAN FD Transmit operations <a href="#table-can-status-values">exist</a>.</p></td>
</tr>
</tbody>
</table>
<table id="table-can-xl-transmit-operation" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Detailed description of the CAN XL Transmit operation.</caption>
<colgroup>
<col style="width: 15.625%;">
<col style="width: 12.5%;">
<col style="width: 9.375%;">
<col style="width: 62.5%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Name</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">CAN XL Transmit</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Represents an operation for the transmission of a CAN XL frame.</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">OP Code [hex]</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">0x12</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top" rowspan="11"><p class="tableblock">Content</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Argument</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Length</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP Code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the OP Code (0x12) of the operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total Length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the cumulative length of all arguments in bytes.
The following applies for this operation: <code>Total Length = 19 + Data Length</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The specified ID of the CAN message.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ide</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specified whether the ID should be transmitted as standard (11-bit) or extended (29-bit) message identifier.
For specification the boolean values <code>TRUE</code> and <code>FALSE</code> (see <a href="#table-boolean-value-kinds">Table 5</a>) shall be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Simple Extended Content
For specification the boolean values <code>TRUE</code> and <code>FALSE</code> (see <a href="#table-boolean-value-kinds">Table 5</a>) shall be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SDT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Describes the structure of the frames Data Field content (SDU type).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VCID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents the virtual CAN network ID.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents the CAN XL Acceptance Field (AF).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data Length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the length of the Data argument in bytes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores the given frame data to transfer, whereby the valid length of the data depends on the CAN XL Format.</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Behavior</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The CAN XL Transmit operation shall be provided by Network FMUs to initiate the transmission of a CAN XL frame.
In case of directly connected Network FMUs (see <a href="#DirectCommunication">Section 3.1.1</a>), the FMU importer forwards the operation directly to the receiving Network FMUs.
If a Bus Simulation is involved (see <a href="#Composition-with-dedicated-Bus-Simulation-FMU">Section 3.1.2</a> and <a href="#BusFeatureIntegratedFmuSimulator">Section 3.1.3</a>), the FMU importer forwards the operation initially to the Bus Simulation, where the operation is distributed with respect to the simulated bus behavior.
Depending on the simulation details, the Bus Simulation might response with a <a href="#ConfirmOpCodeCanLowCut">Confirm</a>, <a href="#ArbitrationLostOpCodeCanLowCut">Arbitration Lost</a>, <a href="#BusErrorOpCodeCanLowCut">Bus Error</a> or <a href="#FormatErrorOpCodeCanLowCut">Format Error</a> operation.
Depending on the <a href="#StatusOpCodeCanLowCut">status</a> of the specified Network FMU further restrictions for CAN XL Transmit operations <a href="#table-can-status-values">exist</a>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="ConfirmOpCodeCanLowCut">5.5.1.2.2. Confirm</h6>
<div class="paragraph">
<p>The <code>Confirm operation</code> is used to signal the successful reception of a transmitted CAN frame (see <a href="#TransmitOpCodeCanLowCut">Transmit operation</a>) by at least one Network FMU.</p>
</div>
<table id="table-can-confirm-operation" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Detailed description of the Confirm operation.</caption>
<colgroup>
<col style="width: 15.625%;">
<col style="width: 12.5%;">
<col style="width: 9.375%;">
<col style="width: 62.5%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Name</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Confirm</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Signals successful receipt of a transmitted CAN, CAN FD and CAN XL frame to simulate a CAN acknowledgment behavior.</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">OP Code [hex]</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">0x20</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock">Content</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Argument</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Length</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP Code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the OP Code (0x20) of the operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total Length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the cumulative length of all arguments in bytes.
The following applies for this operation: <code>Total Length = 9</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the confirmed CAN message.</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Behavior</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The specified operation shall be produced by the Bus Simulation and consumed by Network FMUs.
If the structural parameter <code>org.fmi_standard.fmi_ls_bus.WaitForBusNotification</code> (see <a href="#bus-notification-parameter">Section 5.5.1.3.1</a>) is set to <code>false</code>, the Network FMU does not rely on receiving Confirm operations.
In this case, Bus Simulations should not send Confirm operations to the Network FMU.
Depending on the <a href="#StatusOpCodeCanLowCut">status</a> of the specified Network FMU further restrictions for Confirm operations <a href="#table-can-status-values">exist</a>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="FormatErrorOpCodeCanLowCut">5.5.1.2.3. Format Error</h6>
<div class="paragraph">
<p>Represents a format error that indicates a syntax or content error of receiving operations.
See <a href="#Format-Error-Operation">Format Error</a> for definition.</p>
</div>
</div>
<div class="sect5">
<h6 id="ArbitrationLostOpCodeCanLowCut">5.5.1.2.4. Arbitration Lost</h6>
<div class="paragraph">
<p>The Arbitration Lost operation defines a feedback message from a Bus Simulation to a Network FMU that a <a href="#TransmitOpCodeCanLowCut">Transmit operation</a> could not be sent immediately due to a concurrent transmit request.</p>
</div>
<table id="table-can-arbitration-lost-error-operation" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. Detailed description of the Arbitration Lost operation.</caption>
<colgroup>
<col style="width: 15.625%;">
<col style="width: 12.5%;">
<col style="width: 9.375%;">
<col style="width: 62.5%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Name</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Arbitration Lost</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The Arbitration Lost operation indicates that a CAN frame could not be sent immediately and was therefore discarded by the Bus Simulation.
See <a href="#CanArbitration">Section 5.5.1.7</a> for further details.</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">OP Code [hex]</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">0x30</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock">Content</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Argument</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Length</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP Code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the OP Code (0x30) of the operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total Length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the cumulative length of all arguments in bytes.
The following applies for this operation: <code>Total Length = 9</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the CAN message which which could not be transmitted immediately, because it loses arbitration.</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Behavior</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">During simulation, several <a href="#TransmitOpCodeCanLowCut">Transmit operations</a> can be sent by Network FMUs to a Bus Simulation at the same time.
In such case, the Bus Simulation has to decide which <a href="#TransmitOpCodeCanLowCut">Transmit operation</a> should proceed first.
Depending on the configuration (see the <code>Arbitration Lost Behavior</code> argument of the <a href="#ConfigurationCanOpCode">Configuration operation</a>), the deferred <a href="#TransmitOpCodeCanLowCut">Transmit operations</a> shall either be buffered or discarded and sending the Arbitration Lost operation back to the respective Network FMUs.
A Network FMU receiving the Arbitration Lost operation can decide to provide the <a href="#TransmitOpCodeCanLowCut">Transmit operation</a> again or e.g., to raise an internal transmit timeout failure after a while.
If the structural parameter <code>org.fmi_standard.fmi_ls_bus.WaitForBusNotification</code> (see <a href="#bus-notification-parameter">Section 5.5.1.3.1</a>) is set to <code>false</code>, the Network FMU does not rely on receiving Arbitration Lost operations.
In this case, Bus Simulations should not send Arbitration Lost operations to the Network FMU.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="BusErrorOpCodeCanLowCut">5.5.1.2.5. Bus Error</h6>
<div class="paragraph">
<p>The Bus Error operation represents special bus communication errors, which are delivered to every participant in the network.</p>
</div>
<table id="table-can-bus-error-operation" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. Detailed description of the Bus Error operation.</caption>
<colgroup>
<col style="width: 15.625%;">
<col style="width: 12.5%;">
<col style="width: 9.375%;">
<col style="width: 62.5%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Name</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Bus Error</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Represents an operation for simulated bus errors.</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">OP Code [hex]</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">0x31</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top" rowspan="7"><p class="tableblock">Content</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Argument</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Length</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP Code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the OP Code (0x31) of the operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total Length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the cumulative length of all arguments in bytes.
The following applies for this operation: <code>Total Length = 12</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the CAN message that was transmitted while the error happened.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Error Code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The simulated bus error, based on <a href="#table-can-error-codes">the table below</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Error Flag</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines whether the Error was detected by a specified Network FMU.
For specification the boolean values <code>PRIMARY_ERROR_FLAG</code> and <code>SECONDARY_ERROR_FLAG</code> (see <a href="#table-can-bus-error-error-flag-kinds">Table 15</a>) shall be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is Sender</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set if the Bus Error operation is a reaction to a <a href="#TransmitOpCodeCanLowCut">Transmit operation</a> that was provided by the specified Network FMU from the Bus Simulation.
For specification the boolean values <code>TRUE</code> and <code>FALSE</code> (see <a href="#table-boolean-value-kinds">Table 5</a>) shall be used.</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Behavior</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">While transmitting CAN frames, various kinds of bus error may happen.
A Bus Simulation can simulate such errors by providing Bus Error operations to the Network FMUs.
Based on consumed Bus Error operations, Network FMUs shall maintain an internal CAN node state (see <a href="#CanErrorHandling">Section 5.5.1.6</a>).
To determine the CAN node state properly, Network FMUs need the information about their role at the time when the simulated error happened.
If a Network FMU is sending, the argument <code>Is Sender</code> shall be set.
If a Network FMU is detecting the error first, the argument <code>Error Flag = PRIMARY_ERROR_FLAG</code> shall be set.
The arguments <code>Is Sender</code> must only be set once per simulated error.
If the structural parameter <code>org.fmi_standard.fmi_ls_bus.WaitForBusNotification</code> (see <a href="#bus-notification-parameter">Section 5.5.1.3.1</a>) is set to <code>false</code>, the Network FMU does not rely on receiving Bus Error operations.
In this case, Bus Simulations should not send Bus Error operations to the Network FMU.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following Error Codes are specified:</p>
</div>
<table id="table-can-error-codes" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. Overview of the available error codes.</caption>
<colgroup>
<col style="width: 4.1666%;">
<col style="width: 12.5%;">
<col style="width: 83.3334%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">State</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Error Code</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BIT_ERROR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Within the CAN standard, the sender also receives transmitted data for comparison.
If the sent and received bits are not identical, this failure results in a Bit Error.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BIT_STUFFING_ERROR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Bit Stuff Error occurs if 6 consecutive bits of equal value are detected on the bus.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FORM_ERROR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Occurs during a violation of End-of-Frame (EOF) format.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CRC_ERROR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x04</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Occurs when the data of a frame and the related checksum do not harmonize.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACK_ERROR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x05</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At least one receiving node identifies an invalid CAN frame.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BROKEN_ERROR_FRAME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x06</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents an invalid transmission of a CAN Error frame.
Within CAN, an Error frame is transmitted by any unit on detection of a bus error.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following values for the Error Flag option are defined:</p>
</div>
<table id="table-can-bus-error-error-flag-kinds" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. Overview of the available Error Flag values.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 12.5%;">
<col style="width: 62.5%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Error Flag</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Value</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRIMARY_ERROR_FLAG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines that a specified Network FMU is detecting the given <a href="#BusErrorOpCodeCanLowCut">Bus Error</a> first.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SECONDARY_ERROR_FLAG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines that a specified Network FMU is reacting on a <a href="#BusErrorOpCodeCanLowCut">Bus Error</a> and does not detect it.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="ConfigurationCanOpCode">5.5.1.2.6. Configuration</h6>
<div class="paragraph">
<p>The <code>Configuration operation</code> is used by Network FMUs to send simulation specific options like baud rate settings to Bus Simulations.
The following information is included within this operation:</p>
</div>
<table id="table-can-configuration-operation" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. Detailed description of the Configuration operation.</caption>
<colgroup>
<col style="width: 11.6279%;">
<col style="width: 2.3255%;">
<col style="width: 23.2558%;">
<col style="width: 9.3023%;">
<col style="width: 6.9767%;">
<col style="width: 46.5118%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Name</p></th>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">Configuration</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">Represents an operation for the configuration of a Bus Simulation.
In detail, the configuration of a CAN, CAN FD and CAN XL baud rate is possible.
Also the configuration of further options, like buffer handling, is supported by this operation.</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">OP Code [hex]</p></th>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">0x40</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top" rowspan="9"><p class="tableblock">Content</p></th>
<th class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Argument</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Length</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">OP Code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the OP Code (0x40) of the operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Total Length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the cumulative length of all arguments in bytes.
The following applies for this operation: <code>Total Length = 6 + Length of parameter arguments in bytes</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Parameter Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the current configuration parameter.
Note that only one parameter can be set per <code>Configuration operation</code>.</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top" rowspan="5"></th>
<th class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Parameters</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CAN_BAUDRATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Baudrate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The CAN baudrate value to configure.
The required unit for the baudrate value is bit/s.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CAN_FD_BAUDRATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Baudrate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The CAN FD baudrate value to configure.
The required unit for the baudrate value is bit/s.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CAN_XL_BAUDRATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Baudrate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The CAN XL baudrate value to configure.
The required unit for the baudrate value is bit/s.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OPTIONS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arbitration Lost Behavior</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This parameter defines how a Bus Simulation shall behave in cases of an arbitration lost scenario.
If the option is set to <code>BUFFER_AND_RETRANSMIT</code>, <a href="#TransmitOpCodeCanLowCut">Transmit operations</a> shall be buffered by the Bus Simulation and no <a href="#ArbitrationLostOpCodeCanLowCut">Arbitration Lost operation</a> shall be sent.
If the option is set to <code>DISCARD_AND_NOTIFY</code>, the <a href="#TransmitOpCodeCanLowCut">Transmit operation</a> shall be discarded and an <a href="#ArbitrationLostOpCodeCanLowCut">Arbitration Lost operation</a> shall be sent to the Network FMU (see <a href="#CanArbitration">Section 5.5.1.7</a>).</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Behavior</p></th>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">The specified operation shall be produced by a Network FMU and consumed by the Bus Simulation.
The operation shall not be routed to other Network FMUs by the Bus Simulation.
A Network FMU shall ignore this operation on the consumer side.
Configuration operations can be produced multiple times during the runtime of a Network FMU.
In context of CAN FD, also a CAN baud rate should be configured by using <code>Parameter Type = CAN_BAUDRATE</code>.
If configuration parameters are not adjusted by a Network FMU, the Bus Simulation shall choose a default behavior by itself.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following configuration parameters are defined:</p>
</div>
<table id="table-can-configuration-kinds" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. Overview of the available configuration parameters.</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 71.4286%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Parameter</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Value</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CAN_BAUDRATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This code indicates that a CAN baud rate should be configured for the Bus Simulation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CAN_FD_BAUDRATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows the configuration of a CAN FD baudrate for the Bus Simulation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CAN_XL_BAUDRATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows the configuration of a CAN XL baudrate for the Bus Simulation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OPTIONS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x04</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This code configures various available options for the Bus Simulation.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following values for the Arbitration Lost Behavior option are defined:</p>
</div>
<table id="table-can-configuration-arbitration-lost-behavior-kinds" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18. Overview of the available Arbitration Lost Behavior values.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 12.5%;">
<col style="width: 62.5%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Arbitration Lost Behavior</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Value</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BUFFER_AND_RETRANSMIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#TransmitOpCodeCanLowCut">Transmit operations</a> shall be buffered by the Bus Simulation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DISCARD_AND_NOTIFY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#TransmitOpCodeCanLowCut">Transmit operations</a> shall be discarded and the specified Network FMU shall be notified by the Bus Simulation via an <a href="#ArbitrationLostOpCodeCanLowCut">Arbitration Lost operation</a>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="StatusOpCodeCanLowCut">5.5.1.2.7. Status</h6>
<div class="paragraph">
<p>By using the <code>Status operation</code>, a Network FMU can communicate the current CAN node state to the Bus Simulation.
The following information is included within this operation:</p>
</div>
<table id="table-can-status-operation" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 19. Detailed description of the Status operation.</caption>
<colgroup>
<col style="width: 15.625%;">
<col style="width: 12.5%;">
<col style="width: 9.375%;">
<col style="width: 62.5%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Name</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Status</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Represents an operation for status handling.</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">OP Code [hex]</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">0x41</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock">Content</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Argument</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Length</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP Code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the OP Code (0x41) of the operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total Length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the cumulative length of all arguments in bytes.
The following applies for this operation: <code>Total Length = 6</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Status</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The specified status code, based on <a href="#table-can-status-values">the table below</a>.</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Behavior</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The specified operation shall be produced by Network FMUs and consumed by the Bus Simulation.
The operation shall not be routed to other Network FMUs by the Bus Simulation.
A Network FMU shall ignore this operation on the consumer side.
A Network FMU shall report its status to the Bus Simulation after it changes.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following status values can be used:</p>
</div>
<table id="table-can-status-values" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 20. Overview of the available status values.</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 71.4286%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Kind</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Value</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERROR_ACTIVE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that a simulated CAN controller within the Network FMU has currently the CAN node state: ERROR ACTIVE.
If required status is not adjusted by a Network FMU, the Bus Simulation shall choose <code>ERROR_ACTIVE</code> by itself for a specified Network FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERROR_PASSIVE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that a simulated CAN controller within the Network FMU has currently the CAN node state: ERROR PASSIVE.
This node state is relevant for arbitration, because <code>ERROR_ACTIVE</code> and <code>ERROR_PASSIVE</code> nodes requires different prioritization.
See <a href="#CanArbitration">Section 5.5.1.7</a> for further details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BUS_OFF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that a simulated CAN controller within the Network FMU has currently the CAN node state: BUS OFF.
If a Network FMU communicates the status <code>BUS_OFF</code> to the Bus Simulation, the specified Network FMU shall not provide any new <a href="#TransmitOpCodeCanLowCut">Transmission operations</a> to the Bus Simulation.
If all Network FMUs, except the <a href="#TransmitOpCodeCanLowCut">Transmit operation</a> initiating Network FMU, communicate the status <code>BUS_OFF</code>, the Bus Simulation shall not provide a <a href="#ConfirmOpCodeCanLowCut">confirmation</a>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="WakeupCanOpCode">5.5.1.2.8. Wake Up</h6>
<div class="paragraph">
<p>By using the <code>Wakeup operation</code>, the underlying Bus Simulation can trigger a bus-specific wake up.</p>
</div>
<table id="table-can-wakeup-operation" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 21. Detailed description of the Wakeup operation.</caption>
<colgroup>
<col style="width: 15.625%;">
<col style="width: 12.5%;">
<col style="width: 9.375%;">
<col style="width: 62.5%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Name</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Wakeup</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Represents an operation for triggering a bus-specific wake up.</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">OP Code [hex]</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">0x42</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">Content</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Argument</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Length</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP Code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the OP Code (0x42) of the operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total Length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the cumulative length of all arguments in bytes.
The following applies for this operation: <code>Total Length = 5</code>.</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Behavior</p></th>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The specified operation shall be produced by a Network FMU and distributed to all participants, except the wake-up initiator, of the bus using the Bus Simulation.
If a Network FMU does not support wake up, this operation can be ignored on the consumer side.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect4">
<h5 id="can-network-parameters">5.5.1.3. Network Parameters</h5>
<div class="paragraph">
<p>Using structural parameters, FMUs can be parameterized according to importer specifications.
This chapter specifies the structural parameters that each CAN-specific FMU shall provide.</p>
</div>
<div class="sect5">
<h6 id="bus-notification-parameter">5.5.1.3.1. Bus Notification Parameter</h6>
<div class="paragraph">
<p>For a detailed simulation, the CAN bus behavior regarding acknowledgment, bus errors and arbitration losses must be considered.
A Bus Simulation can simulate this effect by sending bus notifications in terms of <a href="#ConfirmOpCodeCanLowCut">Confirm</a>-, <a href="#BusErrorOpCodeCanLowCut">Bus Error</a>- and <a href="#ArbitrationLostOpCodeCanLowCut">Arbitration Lost operations</a> to the Network FMUs.
However, in cases where Network FMUs are connected directly or if a Bus Simulation does not simulate such effects, a Network FMU shall not receive these operations.</p>
</div>
<div class="paragraph">
<p>In order to inform Network FMUs not to rely on bus notifications, the importer can set the <code>org.fmi_standard.fmi_ls_bus.WaitForBusNotification</code> parameter to <code>false</code>, which also shall be the default value.
Only if the Bus Simulation either supports <a href="#ConfirmOpCodeCanLowCut">Confirm</a>-, <a href="#BusErrorOpCodeCanLowCut">Bus Error</a>- or <a href="#ArbitrationLostOpCodeCanLowCut">Arbitration Lost operations</a>, <code>org.fmi_standard.fmi_ls_bus.WaitForBusNotification</code> shall be set to <code>true</code>.</p>
</div>
<div id="figure-fmu-bus-notifications-parameter" class="listingblock">
<div class="title">FMU parameter for the configuration of bus notifications.</div>
<div class="content">
<pre>    org.fmi_standard.fmi_ls_bus.WaitForBusNotification
        Description:  "Specifies whether the respective Network FMU relies on bus notifications."
        Type:         Boolean
        Causality:    structuralParameter
        Variability:  fixed
        Start:        "false"</pre>
</div>
</div>
<div class="paragraph">
<p>This structural parameter shall only be available for Network FMUs.
A Bus Simulation (FMU) does not require this structural parameter.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_of_bus_simulation">5.5.1.4. Configuration of Bus Simulation</h5>
<div class="paragraph">
<p>The configuration of the Bus Simulation is done by the Network FMUs itself.
For this purpose, the <a href="#ConfigurationCanOpCode">Configuration operation</a> provides several configuration parameters.
<a href="#ConfigurationCanOpCode">Configuration operations</a> can be produced multiple times during the runtime of a Network FMU.
Because the Bus Simulation shall choose a default behavior, it might be useful in several scenarios that Network FMUs finish configuration before the production of <a href="#TransmitOpCodeCanLowCut">Transmit operations</a>.</p>
</div>
<div class="sect5">
<h6 id="_baudrate_handling">5.5.1.4.1. Baudrate Handling</h6>
<div class="paragraph">
<p>In order to calculate the time required for the transmission of a bus message, it is necessary to inform the Bus Simulation about the specified baud rate from a Network FMU.
This baud rate information can be configured by using <code>CAN_BAUDRATE</code>, <code>CAN_FD_BAUDRATE</code> and <code>CAN_XL_BAUDRATE</code> configuration kind of the <a href="#ConfigurationCanOpCode">Configuration operation</a>.
In a CAN FD scenario, both the configuration for <code>CAN_BAUDRATE</code> and for <code>CAN_FD_BAUDRATE</code> shall be carried out if the CAN FD bit rate switch feature is used.
Otherwise the configuration of <code>CAN_BAUDRATE</code> is sufficient for CAN FD.
The Bus Simulation can derive the required CAN, CAN FD or CAN XL controller type from the baud rate configurations a Network FMU carried out.
If the baud rate information is not adjusted by a specified Network FMU, the Bus Simulation shall choose a default behavior by itself.</p>
</div>
</div>
<div class="sect5">
<h6 id="_buffer_handling">5.5.1.4.2. Buffer Handling</h6>
<div class="paragraph">
<p>By using the <code>OPTIONS</code> configuration kind of a <a href="#ConfigurationCanOpCode">Configuration operation</a>, the buffer handling within the Bus Simulation can be adjusted.
Using buffer handling is required in arbitration scenarios only and will be described <a href="#CanArbitration">within this context</a>.
If the buffering is not adjusted by a specified Network FMU, the Bus Simulation shall choose a default behavior by itself.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_transmission_and_acknowledge">5.5.1.5. Transmission and Acknowledge</h5>
<div class="paragraph">
<p>The <a href="#TransmitOpCodeCanLowCut">Transmit operation</a> represents the sending of a CAN, CAN FD and CAN XL frame.
With appropriate options, relevant functionalities can be configured and used on a network abstraction level (e.g., Virtual CAN network ID for CAN XL or Bit Rate Switch for CAN FD).
In the real world, flawlessly transmitted CAN frames will be acknowledged by at least one receiver CAN node.
To simulate this behavior, the <a href="#ConfirmOpCodeCanLowCut">Confirm operations</a> were introduced.
In addition to support lightweight bus simulations and <a href="#DirectCommunication">directly connected Network FMUs</a>, the structural parameter <code>org.fmi_standard.fmi_ls_bus.WaitForBusNotification</code> (see <a href="#bus-notification-parameter">Section 5.5.1.3.1</a>) has been defined.</p>
</div>
<div class="paragraph">
<p>If <code>org.fmi_standard.fmi_ls_bus.WaitForBusNotification</code> is set to <code>false</code> (default), then Network FMUs shall not rely on receiving <a href="#ConfirmOpCodeCanLowCut">Confirm operations</a>.
In this case, the bus simulation is idealized and takes place in a fire-and-forget manner.
If a specified Network FMU is depending on <a href="#ConfirmOpCodeCanLowCut">Confirm operations</a> and <code>org.fmi_standard.fmi_ls_bus.WaitForBusNotification</code> is set to <code>false</code>, the self confirmation shall be realized internally within the respective Network FMU.</p>
</div>
<div class="paragraph">
<p><a href="#figure-can-direct-communication">Figure 8</a> illustrates this communication, whereby FMU 1 transmits network data to FMU 2.
After that, the transmission is directly confirmed by FMU 1 itself, whereby FMU 1 handles that self confirmation internally.</p>
</div>
<div id="figure-can-direct-communication" class="imageblock text-center">
<div class="content">
<img src="images/can_direct_confirmation.svg" alt="can direct confirmation" width="40%">
</div>
<div class="title">Figure 8. Direct Confirmation of transmitted network data.</div>
</div>
<div class="paragraph">
<p>For a detailed simulation, Bus Simulations shall support <a href="#ConfirmOpCodeCanLowCut">Confirm operations</a>.
In this case, the <code>org.fmi_standard.fmi_ls_bus.WaitForBusNotification</code> parameter of the Network FMUs shall be set to <code>true</code> and Network FMUs can rely on receiving <a href="#ConfirmOpCodeCanLowCut">Confirm operations</a>.</p>
</div>
<div class="paragraph">
<p>The following <a href="#figure-can-confirmation-with-bus-simulation-fmu">Figure 9</a> illustrates the behavior, whereby FMU 1 transmits network data to FMU 2 via a Bus Simulation.</p>
</div>
<div id="figure-can-confirmation-with-bus-simulation-fmu" class="imageblock text-center">
<div class="content">
<img src="images/can_confirmation_with_bus_simulation_fmu.svg" alt="can confirmation with bus simulation fmu" width="70%">
</div>
<div class="title">Figure 9. Confirmation of transmitted network data via Bus Simulation.</div>
</div>
<div class="paragraph">
<p>If all Network FMUs, except the <a href="#TransmitOpCodeCanLowCut">Transmit operation</a> initiating Network FMU, communicate the <a href="#StatusOpCodeCanLowCut">status</a> <code>BUS_OFF</code>, the Bus Simulation shall not provide a <a href="#ConfirmOpCodeCanLowCut">confirmation</a>.</p>
</div>
<div class="paragraph">
<p><a href="#example-can-possible-results-of-transmission">Section 5.5.1.9.1</a> contains an example of the possible transmission results and displays them in the form of a diagram.</p>
</div>
</div>
<div class="sect4">
<h5 id="CanErrorHandling">5.5.1.6. Error Handling</h5>
<div class="paragraph">
<p>The CAN protocol includes a sophisticated fault confinement mechanism to prevent malfunctioning within CAN nodes.
A Transmit Error Counter (TEC) and a Receive Error Counter (REC) represent a historical communication quality metric.
To maintain the TEC and REC values, <a href="#BusErrorOpCodeCanLowCut">Bus Error operations</a> shall be provided to all Network FMUs by the Bus Simulation.
The argument <code>Is Sender</code> shall be set to <code>TRUE</code> for the Network FMU that the <a href="#TransmitOpCodeCanLowCut">Transmit operation</a> originated from.
The argument <code>Error Flag</code> shall be set to <code>PRIMARY_ERROR_FLAG</code> if the Network FMU detects the transmission error.
If a Network FMU changes its current CAN node state, the <a href="#StatusOpCodeCanLowCut">Status operation</a> shall be provided to the Bus Simulation.
When a Network FMU has provided the status <code>BUS_OFF</code> to the Bus Simulation, then it also shall not provide any new <a href="#TransmitOpCodeCanLowCut">Transmit operations</a> to the Bus Simulation to simulate a real bus off behavior.</p>
</div>
<div id="figure-can-architectural-error-handling-overview" class="imageblock text-center">
<div class="content">
<img src="images/can_error_handling_overview.svg" alt="can error handling overview" width="100%">
</div>
<div class="title">Figure 10. Architectural error handling overview.</div>
</div>
<div class="paragraph">
<p><a href="#example-can-error-handling">Section 5.5.1.9.4</a> contains a detailed overview about the CAN error handling.
Additionally, a rule set showing how to implement correct CAN error handling based on this standard with respect to the arguments of the <a href="#BusErrorOpCodeCanLowCut">Bus Error operation</a> is shown.</p>
</div>
</div>
<div class="sect4">
<h5 id="CanArbitration">5.5.1.7. Arbitration</h5>
<div class="paragraph">
<p>Arbitration is an instrument of the CAN standard to resolve the conflict of the simultaneous sending of messages from several CAN nodes without a collision.
The arbitration is handled in the Bus Simulation and can be recognized by the fact that the Bus Simulation receives a <a href="#TransmitOpCodeCanLowCut">Transmit operation</a> from several FMUs at the same time.
As soon as an arbitration is lost, an <a href="#ArbitrationLostOpCodeCanLowCut">Arbitration Lost operation</a> shall be returned to the respective sender within the next <code>Event Mode</code> step.
As soon as an FMU loses arbitration in this way, it shall independently repeat the corresponding <a href="#TransmitOpCodeCanLowCut">Transmit operation</a>.</p>
</div>
<div id="figure-can-arbitration" class="imageblock text-center">
<div class="content">
<img src="images/can_arbitration.svg" alt="can arbitration" width="70%">
</div>
<div class="title">Figure 11. Arbitration of two transmissions at the same time.</div>
</div>
<div class="paragraph">
<p>Within a <a href="#ConfigurationCanOpCode">Configuration operation</a>, the <code>Arbitration Lost Behavior</code> argument can be specified.
Once this option is set to <code>BUFFER_AND_RETRANSMIT</code>, the Bus Simulation buffers the frame after losing arbitration and sends it as soon as possible.
In this case, it is not necessary for the Network FMU to trigger the respective frame to be sent again and an <a href="#ArbitrationLostOpCodeCanLowCut">Arbitration Lost operation</a> shall not be returned to the specific Network FMU.
If the <code>Arbitration Lost Behavior</code> is set to <code>DISCARD_AND_NOTIFY</code>, the specified Network FMU is informed by an <a href="#ArbitrationLostOpCodeCanLowCut">Arbitration Lost operation</a> and needs to repeat the corresponding <a href="#TransmitOpCodeCanLowCut">Transmit operation</a> itself.
Arbitration is available in communication cases with Bus Simulation only.</p>
</div>
<div class="paragraph">
<p>In the case of arbitration, the Bus Simulation must also take the status of the respective Network FMU into account, which is communicated via a <a href="#StatusOpCodeCanLowCut">Status operation</a>.
To simulate the behavior of the CAN Extra Suspend Transmission Time when a CAN node is in Error Passive state, the Bus Simulation shall prefer Network FMUs whose status is <code>ERROR_ACTIVE</code> (see <a href="#table-can-status-values">Table 20</a>).</p>
</div>
<div class="paragraph">
<p><a href="#example-can-arbitration-with-arbitration-lost-behavior">Section 5.5.1.9.2</a> and <a href="#example-can-arbitration-without-arbitration-lost-behavior">Section 5.5.1.9.3</a> contain examples of the presented arbitration cases and visualize them in the form of sequence diagrams.</p>
</div>
</div>
<div class="sect4">
<h5 id="_wake_upsleep">5.5.1.8. Wake Up/Sleep</h5>
<div class="paragraph">
<p>This standard supports wake up and sleep for the CAN bus, whereby only the bus-specific parts are taken into account.
This means that the realization of local virtual ECU wake-up and sleeping processes are internal parts of the respective FMU, which is not covered by this document.
Because entering sleep state is a virtual ECU internal process always within CAN bus, this can be ignored.
Also, the virtual ECU local wake-up process is ignored as well.
The CAN-specific wake-up pulse can be simulated by using the <a href="#WakeupCanOpCode">Wakeup operation</a>.
A <a href="#WakeupCanOpCode">Wakeup operation</a> is initiated by one Network FMU and shall be distributed to all participants of the bus,except the wake-up initiator, by the Bus Simulation.</p>
</div>
<div id="figure-can-wake-up" class="imageblock text-center">
<div class="content">
<img src="images/can_wake_up.svg" alt="can wake up" width="70%">
</div>
<div class="title">Figure 12. Wake up initiated by FMU 1 wakes up FMU 2 and FMU 3 via bus.</div>
</div>
</div>
<div class="sect4">
<h5 id="_examples">5.5.1.9. Examples</h5>
<div class="paragraph">
<p>This section contains sample sequences to clarify the facts in the CAN part.</p>
</div>
<div class="sect5">
<h6 id="example-can-possible-results-of-transmission">5.5.1.9.1. Transmission</h6>
<div class="paragraph">
<p><a href="#figure-can-transmission-acknowledge">Figure 13</a> illustrates the two possible results of a <a href="#TransmitOpCodeCanLowCut">Transmit operation</a>, whereby the transition from FMU 1 &#8594; FMU 2 represents the successful case and FMU 2 &#8594; FMU 1 represents the unsuccessful case.
For the second transmission, the Bus Simulation injects a failure of transmission.
In step (1), a <a href="#TransmitOpCodeCanLowCut">Transmit operation</a> will be delivered to the Bus Simulation.
Within step (2), the <a href="#TransmitOpCodeCanLowCut">Transmit operation</a> will transferred to FMU 2, so the transmission was successful.
Also in step (2), FMU 1 receives a <a href="#ConfirmOpCodeCanLowCut">Confirm operation</a>, which means the transmission was successful.
In step (3), FMU 2 wants to transmit network data to FMU 1:
A <a href="#TransmitOpCodeCanLowCut">Transmit operation</a> will be delivered from FMU 2 to the Bus Simulation.
In step (4), we see that the transmission results in an <a href="#BusErrorOpCodeCanLowCut">Bus Error operation</a>, because the Bus Simulation injects a failure of transmission.
Based on the <a href="#BusErrorOpCodeCanLowCut">Bus Error operation</a> FMU 2 knows that the transmission was not successful.
Within this <a href="#BusErrorOpCodeCanLowCut">Bus Error operation</a>, the <code>Is Sender</code> argument is set to <code>TRUE</code> for FMU 2, because it provides the failing <a href="#TransmitOpCodeCanLowCut">Transmit operation</a>.
Another <a href="#BusErrorOpCodeCanLowCut">Bus Error operation</a> instance is provided by the Bus Simulation to FMU 1.
For FMU 1, the <code>Error Flag</code> argument is set to <code>PRIMARY_ERROR_FLAG</code>, which means that FMU detects the specified transmission error.</p>
</div>
<div id="figure-can-transmission-acknowledge" class="imageblock text-center">
<div class="content">
<img src="images/can_transmission_acknowledge.svg" alt="can transmission acknowledge" width="60%">
</div>
<div class="title">Figure 13. Successful and unsuccessful cases of a CAN transmission.</div>
</div>
<div class="paragraph">
<p>Normally, transmission failure cannot occur during a simulated bus transmission.
Most common kinds of errors are used to inject transmission errors, for example using the Bus Simulation FMU, for advanced test scenarios.</p>
</div>
</div>
<div class="sect5">
<h6 id="example-can-arbitration-with-arbitration-lost-behavior">5.5.1.9.2. CAN Arbitration without Buffering</h6>
<div class="paragraph">
<p><a href="#figure-can-arbitration-overview">Figure 14</a> shows the realization of a CAN arbitration by using the <code>Arbitration Lost Behavior</code> option <code>DISCARD_AND_NOTIFY</code> within the <a href="#ConfigurationCanOpCode">Configuration operation</a>.
At the beginning, FMU 1 and FMU 2 each send network data at the same time.
In this situation, an arbitration is necessary to decide which frame should be sent in this case.
Both frames are transferred to the Bus Simulation.
Arbitration takes place within the Bus Simulation.
In the example given, the two frames with CAN ID = 15 and CAN ID = 16 are analyzed and it is decided that CAN ID = 15 wins the arbitration.
The Bus Simulation then calculates the transmission time for the CAN frame with CAN ID = 15.
The next time the FMI <code>Event Mode</code> is called up for the Bus Simulation, the corresponding CAN frame is transmitted to FMU 2 and FMU 3.
For CAN ID 16, FMU 2 is informed via an <a href="#ArbitrationLostOpCodeCanLowCut">Arbitration Lost operation</a> that this frame cannot be sent.
FMU 1 gets a <a href="#ConfirmOpCodeCanLowCut">Confirm operation</a>, because the specified frame with CAN ID 15 was successfully transmitted.</p>
</div>
<div id="figure-can-arbitration-overview" class="imageblock text-center">
<div class="content">
<img src="images/can_arbitration_overview.svg" alt="can arbitration overview" width="80%">
</div>
<div class="title">Figure 14. Arbitration of CAN frames within Bus Simulation.</div>
</div>
</div>
<div class="sect5">
<h6 id="example-can-arbitration-without-arbitration-lost-behavior">5.5.1.9.3. CAN Arbitration with Buffering</h6>
<div class="paragraph">
<p><a href="#figure-can-arbitration-overview-with-buffer">Figure 15</a> shows the realization of a CAN arbitration by using the <code>Arbitration Lost Behavior</code> option <code>BUFFER_AND_RETRANSMIT</code> within the <a href="#ConfigurationCanOpCode">Configuration operation</a>.
At the beginning, FMU 1 and FMU 2 each send network data at the same time.
In this situation, an arbitration is necessary to decide which frame should be sent in this case.
Both frames are transferred to the Bus Simulation.
Arbitration takes place within the Bus Simulation.
In the example given, the two frames with CAN ID = 15 and CAN ID = 16 are analyzed and it is decided that CAN ID = 15 wins the arbitration.
The Bus Simulation then calculates the transmission time for the CAN frame with CAN ID = 15.
The next time the FMI <code>Event Mode</code> is called up for the Bus Simulation, the corresponding CAN frame is transmitted to FMU 2 and FMU 3.
The <a href="#TransmitOpCodeCanLowCut">Transmit operation</a> of CAN ID 16 is buffered by the Bus Simulation and will be sent within the next time slot.
The Bus Simulation does not return an <a href="#ArbitrationLostOpCodeCanLowCut">Arbitration Lost operation</a> to FMU 2.
FMU 1 gets a <a href="#ConfirmOpCodeCanLowCut">Confirm operation</a>, because the specified frame with CAN ID 15 was successfully transmitted.</p>
</div>
<div id="figure-can-arbitration-overview-with-buffer" class="imageblock text-center">
<div class="content">
<img src="images/can_arbitration_overview_with_buffer.svg" alt="can arbitration overview with buffer" width="80%">
</div>
<div class="title">Figure 15. Arbitration of CAN frames with buffering within Bus Simulation.</div>
</div>
</div>
<div class="sect5">
<h6 id="example-can-error-handling">5.5.1.9.4. Error Handling</h6>
<div class="paragraph">
<p>This chapter describes a possible implementation of the CAN error handling within Network FMUs using a rule set based on <a href="#BusErrorOpCodeCanLowCut">Bus Error operations</a>.
Each Network FMU will provide its own Transmit Error Counter (TEC), Receive Error Counter (REC) and current CAN node state.
The values for TEC and REC will be increased and decreased with respect to the <code>Error Code</code>, <code>Is Sender</code> and <code>Error Flag</code> arguments of a <a href="#BusErrorOpCodeCanLowCut">Bus Error operation</a> and are inherited from the original CAN error confinement rules.
Based on the values of TEC and REC, the CAN controller moves in the following state machine:</p>
</div>
<div id="figure-can-error-state-machine" class="imageblock text-center">
<div class="content">
<img src="images/can_error_state_machine.svg" alt="can error state machine" width="60%">
</div>
<div class="title">Figure 16. CAN node state machine.</div>
</div>
<div class="paragraph">
<p>This CAN node state machine and the related TEC and REC values have to be included within the Network FMUs.
<a href="#BusErrorOpCodeCanLowCut">Bus Error operations</a> shall be directly used to maintain the TEC and REC values.
The Network FMU shall react on the <a href="#BusErrorOpCodeCanLowCut">Bus Error operations</a> that the Bus Simulation provides, based on the following rule set:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When an FMU gets a <a href="#BusErrorOpCodeCanLowCut">Bus Error operation</a> where the arguments <code>Is Sender = FALSE</code> and <code>Error Flag = SECONDARY_ERROR_FLAG</code> and also <code>Error Code != BROKEN_ERROR_FRAME</code>, the REC shall be increased by 1.</p>
</li>
<li>
<p>When an FMU gets a <a href="#BusErrorOpCodeCanLowCut">Bus Error operation</a> where the arguments (<code>Is Sender = FALSE</code> and <code>Error Flag = PRIMARY_ERROR_FLAG</code>) or <code>Error Code = BROKEN_ERROR_FRAME</code>, the REC shall be increased by 8.</p>
</li>
<li>
<p>When an FMU gets a <a href="#BusErrorOpCodeCanLowCut">Bus Error operation</a> where the arguments <code>Is Sender = TRUE</code> or <code>Error Code = BROKEN_ERROR_FRAME</code>, the TEC shall be increased by 8.
Exception: <code>Status =  ERROR_PASSIVE</code> and <code>Error Code = ACK_ERROR</code>.</p>
</li>
<li>
<p>When an FMU provides a <a href="#TransmitOpCodeCanLowCut">Transmit operation</a> and receives a <a href="#ConfirmOpCodeCanLowCut">Confirm operation</a> for it, the TEC shall be decreased by 1 unless it was already 0.</p>
</li>
<li>
<p>When an FMU gets a <a href="#TransmitOpCodeCanLowCut">Transmit operation</a>, the REC shall be decreased by 1, if it was between 1 and 127.
If the REC was 0, it stays 0, and if it was greater than 127, then it will be set to the value between 119 and 127.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A Network FMU communicates its current CAN node state via the <a href="#StatusOpCodeCanLowCut">Status operation</a> by using the following rule set:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>After the initialization of a Network FMU, the current CAN node state shall be set to <code>ERROR_ACTIVE</code> and communicate via <a href="#StatusOpCodeCanLowCut">Status operation</a> to the Bus Simulation.</p>
</li>
<li>
<p>The current CAN node state of a Network FMU shall be set to <code>ERROR_PASSIVE</code> if the value of REC &gt; 127 or TEC &gt; 127 and communicate via <a href="#StatusOpCodeCanLowCut">Status operation</a> to the Bus Simulation.</p>
</li>
<li>
<p>The current CAN node state of a Network FMU shall be set to <code>ERROR_ACTIVE</code> if the value of REC &lt; 128 and TEC &lt; 128 and communicate via <a href="#StatusOpCodeCanLowCut">Status operation</a> to the Bus Simulation.</p>
</li>
<li>
<p>The current CAN node state of a Network FMU shall be set to <code>BUS_OFF</code> if the value of TEC &gt; 255 and communicate via <a href="#StatusOpCodeCanLowCut">Status operation</a> to the Bus Simulation.</p>
</li>
<li>
<p>The <code>BUS_OFF</code> status shall be set to <code>ERROR_ACTIVE</code> again when the Network FMU simulates a controller reset (optional) and has received in total 128 <a href="#TransmitOpCodeCanLowCut">Transmit operations</a> or <a href="#BusErrorOpCodeCanLowCut">Bus Error operations</a> from the network.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>org.fmi_standard.fmi_ls_bus.WaitForBusNotification</code> (see <a href="#bus-notification-parameter">Section 5.5.1.3.1</a>) is set to <code>false</code>, the <a href="#ConfirmOpCodeCanLowCut">Confirm operation</a> cannot be directly used as indicator to set the TEC value and will be incorrect under the rules outlined above.
Also <a href="#BusErrorOpCodeCanLowCut">Bus Error operations</a> are not available in this scenario, so that the values for TEC and REC automatically remain zero in this case.
It is recommended to solve the error handling differently in this case or to disabling it completely within the specified Network FMU.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lin">5.5.2. LIN</h4>
<div class="paragraph">
<p><mark>TODO dSPACE</mark></p>
</div>
</div>
<div class="sect3">
<h4 id="_flexray">5.5.3. FlexRay</h4>
<div class="paragraph">
<p><mark>TODO</mark></p>
</div>
</div>
<div class="sect3">
<h4 id="_ethernet">5.5.4. Ethernet</h4>
<div class="paragraph">
<p><mark>TODO dSPACE</mark></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_known_limitations_of_this_standard">6. Known Limitations of This Standard</h2>
<div class="sectionbody">
<div class="paragraph">
<p><mark>TODO all</mark></p>
</div>
<div class="paragraph">
<p>This layered standard maps several network protocols onto co-simulation variables as transport layer simulating in many ways an ideal network.
Such an ideal network differs from physical networks in the following ways (and potentially others):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Network frame arbitration: frames are sent on the wire according to network-specific priority rules.<br>
Here all frames are transmitted at the same time without delay.</p>
</li>
<li>
<p>Network congestion/bandwidth: too many network frames sent for the bandwidth of the network.<br>
Here the network has infinite capacity.<br>
If network properties are required, a bus simulation component must be added or included with the importer.</p>
</li>
<li>
<p>Protocol functions of higher levels: i.e. CAN request for retransmit is a specific protocol function.<br>
Here such specialties must be handled by the first layer inside the FMU.</p>
</li>
<li>
<p>Incoming buffer overflow: when an ECU receives more frames than its buffer can hold.<br>
Here the FMU will receive all frames, regardless of buffer size and would need to handle those limitations internally.</p>
</li>
<li>
<p><a id="multiOutput"></a>Network protocols allow frames to be sent from more than one node.<br>
Here this is also possible, with output variables for frames (and their signals) that are sent by more than one FMU.
This requires the importer to handle the case when multiple source FMUs are sending the same frame.
Importers must know how to handle this, just like they must know how to handle flow variables according to Kirchhoff&#8217;s law.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references">References</h2>
<div class="sectionbody">
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="PW13"></a>[PW13] Preston-Werner, T. (2013): <strong>Semantic Versioning 2.0.0</strong>.  <a href="https://semver.org/spec/v2.0.0.html" class="bare">https://semver.org/spec/v2.0.0.html</a></p>
</li>
<li>
<p><a id="RFC2119"></a>[RFC2119] RFC 2119. <a href="https://tools.ietf.org/html/rfc2119" class="bare">https://tools.ietf.org/html/rfc2119</a></p>
</li>
<li>
<p><a id="LICENSE"></a>[LICENSE] FMI License text. <a href="https://raw.githubusercontent.com/modelica/fmi-standard/master/LICENSE.txt" class="bare">https://raw.githubusercontent.com/modelica/fmi-standard/master/LICENSE.txt</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. In AUTOSAR context this means a driver implementation within the MicroController Abstraction Layer (MCAL)
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. For details, refer to Functional Mock-up Interface Specification (fmi-standard.org) chapter 2.2.8 Clocks.
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code[data-lang]')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>