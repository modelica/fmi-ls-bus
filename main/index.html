<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<link rel="icon" type="image/x-icon" href="images/favicon.ico">
<title>Network Communication and FMI 3.0, v1.0</title>
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:30em;padding-right:0}
#toc.toc2{width:30em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote::before{display:none}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{word-spacing:0;line-height:1.6}
.quoteblock.abstract blockquote::before,.quoteblock.abstract p::before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}

/* customizations */

body{
  font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
}

.toc-hidden {
  padding-left: 0 !important;
}

.imageblock {
  text-align: center;
}

.imageblock img {
  display: block;
  margin: auto;
}

.imageblock .title {
  display: inline-block;
  margin: auto;
}

.vertical-text {
	transform: rotate(-90deg) translate(-11em, 0);
	transform-origin: left top 0;
  float: left;
  display: inline-block;
  white-space: nowrap;
  width: 1em;
  height: 11em;
}

/* no alternating row colors */
table tr.even,table tr.alt,table tr:nth-of-type(even) {
  background:none
}

/* use parent text color for captions */
.subheader, .admonitionblock td.content>.title, .audioblock>.title, .exampleblock>.title, .imageblock>.title, .listingblock>.title, .literalblock>.title, .stemblock>.title, .openblock>.title, .paragraph>.title, .quoteblock>.title, table.tableblock>.title, .verseblock>.title, .videoblock>.title, .dlist>.title, .olist>.title, .ulist>.title, .qlist>.title, .hdlist>.title {
  color: inherit;
}

a {
  text-decoration: none;
}

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/github.min.css">
<script>
// hide / show the Table of Contents (TOC)
function toggleTOC() {
  var toc = document.getElementById("toc");
  var body = document.getElementsByTagName("body")[0];

  if (toc.style.display === "none") {
      toc.style.display = "block";
      body.classList.remove("toc-hidden");
  } else {
      toc.style.display = "none";
      body.classList.add("toc-hidden");
  }
}

// toggle the TOC when "t" key is pressed
document.addEventListener('keydown', (event) => {
  if (event.key == 't') {
    toggleTOC();
  }
});
</script>

<!-- Generate a nice TOC -->
<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js"></script>
<!-- We do not need the tocify CSS because the asciidoc CSS already provides most of what we neeed -->

<style>
.tocify-header {
    font-style: italic;
}

.tocify-subheader {
    font-style: normal;
    font-size: 90%;
}

.tocify ul {
    margin: 0;
 }

.tocify-focus {
    color: #7a2518;
    background-color: rgba(0, 0, 0, 0.1);
}

.tocify-focus > a {
    color: #7a2518;
}
</style>

<script type="text/javascript">
    $(function () {
        // Add a new container for the tocify toc into the existing toc so we can re-use its
        // styling
        $("#toc").append("<div id='generated-toc'></div>");
        $("#generated-toc").tocify({
            extendPage: true,
            context: "#content",
            highlightOnScroll: true,
            // don't hide the sections in the TOC
            showAndHide: false,
            hideEffect: "slideUp",
            // Use the IDs that asciidoc already provides so that TOC links and intra-document
            // links are the same. Anything else might confuse users when they create bookmarks.
            hashGenerator: function(text, element) {
                return $(element).attr("id");
            },
            // Smooth scrolling doesn't work properly if we use the asciidoc IDs
            smoothScroll: false,
            // Set to 'none' to use the tocify classes
            theme: "none",
            // Handle book (may contain h1) and article (only h2 deeper)
            selectors: $( "#content" ).has( "h1" ).size() > 0 ? "h1,h2,h3,h4,h5" : "h2,h3,h4,h5,h6",
            ignoreSelector: ".discrete"
        });

        // Switch between static asciidoc toc and dynamic tocify toc based on browser size
        // This is set to match the media selectors in the asciidoc CSS
        // Without this, we keep the dynamic toc even if it is moved from the side to preamble
        // position which will cause odd scrolling behavior
        var handleTocOnResize = function() {
            if ($(document).width() < 768) {
                $("#generated-toc").hide();
                $(".sectlevel0").show();
                $(".sectlevel1").show();
            }
            else {
                $("#generated-toc").show();
                $(".sectlevel0").hide();
                $(".sectlevel1").hide();
            }
        }

        $(window).resize(handleTocOnResize);
        handleTocOnResize();
    });
</script>

<img style="display: block; margin: 2em auto; width: 30em;" src="images/FMI_logo_horizontal.svg" alt="FMI logo">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Network Communication and FMI 3.0, v1.0</h1>
<div class="details">
<span id="revnumber">version main-7ba1498d472f3a3ee6b4ceabfd937c96753532ee,</span>
<span id="revdate">2023-02-09</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#_intent_of_this_document">1.1. Intent of This Document</a></li>
<li><a href="#_how_to_read_this_document">1.2. How to Read This Document</a></li>
<li><a href="#_remarks">1.3. Remarks</a></li>
</ul>
</li>
<li><a href="#_common_concepts">2. Common Concepts</a>
<ul class="sectlevel2">
<li><a href="#SystemCompositions">2.1. System Compositions</a>
<ul class="sectlevel3">
<li><a href="#DirectCommunication">2.1.1. Direct Communication</a></li>
<li><a href="#Composition-with-dedicated-Bus-Simulation-FMU">2.1.2. Composition with dedicated Bus Simulation FMU</a></li>
<li><a href="#BusFeatureIntegratedFmuSimulator">2.1.3. Importer with Integrated Bus Simulation</a></li>
</ul>
</li>
<li><a href="#_timing_aspects">2.2. Timing Aspects</a></li>
</ul>
</li>
<li><a href="#_physical_signal_abstraction_high_cut">3. Physical Signal Abstraction ("high cut")</a>
<ul class="sectlevel2">
<li><a href="#_overview">3.1. Overview</a></li>
<li><a href="#_variables">3.2. Variables</a>
<ul class="sectlevel3">
<li><a href="#_signal_variables">3.2.1. Signal Variables</a></li>
<li><a href="#ClockVariableHighCut">3.2.2. Clock Variables</a></li>
</ul>
</li>
<li><a href="#NetworkDescriptionFile">3.3. Network Description Files</a></li>
<li><a href="#_terminal_definitions">3.4. Terminal Definitions</a>
<ul class="sectlevel3">
<li><a href="#BUSTerminalHighCut">3.4.1. Bus Terminal</a></li>
<li><a href="#FrameTerminal">3.4.2. Frame Terminal</a></li>
<li><a href="#PDUTerminal">3.4.3. PDU Terminal</a></li>
<li><a href="#TerminalMemberVariable">3.4.4. Terminal Member Variable for Signals</a></li>
<li><a href="#ExampleHighCut">3.4.5. Example</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#network-abstraction">4. Network Abstraction ("low cut")</a>
<ul class="sectlevel2">
<li><a href="#_overview_2">4.1. Overview</a></li>
<li><a href="#Overview-Layered-Standard-Bus-Protocol">4.2. Layered Standard Bus Protocol</a></li>
<li><a href="#NetworkAbstractionVariables">4.3. Variables</a>
<ul class="sectlevel3">
<li><a href="#ClockVariableLowCut">4.3.1. Tx\Rx Clock Variables</a>
<ul class="sectlevel4">
<li><a href="#_bus_communication_points">4.3.1.1. Bus Communication Points</a></li>
</ul>
</li>
<li><a href="#CommunicationVariable">4.3.2. Tx\Rx Data Variables</a></li>
<li><a href="#_mime_types">4.3.3. MIME Types</a></li>
</ul>
</li>
<li><a href="#_terminal_definitions_2">4.4. Terminal Definitions</a>
<ul class="sectlevel3">
<li><a href="#BUSTerminalLowCut">4.4.1. Bus Terminal</a></li>
<li><a href="#ExampleLowCut">4.4.2. Example</a></li>
</ul>
</li>
<li><a href="#NetworkParameters">4.5. Network Parameters</a></li>
<li><a href="#_example">4.6. Example</a></li>
<li><a href="#BusTypeSpecificDetails">4.7. Bus Specific Details</a>
<ul class="sectlevel3">
<li><a href="#_can_can_fd_can_xl">4.7.1. CAN, CAN FD, CAN XL</a>
<ul class="sectlevel4">
<li><a href="#_overview_3">4.7.1.1. Overview</a></li>
<li><a href="#_configuration_of_bus_simulation_fmu">4.7.1.2. Configuration of Bus Simulation FMU</a></li>
<li><a href="#_transmission_and_acknowledge">4.7.1.3. Transmission and Acknowledge</a></li>
<li><a href="#_topology">4.7.1.4. Topology</a></li>
<li><a href="#CanArbitration">4.7.1.5. Arbitration</a></li>
<li><a href="#_wake_upsleep">4.7.1.6. Wake-up/Sleep</a></li>
<li><a href="#_operations">4.7.1.7. Operations</a>
<ul class="sectlevel5">
<li><a href="#_noop">4.7.1.7.1. NOOP</a></li>
<li><a href="#TransmitOpCodeCanLowCut">4.7.1.7.2. Transmit</a></li>
<li><a href="#ConfirmOpCodeCanLowCut">4.7.1.7.3. Confirm</a></li>
<li><a href="#ErrorOpCodeCanLowCut">4.7.1.7.4. Error</a></li>
<li><a href="#WakeupCanOpCode">4.7.1.7.5. Wakeup</a></li>
<li><a href="#BaudrateCanOpCode">4.7.1.7.6. BaudrateCan</a></li>
<li><a href="#BaudrateCanFdOpCode">4.7.1.7.7. BaudrateCanFD</a></li>
<li><a href="#BaudrateCanXlOpCode">4.7.1.7.8. BaudrateCanXL</a></li>
</ul>
</li>
<li><a href="#_sequence_diagrams">4.7.1.8. Sequence Diagrams</a></li>
<li><a href="#_sae_j1939">4.7.1.9. SAE J1939</a></li>
</ul>
</li>
<li><a href="#_lin">4.7.2. LIN</a></li>
<li><a href="#_flexray">4.7.3. FlexRay</a></li>
<li><a href="#_ethernet">4.7.4. Ethernet</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#NetworkSimulation">5. Network Simulation</a></li>
<li><a href="#_known_limitations_of_this_standard">6. Known Limitations of This Standard</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This layered standard on top of FMI 3.0, defines how to describe and simulate network signals as input and output variables of an FMU.</p>
</div>
<div class="paragraph">
<p><br>
</p>
</div>
<div class="paragraph">
<p>Copyright &#169; 2022 The Modelica Association Project FMI.</p>
</div>
<div class="paragraph">
<p>This document is licensed under the Attribution-ShareAlike 4.0 International license.
The code is released under the 2-Clause BSD License.
The licenses text can be found in the <a href="https://raw.githubusercontent.com/modelica/fmi-standard/master/LICENSE.txt">LICENSE.txt</a> file that accompanies this distribution.</p>
</div>
<div class="paragraph">
<p></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_intent_of_this_document">1.1. Intent of This Document</h3>
<div class="paragraph">
<p>Automotive CAN, LIN, FlexRay, CAN FD, CAN XL and Ethernet are network technologies that have been applied successfully over many years by all automotive OEMs world wide.
Virtualizing electronic control units (ECUs) and then simulating multiple such virtual ECUs requires connecting them using a virtual version of these network technologies.</p>
</div>
<div class="paragraph">
<p>This layered standard defines what input and output variables and which FMI 3.0 features are used and how to emulate a transport layer for such network traffic.</p>
</div>
<div class="paragraph">
<p>There are mainly two base use cases envisioned here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Physical signal abstraction ("high cut") to simply transport physical signal values between virtual ECUs.<br>
The network properties are largely idealized: infinite bandwidth, zero-delay etc.
Signals, groups of signals and their properties <em>(e.g. units)</em> are usually derived from (existing and validated) standard network topology description formats <em>(such as DBC, LDF, Fibex and ARXML)</em>.</p>
</li>
<li>
<p>Network abstraction ("low cut") to realize virtualized bus driver implementations <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>.<br>
This transport layer emulation allows anything from idealized to more detailed network simulations, including bandwidth restrictions, message arbitration and delays.
It forwards the network payloads using binary variables.
The "low cut" abstraction layer is meant to allow virtualized bus driver implementations, including feedback from the physical drivers about transmission status or network node state.
Since the Network abstraction Layer is protocol-independent, it can also be used for the simulation of non-automotive control units, <em>e.g. from the field of industrial automation</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the simplest use case, the importer does not need provide specific bus semantics of certain variables of an FMU; it simply forwards variable values between 2 FMUs according to the FMI standard (<a href="#multiOutput">with one exception noted at the end of the document</a>).
Only when more than two FMUs are connected to a single network a bus simulation component is required to handle the bus communication between multiple senders and receivers according to the semantic of the selected bus type.</p>
</div>
<div class="paragraph">
<p>See the following image describing three potential architectures for connecting two or more networked virtual ECUs packaged into FMI 3.0 FMUs:</p>
</div>
<div id="vECU-network-architectures" class="imageblock text-center">
<div class="content">
<img src="images/architecture.svg" alt="architecture" width="80%">
</div>
<div class="title">Figure 1. Three ways to connect FMUs with bus support and network variables, for example virtual ECUs.</div>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_read_this_document">1.2. How to Read This Document</h3>
<div class="paragraph">
<p>Conventions used in this document:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Non-normative text is given in square brackets in italic font: <em>[Especially examples are defined in this style.]</em></p>
</li>
<li>
<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119 (regardless of formatting and capitalization).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_remarks">1.3. Remarks</h3>
<div class="paragraph">
<p>This layered standard currently only refers to the FMI Co-Simulation (CS).
At the current time, Scheduled Execution (SE) is not taken into account.
All explanations in this document are therefore to be understood in the context of FMI Co-Simulation (CS).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_common_concepts">2. Common Concepts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Physical signal abstraction ("high cut") and Network abstraction ("low cut") layers represent different levels for the exchange of bus messages.
Physical signal abstraction focuses primarily on the exchange of signal values, while Network abstraction provides a complete way of implementing a virtual bus driver.
Depending on the exporting tool, one of the abstraction layers is more "natural" to the FMU, while the other might have to be emulated with additional internal effort or an adapter (FMU) could be used.
Importers on the other hand rarely require both abstraction layers for system level compositions, because the engineering tasks define the required level of abstraction for the network communication.
FMUs may choose to only support one abstraction layer providing only the corresponding variables.
However, for versatility, having FMUs capable of communicating on both abstraction layers is more convenient for users.</p>
</div>
<div class="paragraph">
<p><em>[FMUs providing both abstraction layers can deduce from the fmi3Set() and fmi3Get() calls they receive, which abstraction layer the importer is using.]</em></p>
</div>
<div class="paragraph">
<p>Since network communication is not continuous but time discrete, FMI 3.0 clocks are used to indicate when signals and/or frames are sent or received.
All signal and frame variables are clocked variables.</p>
</div>
<div class="paragraph">
<p>FMI 3.0 terminal definitions in the <code>terminalsAndIcons.xml</code> for each level of grouping (networks, frames and PDUs) allow system composition tools without knowledge of the network description format to semantically group signals.
To uniquely map between the FMU variables and the network variables, FMU variable names are structured, e.g. <code>BusName::FrameName::PDUName::SignalName</code> for the "high cut" and simply <code>BusName</code> for the "low cut".</p>
</div>
<div id="figure-terminal-relations" class="imageblock text-center">
<div class="content">
<img src="images/terminal_relations.svg" alt="terminal relations" width="60%">
</div>
<div class="title">Figure 2. Relations between Bus-, Frame- and PDU Terminals.</div>
</div>
<div class="paragraph">
<p><mark>TODO AJ</mark>: explanation of clock and binary (check names!) variables for low cut; clock type influences and flexibilities; not use of nextEventTime</p>
</div>
<div class="paragraph">
<p>All variables have structured names that indicate how these variables are related and to which abstraction layer they belong.
For the high cut, variables represent signals and their clocks.
For the low cut, variables represent frames and their clocks.
Input and output variables show if these variables belong to signals or frames that are received or sent, respectively.
Input clocks must be triggered and are connected by the importer to their corresponding output clocks of potentially different clock types.
For example, a periodic output clock indicates that the FMU can only send signals or frames periodically, while a countdown clock indicates that the FMU can send signals at varying time steps.</p>
</div>
<div class="paragraph">
<p>Using output clocks of different types allows simulations with different timing accuracy and performance.
These clocks allow the FMU to specify the next send event efficiently and accurately, the importer will trigger these clocks according to these clock specifications as accurately as it can.</p>
</div>
<div class="paragraph">
<p><em>[The alternative of using <code>nextEventTime</code> would force epsilon matching of event times.]</em></p>
</div>
<div class="paragraph">
<p><mark>TODO AJ</mark>: Fix and variable step size influence on buffering of transport-layer events and their binary variables
  &#8594; high cut is different: no buffering possible: each send must be handled as Event</p>
</div>
<div class="paragraph">
<p>For any periodic (fixed-time) sending of messages, multiple message sends fall into one <code>doStep</code>.
While high cut signal variables will miss all but the last value sent, low cut frame variables will buffer all payloads inside their value.</p>
</div>
<div class="paragraph">
<p>If an FMU represents network nodes that are both sender and receiver of a signal, the receiver role will be removed from the FMU interface to allow the signals to have a unique role as output and the reading of such outputs must be handled internally to the FMU.</p>
</div>
<div class="paragraph">
<p><em>[The FMI standard requires a variable to be either input or output.]</em></p>
</div>
<div class="paragraph">
<p><mark>TODO</mark>: is this correct? does that also work for network simulations? how else to solve this unique-variable-name requirement?</p>
</div>
<div class="paragraph">
<p>While the values and semantic of the clock variables are clear, the binary frame variables are opaque to the importer but have internal structure to implement the transport mechanism of the specific network technology, see <a href="#FrameVariable">[FrameVariable]</a>.
Frame variables do not just transport the network-specific payload, but also carry protocol-specific status information.
Status information allows, for example, the MCAL emulation of a virtual ECU to report back to the COM-stack about success or errors of a send request.</p>
</div>
<div class="sect2">
<h3 id="SystemCompositions">2.1. System Compositions</h3>
<div class="paragraph">
<p>Overall, this standard considers three possible communication architectures for bus communication.
It should be explicitly noted at this point that the FMUs for integration in the respective use case do not necessarily have to be different, so that the same FMU can be integrated across all three communication architectures.
The interface of the FMU to the importer is always the same, but a different subset of the features is actually used.</p>
</div>
<div class="paragraph">
<p><mark>TODO ALL</mark>: Clarify if System Compositions matches for High and Low Cut</p>
</div>
<div class="sect3">
<h4 id="DirectCommunication">2.1.1. Direct Communication</h4>
<div class="paragraph">
<p>The first option is to use a common FMU importer.
Within this configuration, the FMU importer does not require any special features for simulating buses, apart from supporting FMI variables, clocks and terminals.
The figure below illustrates the direct communication of two FMUs:</p>
</div>
<div id="figure-direct-communication-of-two-fmus" class="imageblock text-center">
<div class="content">
<img src="images/architecture_direct_connection.svg" alt="architecture direct connection" width="50%">
</div>
<div class="title">Figure 3. Direct communication of two FMUs.</div>
</div>
<div class="paragraph">
<p>Direct bus communication is limited to exactly two FMUs.
The simulation of bus communication between more than two FMUs is therefore not intended.
The bus simulation is also only idealized, so that the simulation of bus transmission times or arbitration, for example, is not supported.
Such an ideal network differs from physical networks in the following ways (and potentially others):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Network frame arbitration: frames are sent on the wire according to network-specific priority rules.<br>
Here all frames are transmitted at the same time without delay.</p>
</li>
<li>
<p>Network congestion/bandwidth: too many network frames sent for the bandwidth of the network.<br>
Here the network has infinite capacity.<br>
If network properties are required, a bus simulation component must be added or included in the importer.</p>
</li>
<li>
<p>Protocol functions of higher levels: <em>e.g. CAN request for retransmit is a specific protocol function</em>.<br>
Here such specialties must be handled by the first layer inside the FMU.</p>
</li>
<li>
<p>Incoming buffer overflow: when an ECU receives more frames than its buffer can hold.<br>
Here the FMU will receive all frames, regardless of buffer size and would need to handle those limitations internally.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="Composition-with-dedicated-Bus-Simulation-FMU">2.1.2. Composition with dedicated Bus Simulation FMU</h4>
<div class="paragraph">
<p>Another option is to connect FMUs by means of a dedicated Bus Simulation FMU.
The Bus Simulation FMU is used to simulate the bus behavior and differs depending on the bus type (e.g. for CAN, LIN, Ethernet or FlexRay).
For example, it is used to simulate the transmission time or the failure of bus messages.
A Bus Simulation FMU must provide enough bus terminals for all FMUs that are interconnected via a bus.
The implementation of a bus simulation FMU can be dynamic or static, potentially generated by a tool.
<a href="#network-abstraction">Chapter 4</a> explains the topic of binary protocol data within the bus terminal variables in more detail.
Because the Bus Simulation FMU can provide the described functionality, the primary concept is that all FMUs that want to transmit bus messages provide this information to the Bus Simulation FMU.
The Bus Simulation FMU makes the messages available to all recipients and has the option of acknowledging successful transmission to the sender.
Also in this case, the FMU importer does not require any special features for bus simulation, apart from supporting FMI variables, clocks and terminals.
The figure below shows two FMUs which are connected to a specific Bus Simulation FMU.
The total of three FMUs are executed on a common FMI 3 importer:</p>
</div>
<div id="figure-external-bus-simulation-fmu" class="imageblock text-center">
<div class="content">
<img src="images/architecture_bus_simulation_fmu.svg" alt="architecture bus simulation fmu" width="50%">
</div>
<div class="title">Figure 4. Bus simulation by using a dedicated Bus Simulation FMU.</div>
</div>
<div class="paragraph">
<p>This type of communication allows the simulation of all bus features, such as arbitration or the simulation of timing.
The supported bus features cannot be specified explicitly in the case shown, but refers to a specific implementation of a Bus Simulation FMU and are depending on the requirements of the bus simulation.
This communication architecture enables complex bus simulations to be implemented on lightweight FMU importers.
An n:m bus communication of several FMUs is also permitted.
Depending on the needs, it may be necessary to dynamically provision the Bus Simulation FMU so that it provides the appropriate number of inputs and outputs to allow all FMUs to be connected.</p>
</div>
</div>
<div class="sect3">
<h4 id="BusFeatureIntegratedFmuSimulator">2.1.3. Importer with Integrated Bus Simulation</h4>
<div class="paragraph">
<p>In the third variant of the communication architecture, the bus simulation is built directly into the respective importer.
The supported bus features are analogous to the <a href="#Composition-with-dedicated-Bus-Simulation-FMU">Composition with dedicated Bus Simulation FMU</a> use case.
The corresponding limitations regarding the behavior of the bus simulation are importer-specific.
The following figure illustrates two FMUs, which are integrated by an importer that directly supports this standard and needs no further Bus Simulation FMU:</p>
</div>
<div id="figure-bus-feature-integrated-fmu-simulator" class="imageblock text-center">
<div class="content">
<img src="images/architecture_bus_simulation_importer.svg" alt="architecture bus simulation importer" width="50%">
</div>
<div class="title">Figure 5. Bus simulation by using an importer with internal bus simulation support.</div>
</div>
<div class="paragraph">
<p>This communication architecture enables the realization of complex bus simulations.
By using proprietary extension mechanisms of an existing importer it may also be possible to integrate other, for example manufacturer-specific, formats into a bus simulation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_timing_aspects">2.2. Timing Aspects</h3>
<div class="paragraph">
<p><mark>TODO</mark></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_physical_signal_abstraction_high_cut">3. Physical Signal Abstraction ("high cut")</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview">3.1. Overview</h3>
<div class="paragraph">
<p><mark>ToDo</mark>: Write Overview content here</p>
</div>
</div>
<div class="sect2">
<h3 id="_variables">3.2. Variables</h3>
<div class="paragraph">
<p>This section explains the different variable types used to carry network traffic through FMI input and output variables.</p>
</div>
<div class="sect3">
<h4 id="_signal_variables">3.2.1. Signal Variables</h4>
<div class="paragraph">
<p>To define the signal abstraction layer (or "high cut"), signal variables are defined.</p>
</div>
<div class="paragraph">
<p>A signal variable carries the physical value of a network signal normally packaged inside a PDU or frame.
The unit definition of the variable must match the one defined in the <a href="#NetworkDescriptionFile">network description file</a>.</p>
</div>
<div class="paragraph">
<p>Each network signal must be listed as <a href="#TerminalMemberVariable">Terminal Member Variable</a> of its corresponding <a href="#PDUTerminal">PDU terminal</a>.</p>
</div>
<div class="paragraph">
<p>In case multiplexed signals are present in a frame/PDU: all signals are present, but only the active signal according to the multiplex switch signal contains a valid value, all inactive variables have undefined values <em>[those values could even be outside their specified min-max range without fault]</em>.</p>
</div>
<div class="paragraph">
<p>Generally, signal variables are optional, but they must either be all missing or all present to clearly indicate support for the signal abstraction layer.</p>
</div>
<div class="paragraph">
<p>All signal variables are clocked to indicate when exactly they have been sent, see <a href="#ClockVariableHighCut">Section 3.2.2</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="ClockVariableHighCut">3.2.2. Clock Variables</h4>
<div class="paragraph">
<p><mark>TODO AJ</mark>: Add description of Event Mode handling here and how the countdown clock pre-schedules events into the future for performance reasons</p>
</div>
<div class="paragraph">
<p>In order to use FMU input and output variables as transport layer for networks, input and output clocks are used.
Such a clock is scheduled by the sending FMU to indicate the transmission of the corresponding frame or frames.</p>
</div>
<div class="paragraph">
<p>The output clock type, periodic or aperiodic, is defined by the sending FMU.
This allows the FMU (or better the exporting tool) to balance the accuracy and performance of its network communication:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>While aperiodic clocks allow very accurate network simulations, frequently entering Event Mode will reduce the network simulation speed.</p>
</li>
<li>
<p>Using periodic clocks and buffering the frames to be transmitted reduces the number of Event Modes required and speeds up the simulation at the cost of simulation accuracy.</p>
</li>
<li>
<p>One could use (structural) parameters to define the accuracy of aperiodic clocks, allowing control of the simulation accuracy and performance with the same FMU.</p>
</li>
<li>
<p>The input clocks shall be triggered clocks.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The importer will then connect and merge output clock activations, even those of different clock types, and forwards them to the input clocks, as required by the network semantics.</p>
</div>
<div class="paragraph">
<p>All signal variables are clocked variables.
Signal variables belonging to frame <code>BusName::FrameName</code> are triggered by the clock <code>BusName::FrameName_Clock</code> and all these variables and their corresponding clock must share the same <code>causality</code> (<code>input</code> or <code>output</code>).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="NetworkDescriptionFile">3.3. Network Description Files</h3>
<div class="paragraph">
<p><mark>TODO AJ</mark>: remove old requirements for network description files (not needed anymore): make it optional</p>
</div>
<div class="paragraph">
<p>Standardized <a href="#NetworkDescriptionFile">network description files</a> can be shipped with each FMU to describe properties of signals and frames, such as signal units, frame composition and trigger conditions.
These <a href="#NetworkDescriptionFile">network description files</a> must be placed into the <code>/extra/org.fmi-standard.fmi-ls-bus</code> folder.
DBC, LDF, Fibex and ARXML files are allowed, e.g. <code>Powertrain.dbc</code>.
The case sensitive root name of the <a href="#NetworkDescriptionFile">network description file</a> must be used as network identifier in the bus terminal type and prefix in the variable names.</p>
</div>
<div class="paragraph">
<p>Multiple files can be specified, each one defining one network used by the FMU.
This standard does not support composing one network from multiple <a href="#NetworkDescriptionFile">network description files</a>, even if using internal include mechanisms, it rather enforces the rule: one network - one file.</p>
</div>
<div class="paragraph">
<p>It is recommended to use ARXML over DBC files for CAN whenever possible, because the DBC standard lacks some key frame/PDU properties that were added only later using non-standard extensions with different dialects in use.</p>
</div>
<div class="paragraph">
<p>This document does not address potential open points of these description formats, it is assumed that such ambiguities will be handled elsewhere (e.g. message timing in the DBC format).
This document does not address IP protection or copyright issues.
These are technical and legal issues that need attention from standardization bodies of the referenced description formats, tool vendors and end users.</p>
</div>
</div>
<div class="sect2">
<h3 id="_terminal_definitions">3.4. Terminal Definitions</h3>
<div class="sect3">
<h4 id="BUSTerminalHighCut">3.4.1. Bus Terminal</h4>
<div class="paragraph">
<p>Each network connected to the FMU must be described in <code>icons/terminalsAndIcons.xml</code> as a <code>&lt;Terminal&gt;</code> element of <code>&lt;fmiTerminalsAndIcons&gt;&lt;Terminals&gt;</code> that wraps all <a href="#FrameTerminal">frame terminals</a>.
The attribute <code>name</code> of the <code>&lt;Terminal&gt;</code> must match the root name of its <a href="#NetworkDescriptionFile">network description file</a> if it exists
<em>[e.g. <code>Powertrain</code>, if the file is <code>/extra/org.fmi-standard.fmi-ls-bus/Powertrain.dbc</code>]</em>.
In any case, the attribute <code>name</code> of the <code>&lt;Terminal&gt;</code> must be consistent with the <code>BusName</code> component of all its corresponding signal, frame and clock variables.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Attribute definitions</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>terminalKind</code> must be set to <code>bus</code>.</p>
</li>
<li>
<p><code>matchingRule</code> must be set to <code>bus</code>.</p>
</li>
<li>
<p><code>name</code> is the network name, e.g. <code>Powertrain</code>, see <a href="#ExampleHighCut">ExampleHighCut</a> and constraints above.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Element definitions</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>There must be no <code>&lt;TerminalStreamMemberVariable&gt;</code> element.</p>
</li>
<li>
<p>There must be one <code>&lt;Terminal&gt;</code> element per network frame described in the <a href="#NetworkDescriptionFile">network description file</a>, if their signal and lock variables are present in the <code>modelDescription.xml</code>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Annotation element</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>There must be an <code>&lt;Annotation&gt;</code> element defining which node or nodes (as comma-separated list without spaces) of the <a href="#NetworkDescriptionFile">network description file</a> are wrapped inside the FMU.
If the combination of nodes specified for this FMU turns a frame and its signals into both input and output because sending and receiving nodes are specified, only the sending (output) role will be defined in the FMU interface.
Receiving such frames must then be handled internally to the FMU.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="FrameTerminal">3.4.2. Frame Terminal</h4>
<div class="paragraph">
<p>Each frame listed in the <a href="#NetworkDescriptionFile">network description file</a> must be an element of its corresponding <a href="#BUSTerminalHighCut">bus terminal</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Attribute definitions</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>terminalKind</code> must be set to <code>frame</code>.</p>
</li>
<li>
<p><code>matchingRule</code> must be set to <code>bus</code>.</p>
</li>
<li>
<p><code>name</code> must match the frame name as defined in the <a href="#NetworkDescriptionFile">network description file</a> in <code>/extra/org.fmi-standard.fmi-ls-bus</code>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Element definitions</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>There must be no <code>&lt;TerminalStreamMemberVariable&gt;</code> element.</p>
</li>
<li>
<p>There must be one <a href="#PDUTerminal">PDU terminal</a> element per PDU of this frame.</p>
</li>
<li>
<p>There must be one <code>&lt;TerminalMemberVariable&gt;</code> for the clock this frame is connected to.
The name of this variable is composed as <a href="#ClockVariable"><code>BusName::FrameName_Clock</code></a>, e.g. <code>Powertrain::tcuSensors_Clock</code>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The <a href="#TerminalMemberVariable">Terminal Member Variable</a> must have the same causality as all variables referenced in the <a href="#PDUTerminal">PDU Terminals</a> included here.</p>
</div>
</div>
<div class="sect3">
<h4 id="PDUTerminal">3.4.3. PDU Terminal</h4>
<div class="paragraph">
<p>Each PDU listed in the <a href="#NetworkDescriptionFile">network description file</a> must be an element of its corresponding <a href="#FrameTerminal">frame terminal</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Attribute definitions</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>terminalKind</code> must be set to <code>pdu</code>.</p>
</li>
<li>
<p><code>matchingRule</code> must be set to <code>bus</code>.</p>
</li>
<li>
<p><code>name</code> must match a PDU name of the <a href="#NetworkDescriptionFile">network description file</a> in <code>/extra/org.fmi-standard.fmi-ls-bus</code>, if given.
For network types not natively referencing a "PDU", like CAN, a synthetic PDU with the same name as its frame is inserted.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Element definitions</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>There must be no <code>&lt;TerminalStreamMemberVariable&gt;</code> element.</p>
</li>
<li>
<p>There must be no <code>&lt;Terminal&gt;</code> element.</p>
</li>
<li>
<p>There must be one <code>&lt;TerminalMemberVariable&gt;</code> per <a href="#TerminalMemberVariable">signal</a> of this PDU.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>All <a href="#TerminalMemberVariable"><code>TerminalMemberVariables</code></a> must have the same causality of either <code>input</code> or <code>output</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="TerminalMemberVariable">3.4.4. Terminal Member Variable for Signals</h4>
<div class="paragraph">
<p><a href="#PDUTerminal">PDU terminals</a> list all the contained signals as <code>&lt;TerminalMemberVariable&gt;</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Attribute definitions</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>variableName</code> refers to the input or output variable name of the FMU and to enforce uniqueness is built as follows: <code>BusName::FrameName::PDUName::SignalName</code>, e.g. <code>Powertrain::tcuSensors::tcuSensors::vCar</code>.
These variables represent the signal abstraction layer ("high cut").</p>
</li>
<li>
<p><code>memberName</code> is the <code>SignalName</code> as given in the <a href="#NetworkDescriptionFile">network description file</a>, e.g. <code>vCar</code>, if given.
This is redundant information but simplifies signal name extraction.</p>
</li>
<li>
<p><code>variableKind</code> is <code>signal</code>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ExampleHighCut">3.4.5. Example</h4>
<div class="paragraph">
<p>The following excerpts from files are used throughout this document as examples and should illustrate how the different concepts relate.</p>
</div>
<div class="paragraph">
<p>The following partial DBC file lists merely the CAN message (frame) structure.
Signal trigger conditions are not included because they have no bearing on this standard.</p>
</div>
<div id="Powertrain" class="listingblock dbc">
<div class="title">Example Powertrain.dbc file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">...
BO_ 256 tcuSensors: 4 TCU
 SG_ vCar :          0|16@1- (32,0)  [-500|500] "km/h" ECU
 SG_ oilTemp :      16|9@1-  (2,50)  [-50|150]  "Grad C" ECU

BO_ 257 tcuState: 2 TCU
 SG_ state :         0|2@1+  (1,0)   [ 0|2] "-" ECU
 SG_ gear :          2|4@1-  (1,0)   [-2|6] "-" ECU
 SG_ targetGear :    6|4@1-  (1,0)   [-2|6] "-" ECU

BO_ 512 ecuState: 4 ECU
 SG_ accelPedal :    0|8@1+ (2,0)   [0|100]   "%" TCU
 SG_ k15 :           8|1@1+ (1,0)   [0|1]     "-" TCU
 SG_ oilTemp :       9|9@1- (2,50)  [-50|150] "Grad C" TCU
 SG_ radiatorTemp : 18|9@1- (2,50)  [-50|150] "Grad C" TCU
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>modelDescription.xml</code> excerpt listed below shows which variables would exist for the <code>Powertrain.dbc</code> shown above.</p>
</div>
<div id="modelDescriptionHighCut" class="listingblock xml">
<div class="title">Example modelDescription.xml for ECU node</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;fmiModelDescription fmiVersion="3.0-final" modelName="Network4FMI"
    instantiationToken="Network4FMI"&gt;
  &lt;ModelVariables&gt;
    &lt;Clock   name="Powertrain::tcuSensors_Clock"                 valueReference="1007"
        causality="input" variability="discrete" interval="triggered"/&gt;
    &lt;Float64 name="Powertrain::tcuSensors::tcuSensors::vCar"     valueReference="1005"
        causality="input" variability="discrete" start="0"  clocks="1007"/&gt;
    &lt;Float64 name="Powertrain::tcuSensors::tcuSensors::oilTemp"  valueReference="1006"
        causality="input" variability="discrete" start="20" clocks="1007"/&gt;

    &lt;Clock   name="Powertrain::tcuState_Clock"                   valueReference="1011"
        causality="input" variability="discrete" interval="triggered"/&gt;
    &lt;Float64 name="Powertrain::tcuState::tcuState::state"        valueReference="1008"
        causality="input" variability="discrete" start="0" clocks="1011"/&gt;
    &lt;Float64 name="Powertrain::tcuState::tcuState::gear"         valueReference="1009"
        causality="input" variability="discrete" start="0" clocks="1011"/&gt;
    &lt;Float64 name="Powertrain::tcuState::tcuState::targetGear"   valueReference="1010"
        causality="input" variability="discrete" start="0" clocks="1011"/&gt;

    &lt;Clock   name="Powertrain::ecuState_Clock"                   valueReference="1016"
        causality="output" variability="discrete" interval="triggered"/&gt;
    &lt;Float64 name="Powertrain::ecuState::ecuState::accelPedal"   valueReference="1012"
        causality="output" variability="discrete" start="0" clocks="1016"/&gt;
    &lt;Float64 name="Powertrain::ecuState::ecuState::k15"          valueReference="1013"
        causality="output" variability="discrete" start="0" clocks="1016"/&gt;
    &lt;Float64 name="Powertrain::ecuState::ecuState::oilTemp"      valueReference="1014"
        causality="output" variability="discrete" start="0" clocks="1016"/&gt;
    &lt;Float64 name="Powertrain::ecuState::ecuState::radiatorTemp" valueReference="1015"
        causality="output" variability="discrete" start="0" clocks="1016"/&gt;
  &lt;/ModelVariables&gt;
  &lt;ModelStructure&gt;
  &lt;/ModelStructure&gt;
&lt;/fmiModelDescription&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following file shows the <code>&lt;Terminal&gt;</code> definition representing the network and frame structure defined with <code>Powertrain.dbc</code> above.</p>
</div>
<div id="terminalsAndIconHighCut" class="listingblock xml">
<div class="title">Example terminalsAndIcons.xml file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;fmiTerminalsAndIcons fmiVersion="3.0-final"&gt;
  &lt;Terminals&gt;
    &lt;Terminal terminalKind="bus" name="Powertrain" matchingRule="bus"
        description="Powertrain CAN bus defined with dbc file"&gt;
      &lt;Terminal terminalKind="frame" name="tcuSensors" matchingRule="bus"&gt;
        &lt;TerminalMemberVariable variableKind="signal"
          variableName="Powertrain::tcuSensors_Clock" /&gt;
        &lt;Terminal terminalKind="pdu" name="tcuSensors" matchingRule="bus"&gt;
          &lt;TerminalMemberVariable variableKind="signal"
            variableName="Powertrain::tcuSensors::tcuSensors::vCar" memberName="vCar" /&gt;
          &lt;TerminalMemberVariable variableKind="signal"
            variableName="Powertrain::tcuSensors::tcuSensors::oilTemp" memberName="oilTemp" /&gt;
        &lt;/Terminal&gt;
      &lt;/Terminal&gt;
      &lt;Terminal terminalKind="frame" name="tcuState" matchingRule="bus"&gt;
        &lt;TerminalMemberVariable variableKind="signal"
          variableName="Powertrain::tcuState_Clock" /&gt;
        &lt;Terminal terminalKind="pdu" name="tcuState" matchingRule="bus"&gt;
          &lt;TerminalMemberVariable variableKind="signal"
            variableName="Powertrain::tcuState::tcuState::state" memberName="state" /&gt;
          &lt;TerminalMemberVariable variableKind="signal"
            variableName="Powertrain::tcuState::tcuState::gear" memberName="gear" /&gt;
          &lt;TerminalMemberVariable variableKind="signal"
            variableName="Powertrain::tcuState::tcuState::targetGear" memberName="targetGear" /&gt;
        &lt;/Terminal&gt;
      &lt;/Terminal&gt;
      &lt;Terminal terminalKind="frame" name="ecuState" matchingRule="bus"&gt;
        &lt;TerminalMemberVariable variableKind="signal"
          variableName="Powertrain::ecuState_Clock" /&gt;
        &lt;Terminal terminalKind="pdu" name="ecuState" matchingRule="bus"&gt;
          &lt;TerminalMemberVariable variableKind="signal"
            variableName="Powertrain::ecuState::ecuState::accelPedal" memberName="accelPedal" /&gt;
          &lt;TerminalMemberVariable variableKind="signal"
            variableName="Powertrain::ecuState::ecuState::k15" memberName="k15" /&gt;
          &lt;TerminalMemberVariable variableKind="signal"
            variableName="Powertrain::ecuState::ecuState::oilTemp" memberName="oilTemp" /&gt;
          &lt;TerminalMemberVariable variableKind="signal"
            variableName="Powertrain::ecuState::ecuState::radiatorTemp" memberName="radiatorTemp" /&gt;
        &lt;/Terminal&gt;
      &lt;/Terminal&gt;
      &lt;Annotations&gt;
        &lt;Annotation type="ECU" /&gt;
      &lt;/Annotations&gt;
    &lt;/Terminal&gt;
  &lt;/Terminals&gt;
&lt;/fmiTerminalsAndIcons&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="network-abstraction">4. Network Abstraction ("low cut")</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes the Network Abstraction or "low cut" in detail.</p>
</div>
<div class="sect2">
<h3 id="_overview_2">4.1. Overview</h3>
<div class="paragraph">
<p>The network abstraction allows the implementation of virtual bus drivers within FMUs on the level of the hardware abstraction layer.
Exchanging data in terms of <a href="#Overview-Layered-Standard-Bus-Protocol">Layered Standard Bus Protocol</a> via variable groups by the dedicated bus terminal (see <a href="#ClockVariableLowCut">Section 4.3.1</a>), allows the implementation of bus simulations in a wide range from idealized up to a detailed behavior including e.g. timing, arbitration, error, status and other effects.
During simulation, the network communication is controlled by send and receive bus operations.
Based on these operations, networked FMUs have to react as specified by this layered standard in dependency of their role.
This role can be a Bus Simulation FMU or an importer with bus simulation support on one side, and networked FMUs (e.g. virtual ECUs) on the other side (see <a href="#SystemCompositions">System Compositions</a>).
The Layered Standard Bus Protocol in general is bus type specific, but has some similarities.
Bus communication often follows a Transmit/Confirm pattern where a networked FMU sends a Transmit operation containing the network message as payload.
Depending on the <a href="#SystemCompositions">System Composition</a>, the importer forwards the Transmit operation directly to receiving FMUs or to a dedicated bus simulation.
The bus simulation then might delay the transfer of the Transmit operation to the receiving FMUs to simulate timing behavior, before sending a bus specific Confirm operation back to the sending FMU.</p>
</div>
<div id="figure-transmission-overview" class="imageblock text-center">
<div class="content">
<img src="images/transmit_messages.svg" alt="transmit messages" width="50%">
</div>
<div class="title">Figure 6. Transmission overview.</div>
</div>
<div class="paragraph">
<p>The point in time in which FMUs will (potentially) send new network messages must be given to the importer in advance.
Based on these times, the importer has to calculate the next <code>communicationStepSize</code> for all networked FMUs.
For simulating bus communication with timing effects, the FMUs should set the Co-Simulation attribute <code>canHandleVariableCommunicationStepSize = true</code>.</p>
</div>
<div id="figure-transmission-example-with-timing-behavior" class="imageblock text-center">
<div class="content">
<img src="images/bus_simulation_example.svg" alt="bus simulation example" width="80%">
</div>
<div class="title">Figure 7. Example for network simulation with timing behavior.</div>
</div>
<div class="paragraph">
<p>For simplification reasons or if a detail bus simulation is not desired, fixed-step size FMUs can also be used with the Network Abstraction.
However, depending on the chosen simulation step-size, delay effects of the bus simulation have to be taken into account.
The combination of fixed-step size and variable-step size FMUs requires the decoupling of the bus simulation logic and the bus simulation timing.
This decoupling is realized by queuing Tx\Rx bus operations inside the bus simulation as well as queuing Tx bus operations inside network FMUs and will be addressed by this standard.
By queuing bus operations, System Composition with variable-step size FMUs as well as fixed-step size FMUs can be simulated together without affecting each other.</p>
</div>
</div>
<div class="sect2">
<h3 id="Overview-Layered-Standard-Bus-Protocol">4.2. Layered Standard Bus Protocol</h3>
<div class="paragraph">
<p>The Layered Standard Bus Protocol allows the transmission of bus operations between FMUs in binary form via clocks and clocked variables (see <a href="#NetworkAbstractionVariables">Variables</a>).
Depending on the role (networked or bus simulation), FMUs have to react on received operations as specified by this layered standard.
Operations and the reaction on reception are bus type specific and therefore described in the bus specific chapters.
However, the description follows a uniform structure that is described here.
Beside that, the structure also represents the binary form of transmission, where numbers shall be transmitted with <code>little-endian</code> byte order.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OP Code: The operation code defines the unique value of the operation.
It consists of one byte in length.</p>
</li>
<li>
<p>Total Length: A two byte total data length (OP Code + Total Length + Arguments) field following the OP Code.<a id="TotalLengthField"></a>
For operation with variable size arguments, the total length can vary in value at runtime.</p>
</li>
<li>
<p>Arguments: The arguments of the respective operation.
The number of arguments is defined for each operation within this standard.
For arguments with a variable length an argument pair composed of length and data is used.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following table shows an example for an operation definition.
The name is <em>OperationName</em> and has the OP Code 0x01.
The operation has three arguments <em>Arg1</em> (2 bytes long), <em>Arg2_Length</em> (1 byte long), <em>Arg2_Data</em> (<em>&lt;Arg2Length&gt;</em> bytes long), whereby argument 2 and argument 3 form a coherent variable length argument.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Operation type</p></th>
<th class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">Operation content</p></th>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">OP Code</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Total Length</p></th>
<th class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Specific content</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OperationName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5 + &lt;Arg2_Length&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte Arg1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte Arg2_Length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;Arg2_Length&gt; byte Arg2_Data</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Remark:
Since the standard allows to concatenate multiple operations (see <a href="#CommunicationVariable">Tx\Rx Data Variables</a>), the <a href="#TotalLengthField">Total Length</a> field was introduced to allow the implementation of a generic parser for receiving operations.</p>
</div>
</div>
<div class="sect2">
<h3 id="NetworkAbstractionVariables">4.3. Variables</h3>
<div class="paragraph">
<p>This section explains how layered standard bus protocol operations are sent and received by FMUs using FMI3 clock and clocked variables <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup>.
While the former (see <a href="#ClockVariableLowCut">Tx\Rx Clock Variables</a>) are used for scheduling and time synchronization, the latter (see <a href="#CommunicationVariable">Tx\Rx Data Variables</a>) are used to carry the layered standard bus protocol operations in binary form.
To summarize, four variables with the following name schema are used:</p>
</div>
<div class="paragraph">
<p>The input variable <code>BusName::Rx_Data</code> is clocked by the clock variable <code>BusName::Rx_Clock</code>, both with <code>causality</code> set to <code>input</code>.</p>
</div>
<div class="paragraph">
<p>The output variable <code>BusName::Tx_Data</code> is clocked by the clock variable <code>BusName::Tx_Clock</code>, both with <code>causality</code> set to <code>output</code>.</p>
</div>
<div class="paragraph">
<p>Both variable pairs must be listed as member of its corresponding <a href="#BUSTerminalLowCut">Bus Terminal</a>.
How to set the <code>BusName</code> placeholder is bus type specific and therefore decribed in the bus specific chapters.</p>
</div>
<div class="sect3">
<h4 id="ClockVariableLowCut">4.3.1. Tx\Rx Clock Variables</h4>
<div class="paragraph">
<p>As described in the FMI3 specification, Clock variables are used to synchronize events between importer and across FMUs.
Since Clock variables are strictly related to the Event Mode, networked FMUs shall set the Co-Simulation attribute <code>hasEventMode = fmi3True</code> in the model description file.</p>
</div>
<div class="paragraph">
<p>For simulating bus communication according to the Network Abstraction, a time-based clock is used for the <code>Tx_Clock</code> variable to signal the point in time when layered standard bus operations must be transferred by the importer to the receiver FMUs.
Its up to the implementer to either use a <code>periodic</code> or <code>aperiodic</code> Clock.</p>
</div>
<div class="paragraph">
<p>This allows the FMU (or better the exporting tool) to balance the accuracy and performance of its network communication:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>While aperiodic clocks allow very accurate network simulations, frequently entering Event Mode will reduce the network simulation speed.</p>
</li>
<li>
<p>Using periodic clocks and queuing the operations to be transmitted reduces the number of Event Modes required and speeds up the simulation at the cost of simulation accuracy.</p>
</li>
<li>
<p>One could use (structural) parameters to define the accuracy of aperiodic clocks, allowing control of the simulation accuracy and performance with the same FMU.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The input clocks (<code>Rx_Clock</code>) shall be triggered clocks.</p>
</div>
<div class="paragraph">
<p>The importer will then connect and merge output clock activations, even those of different clock types, and forwards them to the input clocks, as required by the network semantics.</p>
</div>
<div class="paragraph">
<p><mark>TODO all</mark>: Should we mandate that all output clock types must be the same? Or should we allow the exporter to mix clock types for the different abstraction layers, or even for the different frames? Since different FMUs might use different clock types anyway, an importer needs to handle the mixed case anyway.
Any other reason to be more strict here?</p>
</div>
<div class="sect4">
<h5 id="_bus_communication_points">4.3.1.1. Bus Communication Points</h5>
<div class="paragraph">
<p>For transferring bus operations, networked FMUs must be synchronous in time.
The importer must ensure this by calling <code>fmi3DoStep</code> for each FMU with a proper <code>communicationStepSize</code> argument.
To determine the <code>communicationStepSize</code> for the first simulation step, the importer gets the Tx clock time in <code>Initialization Mode</code> as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For aperiodic Tx clocks, the importer calls <code>fmi3GetInterval</code>.</p>
</li>
<li>
<p>For periodic Tx clocks, the importer shall evaluate the clock attributes (e.g. <code>intervalDecimal</code>) as defined in the model description.
If <code>intervalDecimal</code> is not defined, the importer shall call <code>fmi3GetShift</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Based on the Tx clock intervals received in the <code>Initialization Mode</code>, the importer calls <code>fmi3DoStep</code> with a determind <code>communicationStepSize</code> to reach the next bus communication point.
After returning from <code>fmi3DoStep</code>, the importer has to enter the <code>Event Mode</code> by calling <code>fmi3EnterEventMode</code>.
In <code>Event Mode</code> the importer activates the Tx and Rx clock by calling <code>fmi3SetClock</code>.
The importer then starts to transfer bus operations from the Tx_Data to the Rx_Data variable (see <a href="#CommunicationVariable">Communication Variables</a>).</p>
</div>
<div class="paragraph">
<p>To determine the <code>communicationStepSize</code> for the next simulation step, the importer gets the Tx clock time as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For aperiodic Tx clocks, the importer calls <code>fmi3GetInterval</code>.</p>
</li>
<li>
<p>For periodic Tx clocks, the importer shall evaluate the clock attributes as defined in the model description.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If an FMU wants to respond to a received bus operation in the same time step, then <code>fmi3GetInterval</code> must return 0.
In this case the importer remains in <code>Event Mode</code> and starts a new iteration.
If an FMU does not know the next Tx clock time for any reason, <code>fmi3GetInterval</code> shall return with <code>qualifierer = fmi3IntervalNotYetKnown</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="CommunicationVariable">4.3.2. Tx\Rx Data Variables</h4>
<div class="paragraph">
<p>The Tx\Rx variables are of type <code>fmi3Binary</code> and contains one or more bus operations, as sent or receive by the FMU.
The senders can chose how many bus operations are buffered and/or for how long operations are buffered before activating an output clock to trigger the actual sending of these operation.
This allows senders to trade accuracy for speed: buffering more and interrupting the simulation less will lead to faster simulations, but less accurate timing of the network communication.</p>
</div>
</div>
<div class="sect3">
<h4 id="_mime_types">4.3.3. MIME Types</h4>
<div class="paragraph">
<p><mark>TODO all</mark>: MIME types: org.fmi-standard.fmi-ls-bus.v1.[CAN|CANFD|LIN|FlexRay|Ethernet|SPI]&#8201;&#8212;&#8201;anything missing? names good?</p>
</div>
<div class="paragraph">
<p>Within FMI, every binary FMI variable has a <code>mimeType</code>, which indicates the type of data passed as a binary.
This type indicates which specific bus type is involved.
It ensures that only bus types of the same type can be interconnected, since FMI only allows the connection of two mime types of the same binary variables.
The following table lists the names of MIME types used for the Tx\Rx data variables:</p>
</div>
<table id="table-mime-types" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 44.4444%;">
<col style="width: 55.5556%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">MIME type name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.fmi-standard.fmi-ls-bus.v1.can</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binary variables simulating the automotive CAN network including CAN, CAN FD and CAN XL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.fmi-standard.fmi-ls-bus.v1.lin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binary variables simulating the automotive LIN network</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.fmi-standard.fmi-ls-bus.v1.flexray</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binary variables simulating the automotive FlexRay network</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.fmi-standard.fmi-ls-bus.v1.ethernet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binary variables simulating the automotive Ethernet network</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.fmi-standard.fmi-ls-bus.v1.spi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binary variables simulating the automotive SPI network</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>As in the table above the version of a specified bus type is integrated within the MIME type.
The MIME type and the associated versioning ensure that only compatible bus types can be connected to each other.
The version number marks the set of available operations.
Only the major version is included by the specified MIME type.
The versioning follows the rules of <a href="https://semver.org/">Semantic Versioning 2.0.0</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_terminal_definitions_2">4.4. Terminal Definitions</h3>
<div class="paragraph">
<p>This section defines terminals for network abstraction or low cut.</p>
</div>
<div class="sect3">
<h4 id="BUSTerminalLowCut">4.4.1. Bus Terminal</h4>
<div class="paragraph">
<p>Each network connected to the FMU must be described in <code>icons/terminalsAndIcons.xml</code> as a <code>&lt;Terminal&gt;</code> element of <code>&lt;fmiTerminalsAndIcons&gt;&lt;Terminals&gt;</code>.
The attribute <code>name</code> of the <code>&lt;Terminal&gt;</code> must match the name of the specified network <em>[e.g. the name of the can channel: Powertrain]</em> within a low cut.
If the specified FMU is connected to more than one network, there shall be exactly one <code>&lt;Terminal&gt;</code> for each network.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Attribute definitions</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>terminalKind</code> must be set to <code>bus</code>.</p>
</li>
<li>
<p><code>matchingRule</code> must be set to <code>bus</code>.</p>
</li>
<li>
<p><code>name</code> is the network name, e.g. <code>Powertrain</code>, see <a href="#ExampleLowCut">Example</a> and constraints above.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Element definitions</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>BusName::Rx_Data</code> and <code>BusName::Tx_Data</code> and their clocks <code>BusName::Rx_Clock</code> and <code>BusName::Tx_Clock</code> are exposed in the <code>modelDescription.xml</code>, they must be listed as <code>&lt;TerminalMemberVariable&gt;</code> elements here.</p>
</li>
<li>
<p>There must be no <code>&lt;TerminalStreamMemberVariable&gt;</code> element.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The <a href="#figure-frame-variables-terminals-lowcut">following figure</a> shows a FMU with four variables <code>Tx_Data</code>, <code>Tx_Clock</code>, <code>Rx_Data</code>, <code>Rx_Clock</code> that are aggregated to a <code>&lt;Terminal&gt;</code> named <em>Bus Terminal</em>:</p>
</div>
<div id="figure-frame-variables-terminals-lowcut" class="imageblock text-center">
<div class="content">
<img src="images/bus_terminal.svg" alt="bus terminal" width="30%">
</div>
<div class="title">Figure 8. Frame variables and terminals.</div>
</div>
</div>
<div class="sect3">
<h4 id="ExampleLowCut">4.4.2. Example</h4>
<div class="paragraph">
<p>The following excerpts from files are used throughout this document as examples and should illustrate how the different concepts relate.</p>
</div>
<div id="modelDescriptionLowCut" class="listingblock xml">
<div class="title">Example modelDescription.xml for ECU node</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;fmiModelDescription fmiVersion="3.0-final" modelName="Network4FMI"
    instantiationToken="Network4FMI"&gt;
  &lt;ModelVariables&gt;
    &lt;Clock name="Powertrain::Rx_Clock" valueReference="1002"
        causality="input" variability="discrete" interval="triggered"/&gt;
    &lt;Binary name="Powertrain::Rx_Data" valueReference="1001" causality="input"
        mimeType="org.fmi-standard.fmi-ls-bus.v1.can" variability="discrete" clocks="1002"/&gt;
    &lt;Clock name="Powertrain::Tx_Clock" valueReference="1004"
        causality="output" variability="discrete" interval="aperiodic"/&gt;
    &lt;Binary name="Powertrain::Tx_Data" valueReference="1003" causality="output"
        mimeType="org.fmi-standard.fmi-ls-bus.v1.can" variability="discrete" clocks="1004"/&gt;
  &lt;/ModelVariables&gt;
  &lt;ModelStructure&gt;
  &lt;/ModelStructure&gt;
&lt;/fmiModelDescription&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following file shows the <code>&lt;Terminal&gt;</code> related definition:</p>
</div>
<div id="terminalsAndIconLowCut" class="listingblock xml">
<div class="title">Example terminalsAndIcons.xml file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;fmiTerminalsAndIcons fmiVersion="3.0-final"&gt;
  &lt;Terminals&gt;
    &lt;Terminal terminalKind="bus" name="Powertrain" matchingRule="bus"
        description="Powertrain CAN bus terminal definition"&gt;
      &lt;TerminalMemberVariable variableKind="signal"
        variableName="name="Powertrain"::Rx_Clock" /&gt;
      &lt;TerminalMemberVariable variableKind="signal"
        variableName="name="Powertrain"::Rx_Data" /&gt;
      &lt;TerminalMemberVariable variableKind="signal"
        variableName="name="Powertrain"::Tx_Clock" /&gt;
      &lt;TerminalMemberVariable variableKind="signal"
        variableName="name="Powertrain"::Tx_Data" /&gt;
      &lt;/Terminal&gt;
    &lt;/Terminal&gt;
  &lt;/Terminals&gt;
&lt;/fmiTerminalsAndIcons&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="NetworkParameters">4.5. Network Parameters</h3>
<div class="paragraph">
<p>Using structural parameters, FMUs can be parameterized according to importer specifications.
This chapter specifies the structural parameters that each FMU shall provide.</p>
</div>
<div class="paragraph">
<p>Within the <a href="#DirectCommunication">Direct Communication</a> case the transmission is always positively confirmed by the FMU itself.
Within <a href="#Composition-with-dedicated-Bus-Simulation-FMU">Composition with dedicated Bus Simulation FMU</a> and <a href="#BusFeatureIntegratedFmuSimulator">Importer with Integrated Bus Simulation</a> communication case, the Bus Simulation returns a feedback of a successful or faulty transmission.
Justified by this scenarios the FMU simulator shall parameterize the FMUs according to the selected <a href="#SystemCompositions">System Composition</a> via the following defined structural parameters:</p>
</div>
<div id="figure-fmu-system-composition-parameters" class="listingblock">
<div class="title">FMU parameters for system composition selection by the FMU importer</div>
<div class="content">
<pre>    org.fmi-standard.fmi-ls-bus.DirectConfirmation
        Description:  "Specifies if a transmission is always positively confirmed by the FMU itself"
        Type:         Boolean
        Causality:    structuralParameter
        Variability:  fixed
        Start:        -</pre>
</div>
</div>
<div class="paragraph">
<p><code>org.fmi-standard.fmi-ls-bus.DirectConfirmation</code> shall be set to <code>True</code> if a given FMU importer wants to integrate the specified FMUs via the <a href="#DirectCommunication">Direct Communication</a> case; otherwise to <code>False</code>.</p>
</div>
<div class="paragraph">
<p><mark>TODO all</mark>: define further parameter names and their semantics influencing bus behavior and/or version of the fmi-ls-bus version (FMU declares them as parameters or structural parameters depending on internal mechanisms)</p>
</div>
</div>
<div class="sect2">
<h3 id="_example">4.6. Example</h3>
<div class="paragraph">
<p>#TODO dSPACE: Providing examples</p>
</div>
</div>
<div class="sect2">
<h3 id="BusTypeSpecificDetails">4.7. Bus Specific Details</h3>
<div class="paragraph">
<p>The Network Abstraction ("low cut") defines an abstraction layer for several different bus types.
This standard can applied in any bus specific problem domain, for example in scenarios for the automotive sector (Vehicle bus,  Autonomous Driving, Advanced Driver Assistance System), medical devices, elevator controls and in automation technology.</p>
</div>
<div class="paragraph">
<p>The following chapters specifies the supported bus formats of this standard.</p>
</div>
<div class="sect3">
<h4 id="_can_can_fd_can_xl">4.7.1. CAN, CAN FD, CAN XL</h4>
<div class="paragraph">
<p><mark>TODO dSPACE: THIS CHAPTER IS STILL UNDER CONSTRUCTION. At the moment it is only a preview</mark></p>
</div>
<div class="paragraph">
<p>This section specifies the CAN bus support of this standard.
The data communication protocols CAN, CAN FD and CAN XL are taken into account here.
The overview begins with a general part, which explains the implementation of the CAN basic features.
Then the specified CAN operations are discussed. Finally, processes are described in detail with the help of sequence diagrams.</p>
</div>
<div class="sect4">
<h5 id="_overview_3">4.7.1.1. Overview</h5>
<div class="paragraph">
<p>CAN is a message-based multi-master serial bus standard for connecting ECUs, which also known as nodes.
For CAN two or more nodes are required on the CAN network to communicate.
This means one sender node may have more but at least one receiver node.</p>
</div>
<div id="figure-can-network-overview" class="imageblock text-center">
<div class="content">
<img src="images/can_network_overview.svg" alt="can network overview" width="70%">
</div>
<div class="title">Figure 9. Controller Area Network (CAN).</div>
</div>
<div class="paragraph">
<p>Every CAN frame is identified by a unique CAN frame ID and contains four different sections for arbitration, control, data and CRC values.
During every transmission of a CAN Frame an acknowledge slot for the receivers is provided.
The acknowledge slot is used to acknowledge the receipt of a valid CAN frame.
So for every transmitted frame a transmission acknowledge is required according to the CAN standard.
If two nodes transmit a frame during the same time an arbitration is done.
With CAN, the priority of the respective message is based on the value of the frame ID.
The lower the value of the frame ID, the higher the priority.
For example, if two frames with ID = 15 and ID = 16 are to be sent at the same time from different nodes, the frame with ID = 15 wins the arbitration and is sent first.
Frame IDs must be unique on a single CAN bus, otherwise two nodes would continue transmission beyond the end of the arbitration field (ID) causing an error.
CAN supports wake-up and sleep scenarios.
Normally there are two ways to wake up from sleep mode: a local wake up on a specified wake-up pin, or a CAN wake-up on the CAN bus via a CAN specific wake-up pulse.
The sleep state can be initiated locally only.</p>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_of_bus_simulation_fmu">4.7.1.2. Configuration of Bus Simulation FMU</h5>
<div class="paragraph">
<p>In order to calculate the time required for the transmission of a bus message, it is necessary to inform the Bus Simulation FMU of the baud rate from an FMU.
For this purpose, a total of three operations are specified, which make the baud rate for <a href="#BaudrateCanOpCode">CAN</a>, <a href="#BaudrateCanFdOpCode">CAN FD</a> and <a href="#BaudrateCanXlOpCode">CAN XL</a> configurable.
As already mentioned more detailed network simulations, including bandwidth restrictions, message arbitration and delays are possible within <a href="#Composition-with-dedicated-Bus-Simulation-FMU">Composition with dedicated Bus Simulation FMU</a> and <a href="#BusFeatureIntegratedFmuSimulator">Importer with Integrated Bus Simulation</a> communication case only.
In these two cases a baud rate has to be configured.
For <a href="#DirectCommunication">Direct Communication</a> use case the configuration is optional and will be ignored.</p>
</div>
</div>
<div class="sect4">
<h5 id="_transmission_and_acknowledge">4.7.1.3. Transmission and Acknowledge</h5>
<div class="paragraph">
<p>The <a href="#TransmitOpCodeCanLowCut">transmission operation</a> represents the sending of a CAN, CAN FD and CAN XL frame.
With appropriate options, relevant functionalities can be configured and used on an network abstracted level (e.g. Virtual CAN network ID for CAN XL or Bit Rate Switch for CAN FD).
For realization of the CAN transmission acknowledge feature a Transmit/Confirm pattern is used.
For CAN the transmission of network data consists of exactly two phases.
In the first phase, the specific network data are send (transmit phase).
In the second step, the sender receives feedback (confirm phase) if the transmission was successful or not.
In the case of an unsuccessful transmission, a reason for the faulty transmission is also provided.
Depending on the reason of faulty transmission the sender can decide if the specified transmission shall be repeated or not.</p>
</div>
<div class="paragraph">
<p>This directly means that every <a href="#TransmitOpCodeCanLowCut">transmission operation</a> transferred to a Bus Simulation FMU has a result in form of a) <a href="#ConfirmOpCodeCanLowCut">positive confirmation</a> if the transmission was successful or b) an <a href="#ErrorOpCodeCanLowCut">error</a> if the transmission was not successful.
The next <a href="#TransmitOpCodeCanLowCut">transmission operation</a> shall only be sent as soon as there is a confirmation or an error.
Within <a href="#DirectCommunication">Direct Communication</a> use case, where exactly two FMUs communicate with each other, the confirmation of the transmitted frame shall be directly done by the sender itself.
<a href="#figure-can-direct-communication">Figure 10</a> illustrates this communication, whereby FMU 1 transmits a frame to FMU 2.
After the transmission the frame is directly confirmed by FMU 1 itself.</p>
</div>
<div id="figure-can-direct-communication" class="imageblock text-center">
<div class="content">
<img src="images/principles_of_communication_direct.svg" alt="principles of communication direct" width="40%">
</div>
<div class="title">Figure 10. Direct Confirmation of transmitted frame.</div>
</div>
<div class="paragraph">
<p>Within <a href="#Composition-with-dedicated-Bus-Simulation-FMU">Composition with dedicated Bus Simulation FMU</a> and <a href="#BusFeatureIntegratedFmuSimulator">Importer with Integrated Bus Simulation</a> the confirmation is done by the Bus Simulation FMU.
The following <a href="#figure-can-confirmation-with-bus-simulation-fmu">Figure 11</a> illustrates the behavior, whereby FMU 1 transmits a frame to FMU 2 via a Bus Simulation FMU.</p>
</div>
<div id="figure-can-confirmation-with-bus-simulation-fmu" class="imageblock text-center">
<div class="content">
<img src="images/can_confirmation_with_bus_simulation_fmu.svg" alt="can confirmation with bus simulation fmu" width="70%">
</div>
<div class="title">Figure 11. Confirmation of transmitted frame via Bus Simulation FMU.</div>
</div>
<div class="paragraph">
<p>The <a href="#SystemCompositions">System Compositions</a> in which the FMU is located is defined by <a href="#NetworkParameters">network parameters</a>.</p>
</div>
<div class="paragraph">
<p><a href="#figure-can-transmission-acknowledge">Figure 12</a> illustrates these two cases, whereby the transition from FMU 1 &#8594; FMU 2 represents the successful case and FMU 2 &#8594; FMU 1 represents the non successful case.
In step (1), a <a href="#TransmitOpCodeCanLowCut">transmission operation</a> will be delivered to the Bus Simulation FMU.
Within step (2), the <a href="#TransmitOpCodeCanLowCut">transmission operation</a> will transferred to FMU 2, so the transmission was successful.
Also in step (2), FMU 1 receives a <a href="#ConfirmOpCodeCanLowCut">confirmation operation</a>, which means the transmission was successful.
In step (3), FMU 2 wants to transmit a frame to FMU 1:
a <a href="#TransmitOpCodeCanLowCut">transmission operation</a> will be delivered from FMU 2 to the Bus Simulation FMU.
In step (4), we see that the transmission results in an <a href="#ErrorOpCodeCanLowCut">error operation</a>:
FMU 2 knows that the transmission was not successful.</p>
</div>
<div id="figure-can-transmission-acknowledge" class="imageblock text-center">
<div class="content">
<img src="images/can_transmission_acknowledge.svg" alt="can transmission acknowledge" width="80%">
</div>
<div class="title">Figure 12. Successful and not successful case CAN frame transmission.</div>
</div>
<div class="paragraph">
<p>Normally, transmission failure cannot occur during a simulated bus transmission.
Most common kinds of errors are used to inject transmission errors, for example using the Bus Simulation FMU, for advanced test scenarios.</p>
</div>
</div>
<div class="sect4">
<h5 id="_topology">4.7.1.4. Topology</h5>
<div class="paragraph">
<p>As already illustrated in <a href="#figure-can-network-overview">Figure 9</a>, CAN always describes a line topology.
It is therefore necessary that a CAN node can send a message and that it can be received by several recipients.
This line topology cannot be mapped in FMI in this way.
The required line topology is therefore simulated within the Bus Simulation FMU.
A Bus Simulation FMU must make the transmitted message available again to all recipients and the sender.
This behavior is relevant for <a href="#Composition-with-dedicated-Bus-Simulation-FMU">Composition with dedicated Bus Simulation FMU</a> and <a href="#BusFeatureIntegratedFmuSimulator">Importer with Integrated Bus Simulation</a> communication case only.
For <a href="#DirectCommunication">Direct Communication</a> use case this behavior can be ignored because there are exactly two FMUs without a Bus Simulation FMU.</p>
</div>
</div>
<div class="sect4">
<h5 id="CanArbitration">4.7.1.5. Arbitration</h5>
<div class="paragraph">
<p>Arbitration is an instrument of the CAN standard to resolve the conflict of the simultaneous sending of messages from several CAN nodes without a collision.
The arbitration is handled completely in the Bus Simulation FMU and can be recognized by the fact that the Bus Simulation FMU receives a <a href="#TransmitOpCodeCanLowCut">transmission operation</a> from several FMUs in the same step.
As soon as an arbitration is lost, an <a href="#ErrorOpCodeCanLowCut">error operation</a> with ErrorCode = ARBITRATION_LOST must be returned to the respective sender within the next Event Mode step.
As soon as an FMU loses arbitration in this way, it must independently repeat the corresponding <a href="#TransmitOpCodeCanLowCut">transmission operation</a>.</p>
</div>
<div class="paragraph">
<p><a href="#figure-can-arbitration-overview">Figure 13</a> shows the realization of a CAN arbitration.
At the beginning, FMU 1 and FMU 2 each send a frame at the same time.
In this situation, an arbitration is necessary so that it can be decided which frame should be sent in this case.
Both frames are transferred to the Bus Simulation FMU.
Arbitration takes place within the Bus Simulation FMU.
In the example given, the two frames with CAN ID = 15 and CAN ID = 16 are analyzed and it is decided that CAN ID = 15 wins the arbitration.
The Bus Simulation FMU then calculates the transmission time for the CAN frame with CAN ID = 15.
The next time the FMI Event Mode is called up for the Bus Simulation FMU, the corresponding CAN frame is transmitted to FMU 2 and FMU 3.
For CAN ID 16, FMU 2 is informed via an <a href="#ErrorOpCodeCanLowCut">error operation</a> with ErrorCode = ARBITRATION_LOST that this frame cannot be sent.
FMU 1 gets a <a href="#ConfirmOpCodeCanLowCut">confirm operation</a>, because the specified frame with CAN ID 15 was successfully transmitted.</p>
</div>
<div id="figure-can-arbitration-overview" class="imageblock text-center">
<div class="content">
<img src="images/can_arbitration_overview.svg" alt="can arbitration overview" width="80%">
</div>
<div class="title">Figure 13. Arbitration of CAN frames within Bus Simulation FMU.</div>
</div>
<div class="paragraph">
<p>Within a <a href="#TransmitOpCodeCanLowCut">transmission operation</a>, the <code>UseBuffer</code> argument can be specified.
Once this is set, the bus simulation buffers the frame after losing arbitration and sends it as soon as possible.
When using this parameter, it is therefore not necessary for the FMU to trigger the respective frame to be sent again.
In this scenario the <a href="#ErrorOpCodeCanLowCut">error operation</a> with ErrorCode = ARBITRATION_LOST shall not be returned to the specific FMU.</p>
</div>
<div id="figure-can-arbitration-overview-with-buffer" class="imageblock text-center">
<div class="content">
<img src="images/can_arbitration_overview_with_buffer.svg" alt="can arbitration overview with buffer" width="80%">
</div>
<div class="title">Figure 14. Arbitration of CAN frames with buffering within Bus Simulation FMU.</div>
</div>
<div class="paragraph">
<p>Arbitration is available in <a href="#Composition-with-dedicated-Bus-Simulation-FMU">Composition with dedicated Bus Simulation FMU</a> and <a href="#BusFeatureIntegratedFmuSimulator">Importer with Integrated Bus Simulation</a> communication case only.</p>
</div>
</div>
<div class="sect4">
<h5 id="_wake_upsleep">4.7.1.6. Wake-up/Sleep</h5>
<div class="paragraph">
<p>This standard supports wake-up and sleep for the CAN bus, whereby only the bus-specific parts are taken into account.
This means that the realization of local virtual ECU wake-up and sleeping processes are internal parts of the respective FMU, which is not covered by this document.
Because entering sleep state is a virtual ECU internal process, this can be ignored here.
The virtual ECU local wake-up process is ignored as well.
The CAN specific wake-up pulse can be emulated by using the <a href="#WakeupCanOpCode">wake-up operation</a>.
A <a href="#WakeupCanOpCode">wake-up operation</a> shall always be sent to all participants of the bus by the Bus Simulation FMU.</p>
</div>
<div class="paragraph">
<p><a href="#figure-can-wake-up">Figure 15</a> shows the wake-up of FMU 1 and FMU 2 via the Bus Simulation FMU:</p>
</div>
<div id="figure-can-wake-up" class="imageblock text-center">
<div class="content">
<img src="images/can_wake_up.svg" alt="can wake up" width="70%">
</div>
<div class="title">Figure 15. Wake-up of FMU 1 and FMU 2 via bus.</div>
</div>
<div class="paragraph">
<p>Wake-up/Sleep makes mostly sense in <a href="#Composition-with-dedicated-Bus-Simulation-FMU">Composition with dedicated Bus Simulation FMU</a> and <a href="#BusFeatureIntegratedFmuSimulator">Importer with Integrated Bus Simulation</a> communication case, but is also allowed in <a href="#DirectCommunication">Direct Communication</a> use case.</p>
</div>
</div>
<div class="sect4">
<h5 id="_operations">4.7.1.7. Operations</h5>
<div class="paragraph">
<p>This section defines the allowed operations for CAN, CAN FD, CAN XL.
The following table provides an overview of all operations and specifies the position and length of the corresponding arguments, as well as the respective flow direction.</p>
</div>
<table id="table-operation-content-can" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 2.9411%;">
<col style="width: 2.9411%;">
<col style="width: 2.9411%;">
<col style="width: 2.9411%;">
<col style="width: 58.8235%;">
<col style="width: 2.9411%;">
<col style="width: 2.9411%;">
<col style="width: 2.9411%;">
<col style="width: 2.9411%;">
<col style="width: 2.9411%;">
<col style="width: 14.7066%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Operation type</p></th>
<th class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">Operation content</p></th>
<th class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">General</p></th>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">OP Code</p></th>
<th class="tableblock halign-left valign-top" colspan="7"><p class="tableblock">Specific content</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Repeated</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Direction</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NOOP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td>
<td class="tableblock halign-left valign-top" colspan="7"><p class="tableblock">---</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FMU &#8594; Bus</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transmit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x81</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 byte Frame ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 byte Data Length (DLC)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte Flags</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte SDT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte VCID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 byte AF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n bytes Data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multiple</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FMU &#8594; Bus</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Confirm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x82</p></td>
<td class="tableblock halign-left valign-top" colspan="7"><p class="tableblock">4 byte Frame ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multiple</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bus &#8594; FMU</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x83</p></td>
<td class="tableblock halign-left valign-top" colspan="7"><p class="tableblock">1 byte ErrorCode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multiple</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bus &#8594; FMU</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wakeup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x84</p></td>
<td class="tableblock halign-left valign-top" colspan="7"><p class="tableblock">---</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multiple</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bus &#8594; FMU</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BaudrateCan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x05</p></td>
<td class="tableblock halign-left valign-top" colspan="7"><p class="tableblock">4 byte BaudrateValue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FMU &#8594; Bus</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BaudrateCanFD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x06</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">4 byte BaudrateValue</p></td>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">4 byte BaudrateValueCanFd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FMU &#8594; Bus</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BaudrateCanXL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x07</p></td>
<td class="tableblock halign-left valign-top" colspan="7"><p class="tableblock">4 byte BaudrateValueCanXl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FMU &#8594; Bus</p></td>
</tr>
</tbody>
</table>
<div class="sect5">
<h6 id="_noop">4.7.1.7.1. NOOP</h6>
<div class="paragraph">
<p>Represents no operation.
This operation code must be used if no frames are to be sent in the respective time window, so the specified number of frames to send is zero.</p>
</div>
</div>
<div class="sect5">
<h6 id="TransmitOpCodeCanLowCut">4.7.1.7.2. Transmit</h6>
<div class="paragraph">
<p>Represents the <code>Transmit operation</code> of a specified frame.
The following information are included within this operation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Frame ID: The specified ID of the CAN, CAN FD or CAN XL message, whereby the size of the field is defined by the CAN standard.</p>
</li>
<li>
<p>UseBuffer: If a specified Frame ID looses arbitration, this parameter defines if the given frame shall be buffered by the Bus Simulation or shall be removed and the FMU has to trigger the transmission again.
The parameter value is defined as \(true = 0\) and \(false = 1\).</p>
</li>
<li>
<p>Data Length (DLC): Number of bytes of data (0–8 bytes)</p>
</li>
<li>
<p>Flags: The flags field consists of a total of seven segments, with each of the following information stored in one bit, starting with the lowest:</p>
<div class="ulist">
<ul>
<li>
<p>Ide: Identifier Extension</p>
</li>
<li>
<p>Rtr: Specifies if the given frame represents an Remote Transmission Request frame.</p>
</li>
<li>
<p>Fdf: Specifies if the given frame represents an CAN FD frame, whereby \(true = 0\) and \(false = 1\).</p>
</li>
<li>
<p>Brs: Defines the Bit Rate Switch.
This information is relevant for CAN FD Format only.</p>
</li>
<li>
<p>Esi: Error State indicator.
This information is relevant for CAN FD Format only.</p>
</li>
<li>
<p>Xlf: Specifies if the given frame represents an CAN XL frame, whereby \(true = 0\) and \(false = 1\).</p>
</li>
<li>
<p>Sec: Simple Extended Content.
This information is relevant for CAN XL Format only.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Bit position</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Field value</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Xlf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Esi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fdf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rtr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ide</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>SDT (SDU type): Describes the structure of the frames Data Field content.
This information is relevant for CAN XL Format only.</p>
</li>
<li>
<p>VCID: Represents the virtual CAN network ID.
This information is relevant for CAN XL Format only.</p>
</li>
<li>
<p>AF (Acceptance Field): Represents the CAN XL acceptance field.
This information is relevant for CAN XL Format only.</p>
</li>
<li>
<p>Data: Stores the given frame data to transfer.
The length of the data depends on the CAN Format CAN, CAN FD or CAN XL.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Within <a href="#Composition-with-dedicated-Bus-Simulation-FMU">Composition with dedicated Bus Simulation FMU</a> and <a href="#BusFeatureIntegratedFmuSimulator">Importer with Integrated Bus Simulation</a> communication case every <a href="#TransmitOpCodeCanLowCut">transmission operation</a> transferred to a Bus Simulation FMU has a result in form of a) <a href="#ConfirmOpCodeCanLowCut">positive confirmation</a> if the transmission was successful or b) an <a href="#ErrorOpCodeCanLowCut">error</a> including a specified error code if the transmission was not successful.
The next <a href="#TransmitOpCodeCanLowCut">transmission operation</a> shall only be sent as soon as there is a confirmation or an error.</p>
</div>
</div>
<div class="sect5">
<h6 id="ConfirmOpCodeCanLowCut">4.7.1.7.3. Confirm</h6>
<div class="paragraph">
<p>The <code>Confirm operation</code> represents the confirmation of a transmitted frame (see <a href="#TransmitOpCodeCanLowCut">Transmit operation</a>).
For every frame, which is transmitted via <code>Transmit operation</code>, a <code>Confirm operation</code> is expected separate from direct communication case.
The following information are included within this operation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Frame ID: The specified ID of the CAN, CAN FD or CAN XL message, whereby the size of the field is defined by the CAN standard.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>Confirm operation</code> is not supported in the <a href="#DirectCommunication">Direct Communication</a> case.
Within this communication case, a send operation is always positively confirmed.</p>
</div>
</div>
<div class="sect5">
<h6 id="ErrorOpCodeCanLowCut">4.7.1.7.4. Error</h6>
<div class="paragraph">
<p>By using the <code>Error operation</code> the Bus Simulation FMU can communicate an error for a specific frame to send.
The following codes are allowed to use for ErrorCode:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 71.4286%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">State</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Code</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARBITRATION_LOST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents an arbitration lost error, which shall be used if a specific frame initiated by a <a href="#TransmitOpCodeCanLowCut">Transmit operation</a> lost the arbitration. See <a href="#CanArbitration">Section 4.7.1.5</a> for further details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">COMMUNICATION_ERROR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents a generic transmission error initiated by a <a href="#TransmitOpCodeCanLowCut">Transmit operation</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BIT_ERROR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x81</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents an error that the bit received is not the same as the bit transmitted.
Within CAN the sender always receives its transmitted data for a comparison.
If the sent and received bits are not identical this situation results in a Bit Error.
This error case cannot occur during a simulated bus transmission.
The error is used to inject transmission errors, for example using the Bus Simulation FMU, for advanced test scenarios.
The given error is always related to a specific <a href="#TransmitOpCodeCanLowCut">Transmit operation</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BIT_STUFFING_ERROR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x82</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Bit Stuff Error occurs if 6 consecutive bits of equal value are detected on the bus.
This error case cannot occur during a simulated bus transmission.
The error is used to inject transmission errors, for example using the Bus Simulation FMU, for advanced test scenarios.
The given error is always related to a specific <a href="#TransmitOpCodeCanLowCut">Transmit operation</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FORM_ERROR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x83</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Occurs during a violation of End-of-Frame (EOF) format.
This error case cannot occur during a simulated bus transmission.
The error is used to inject transmission errors, for example using the Bus Simulation FMU, for advanced test scenarios.
The given error is always related to a specific <a href="#TransmitOpCodeCanLowCut">Transmit operation</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CRC_ERROR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x84</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents an CRC Error, so if the data of a frame and the related checksum not harmonize.
This error case cannot occur during a simulated bus transmission.
The error is used to inject transmission errors, for example using the Bus Simulation FMU, for advanced test scenarios.
The given error is always related to a specific <a href="#TransmitOpCodeCanLowCut">Transmit operation</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACK_ERROR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x85</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At least one receiving node identifies an invalid CAN frame.
This error case cannot occur during a simulated bus transmission.
The error is used to inject transmission errors, for example using the Bus Simulation FMU, for advanced test scenarios.
The given error is always related to a specific <a href="#TransmitOpCodeCanLowCut">Transmit operation</a>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="WakeupCanOpCode">4.7.1.7.5. Wakeup</h6>
<div class="paragraph">
<p>By using the <code>Wakeup operation</code> the underlying Bus Simulation FMU can trigger a bus-specific wake up.
This operation contains no arguments and shall always be sent to all participants of the bus by the Bus Simulation FMU.</p>
</div>
</div>
<div class="sect5">
<h6 id="BaudrateCanOpCode">4.7.1.7.6. BaudrateCan</h6>
<div class="paragraph">
<p>The <code>BaudrateCan operation</code> specifies the CAN baud rate to a specific value.
The following information are included within this operation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>BaudrateValue: The specified baudrate value to configure, whereby the specified ranges are defined by the CAN standard.
The required unit for the baudrate value is bit/s.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="BaudrateCanFdOpCode">4.7.1.7.7. BaudrateCanFD</h6>
<div class="paragraph">
<p>The <code>BaudrateCanFD operation</code> specifies the CAN and CAN FD baud rate to a specific value.
The following information are included within this operation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>BaudrateValue: The specified baudrate value to configure, whereby the specified ranges are defined by the CAN standard.
The required unit for the baudrate value is bit/s.</p>
</li>
<li>
<p>BaudrateValueCanFd: The specified baudrate value to configure, whereby the specified ranges are defined by the CAN FD standard.
The required unit for the baudrate value is bit/s.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="BaudrateCanXlOpCode">4.7.1.7.8. BaudrateCanXL</h6>
<div class="paragraph">
<p>The <code>BaudrateCanXL operation</code> specifies the CAN XL baud rate to a specific value.
The following information are included within this operation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>BaudrateValueCanXl: The specified baudrate value to configure, whereby the specified ranges are defined by the CAN standard.
The required unit for the baudrate value is bit/s.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_sequence_diagrams">4.7.1.8. Sequence Diagrams</h5>
<div class="paragraph">
<p><mark>TODO dSPACE</mark></p>
</div>
</div>
<div class="sect4">
<h5 id="_sae_j1939">4.7.1.9. SAE J1939</h5>
<div class="paragraph">
<p>Society of Automotive Engineers standard SAE J1939 is a wide use communication standard for communication and diagnostics among vehicle components within the car and heavy-duty truck industry.
Because CAN, CAN FD, CAN XL are supported by this standard, <a href="https://www.sae.org/">SAE J1939</a> is also indirectly supported.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lin">4.7.2. LIN</h4>
<div class="paragraph">
<p><mark>TODO dSPACE</mark></p>
</div>
</div>
<div class="sect3">
<h4 id="_flexray">4.7.3. FlexRay</h4>
<div class="paragraph">
<p><mark>TODO</mark></p>
</div>
</div>
<div class="sect3">
<h4 id="_ethernet">4.7.4. Ethernet</h4>
<div class="paragraph">
<p><mark>TODO dSPACE</mark></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="NetworkSimulation">5. Network Simulation</h2>
<div class="sectionbody">
<div class="paragraph">
<p><mark>TODO</mark></p>
</div>
<div id="figure-example-network-simulation-architecture" class="imageblock text-center">
<div class="content">
<img src="images/architecture_bus_simulation_importer.svg" alt="architecture bus simulation importer" width="60%">
</div>
<div class="title">Figure 16. Example network simulation architecture.</div>
</div>
<div class="paragraph">
<p>The figure above shows one example for a network simulation architecture.
The importer is able to handle FMU input and output variables with network semantics:
The importer merges output clock activations, output binary data and output signal variables and forwards the results to their corresponding input variables.</p>
</div>
<div class="paragraph">
<p>The accuracy/performance of the resulting network simulation can range from ideal (no bandwidth restriction, no arbitration, no network errors) to more realistic (with restricted bandwidth, message delay due to arbitration, network errors, error injection, &#8230;&#8203;).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_known_limitations_of_this_standard">6. Known Limitations of This Standard</h2>
<div class="sectionbody">
<div class="paragraph">
<p><mark>TODO all</mark></p>
</div>
<div class="paragraph">
<p>This layered standard maps several network protocols onto co-simulation variables as transport layer simulating in many ways an ideal network.
Such an ideal network differs from physical networks in the following ways (and potentially others):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Network frame arbitration: frames are sent on the wire according to network-specific priority rules.<br>
Here all frames are transmitted at the same time without delay.</p>
</li>
<li>
<p>Network congestion/bandwidth: too many network frames sent for the bandwidth of the network.<br>
Here the network has infinite capacity.<br>
If network properties are required, a bus simulation component must be added or included with the importer.</p>
</li>
<li>
<p>Protocol functions of higher levels: i.e. CAN request for retransmit is a specific protocol function.<br>
Here such specialties must be handled by the first layer inside the FMU.</p>
</li>
<li>
<p>Incoming buffer overflow: when an ECU receives more frames than its buffer can hold.<br>
Here the FMU will receive all frames, regardless of buffer size and would need to handle those limitations internally.</p>
</li>
<li>
<p><a id="multiOutput"></a>Network protocols allow frames to be sent from more than one node.<br>
Here this is also possible, with output variables for frames (and their signals) that are sent by more than one FMU.
This requires the importer to handle the case when multiple source FMUs are sending the same frame.
Importers must know how to handle this, just like they must know how to handle flow variables according to Kirchhoff&#8217;s law.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. In AUTOSAR context this concrete means a driver implementation within the MicroController Abstraction Layer (MCAL)
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. For details, refer to Functional Mock-up Interface Specification (fmi-standard.org) chapter 2.2.8 Clocks.
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code[data-lang]')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>